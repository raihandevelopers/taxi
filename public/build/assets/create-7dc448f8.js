import{_ as te,Z as oe,C as se,r as v,T as le,D,g as k,o as r,x as N,w as h,a as E,N as q,k as b,l as e,n as ae,J as c,q as S,K as V,i as g,L as T,F,B as y,p as ne,M as G,y as j}from"./vendor-ddfbd976.js";import{L as ie}from"./main-306a5ea6.js";import{P as re}from"./page-header-2dc95532.js";import{u as ce}from"./footer-e648049d.js";import"./app-042fb454.js";const de={components:{Layout:ie,PageHeader:re,Head:oe},props:{googleMapKey:String,successMessage:String,default_lat:String,default_lng:String,alertMessage:String,existingZones:Array},setup(a){const{googleMapKey:o}=a,{t:u}=se(),{languages:s,fetchData:A}=ce(),z=v("English"),_=le({service_location_id:"",languageFields:{},unit:""}),L=v(a.successMessage||""),f=v(a.alertMessage||""),O=v([]),p=v(""),w=v([]),t=v(null);let d=[];const M=v(null),C=v(null),K=()=>{p.value.length<3?w.value=[]:setTimeout(()=>{U(p.value)},300)},U=l=>{const i="https://places.googleapis.com/v1/places:autocomplete",n={"Content-Type":"application/json","X-Goog-Api-Key":a.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(i,{method:"POST",headers:n,body:JSON.stringify({input:l})}).then(m=>m.json()).then(m=>{var x;((x=m.suggestions)==null?void 0:x.length)>0&&(w.value=m.suggestions.filter(P=>P.placePrediction).map(P=>({placeId:P.placePrediction.placeId,formattedAddress:P.placePrediction.text.text})))}).catch(m=>{console.error("Error fetching autocomplete results:",m)})},H=async l=>{const i={"X-Goog-Api-Key":a.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${l.placeId}?fields=viewport,location`,{headers:i}).then(n=>n.json()).then(n=>{p.value="",w.value=[];const B=new google.maps.LatLng(n.location.latitude,n.location.longitude);if(t.value.setCenter(B),n.viewport&&n.viewport.high&&n.viewport.low){const m=new google.maps.LatLngBounds(new google.maps.LatLng(n.viewport.low.latitude,n.viewport.low.longitude),new google.maps.LatLng(n.viewport.high.latitude,n.viewport.high.longitude));t.value.fitBounds(m)}else t.value.setZoom(15)}).catch(n=>{console.error("Error fetching autocomplete results:",n)})},R=async()=>{const l=await E.get("list");O.value=l.data.results},Z=l=>{google.maps.event.addListener(l,"click",()=>{C.value!==l&&(d.forEach(i=>{i.setOptions({fillColor:"#0000FF",editable:!1})}),l.setOptions({fillColor:"#00FF00",editable:!0}),C.value=l)})},X=()=>{M.value=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!1,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polygonOptions:{fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),M.value.setMap(t.value),google.maps.event.addListener(M.value,"overlaycomplete",function(l){l.type===google.maps.drawing.OverlayType.POLYGON&&(d.push(l.overlay),Z(l.overlay))})},Y=()=>{t.value=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(a.default_lat),lng:parseFloat(a.default_lng)},zoom:10}),a.existingZones.forEach(l=>{new google.maps.Polygon({paths:l,fillColor:"#FF0000",fillOpacity:.5,strokeWeight:1,clickable:!1,editable:!1,zIndex:1,map:t.value})}),X()},I=l=>{if(M.value){let i=l=="draw"?google.maps.drawing.OverlayType.POLYGON:null;M.value.setDrawingMode(i)}},J=()=>{if(C.value){const l=d.indexOf(C.value);I("grab"),l>-1&&(d[l].setMap(null),d.splice(l,1))}},W=()=>{d.forEach(l=>{l.setMap(null),C.value=null}),d=[]},Q=async()=>{const l=ee();if(Object.keys(l).length===0)try{if(d.length===0){f.value=u("at_least_one_completed_polygon_is_required");return}const i=d.map(m=>m.getPath().getArray().map(x=>[x.lng(),x.lat()])),n={..._.data(),coordinates:JSON.stringify(i)};(await E.post("store",n)).status===201?(L.value=u("zone_created_successfully"),_.reset(),q.get("/zones")):f.value=u("failed_to_create_zone")}catch(i){i.response&&i.response.status===403?(f.value=i.response.data.alertMessage,setTimeout(()=>{q.get("/zones")},5e3)):i.response&&i.response.status===422?(f.value=i.response.data.message,_.errors={coordinates:i.response.data.message}):(_.errors={},f.value=u("failed_to_create_zone_catch"),console.error(u("error_updating_zone"),i))}else _.errors=l},$=l=>{z.value=l};D(async()=>{Object.keys(s).length==0&&await A()});const ee=()=>{const{service_location_id:l,unit:i}=_,n={};return i?delete n.unit:n.unit=u("unit_is_required"),l?delete n.service_location_id:n.service_location_id=u("service_location_is_required"),d.length===0?n.coordinates=u("at_least_one_completed_polygon_is_required"):delete n.coordinates,n};return D(()=>{if(!o){console.error(u("google_map_api_key_is_null_or_undefined"));return}const l=document.createElement("script");l.src=`https://maps.googleapis.com/maps/api/js?key=${o}&libraries=places,drawing`,l.onload=()=>{Y(),R()},document.head.appendChild(l)}),{form:_,successMessage:L,alertMessage:f,handleSubmit:Q,serviceLocations:O,search:p,suggestions:w,handleInput:K,selectSuggestion:H,setActiveTab:$,removeAllPolygons:W,removeSelectedPolygon:J,changeDrawingMode:I,activeTab:z,languages:s}},computed:{selectedUnitLabel(){return this.form.unit==1?this.$t("kilo_meter"):this.form.unit==2?this.$t("miles"):""}}},ge={class:"row"},ue={class:"col-lg-6"},me={class:"card"},_e={class:"card-body"},pe={class:"mb-3"},ve={for:"service_location",class:"form-label"},fe={value:"",disabled:""},he=["value"],be={key:0,class:"text-danger"},ye={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},we={class:"nav-item",role:"presentation"},ke=["onClick"],Me=["id"],Ce={class:"col-sm-6 mt-3"},xe={class:"mb-3"},Le=["for"],Oe=["placeholder","id","onUpdate:modelValue","required"],Pe={class:"mb-3"},Se={for:"select_unit",class:"form-label"},Te={disabled:"",value:""},Fe={value:"1"},ze={value:"2"},Be={key:0,class:"text-danger"},Ae={class:"text-end"},Ie={type:"submit",class:"btn btn-primary"},De={class:"mb-3"},Ne={key:0,class:"text-danger"},Ee={class:"col-lg-6 col-md-10 col-sm-10"},qe={class:"card"},Ve={class:"card-body"},Ge={class:"autocomplete-container"},je={class:"input-group"},Ke=["placeholder"],Ue={key:0,class:"autocomplete-results"},He=["onClick"],Re={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},Ze={class:"d-flex align-items-center"},Xe={class:"card-body"},Ye={class:"d-flex align-items-center"},Je={class:"card-body"},We={class:"d-flex align-items-center"},Qe={class:"card-body"},$e={class:"d-flex align-items-center"},et={class:"card-body"},tt={key:0,class:"custom-alert alert alert-success alert-border-left fade show",role:"alert",id:"alertMsg"},ot={class:"alert-content"},st={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},lt={class:"alert-content"};function at(a,o,u,s,A,z){const _=k("Head"),L=k("PageHeader"),f=k("BCol"),O=k("BRow"),p=k("BButton"),w=k("Layout");return r(),N(w,null,{default:h(()=>[b(_,{title:"Zones"}),b(L,{title:a.$t("create"),pageTitle:a.$t("zone"),pageLink:"/zones"},null,8,["title","pageTitle"]),e("div",ge,[e("div",ue,[e("div",me,[e("div",_e,[e("form",{onSubmit:o[2]||(o[2]=ae((...t)=>s.handleSubmit&&s.handleSubmit(...t),["prevent"]))},[e("div",pe,[e("label",ve,c(a.$t("service_location")),1),S(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":o[0]||(o[0]=t=>s.form.service_location_id=t)},[e("option",fe,c(a.$t("select_service_location")),1),(r(!0),g(F,null,T(s.serviceLocations,t=>(r(),g("option",{key:t.id,value:t.id},c(t.name),9,he))),128))],512),[[V,s.form.service_location_id]]),s.form.errors.service_location_id?(r(),g("span",be,c(s.form.errors.service_location_id),1)):y("",!0)]),e("ul",ye,[(r(!0),g(F,null,T(s.languages,t=>(r(),N(O,{key:t.code},{default:h(()=>[b(f,{lg:"12"},{default:h(()=>[e("li",we,[e("a",{class:ne(["nav-link",{active:s.activeTab===t.label}]),onClick:d=>s.setActiveTab(t.label),role:"tab","aria-selected":"true"},c(t.label),11,ke)])]),_:2},1024)]),_:2},1024))),128))]),(r(!0),g(F,null,T(s.languages,t=>(r(),g("div",{class:"tab-content text-muted",key:t.code},[s.activeTab===t.label?(r(),g("div",{key:0,class:"tab-pane active show",id:`${t.label}`,role:"tabpanel"},[e("div",Ce,[e("div",xe,[e("label",{for:`name-${t.code}`,class:"form-label"},c(a.$t("name")),9,Le),S(e("input",{type:"text",class:"form-control",placeholder:a.$t("enter_name_in",{language:`${t.label}`}),id:`name-${t.code}`,"onUpdate:modelValue":d=>s.form.languageFields[t.code]=d,required:t.code==="en"},null,8,Oe),[[G,s.form.languageFields[t.code]]])])])],8,Me)):y("",!0)]))),128)),e("div",Pe,[e("label",Se,c(a.$t("select_unit")),1),S(e("select",{id:"select_unit",class:"form-select","onUpdate:modelValue":o[1]||(o[1]=t=>s.form.unit=t)},[e("option",Te,c(a.$t("choose_unit")),1),e("option",Fe,c(a.$t("kilo_meter")),1),e("option",ze,c(a.$t("miles")),1)],512),[[V,s.form.unit]]),s.form.errors.unit?(r(),g("span",Be,c(s.form.errors.unit),1)):y("",!0)]),e("div",Ae,[e("button",Ie,c(a.$t("save")),1)]),e("div",De,[s.form.errors.coordinates?(r(),g("span",Ne,c(s.form.errors.coordinates),1)):y("",!0)])],32)])])]),e("div",Ee,[e("div",qe,[e("div",Ve,[e("div",Ge,[e("div",je,[S(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=t=>s.search=t),placeholder:a.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:o[4]||(o[4]=(...t)=>s.handleInput&&s.handleInput(...t))},null,40,Ke),[[G,s.search]])]),s.suggestions.length>0?(r(),g("div",Ue,[(r(!0),g(F,null,T(s.suggestions,t=>(r(),g("div",{key:t.placeId,class:"autocomplete-item",onClick:d=>s.selectSuggestion(t)},c(t.formattedAddress),9,He))),128))])):y("",!0)]),o[13]||(o[13]=e("div",{id:"map",style:{height:"400px",position:"relative","z-index":"10"}},null,-1)),e("div",Re,[e("div",Ze,[e("div",Xe,[b(p,{onClick:o[5]||(o[5]=t=>s.changeDrawingMode("grab")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Select"},{default:h(()=>o[9]||(o[9]=[e("i",{class:"bx bxs-hand-up fs-16"},null,-1)])),_:1,__:[9]})])]),e("div",Ye,[e("div",Je,[b(p,{onClick:o[6]||(o[6]=t=>s.changeDrawingMode("draw")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Add"},{default:h(()=>o[10]||(o[10]=[e("i",{class:"bx bx-plus fs-16"},null,-1)])),_:1,__:[10]})])]),e("div",We,[e("div",Qe,[b(p,{onClick:s.removeSelectedPolygon,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove selected polygon"},{default:h(()=>o[11]||(o[11]=[e("i",{class:"bx bx-x fs-16"},null,-1)])),_:1,__:[11]},8,["onClick"])])]),e("div",$e,[e("div",et,[b(p,{onClick:s.removeAllPolygons,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove all"},{default:h(()=>o[12]||(o[12]=[e("i",{class:"bx bx-trash fs-16"},null,-1)])),_:1,__:[12]},8,["onClick"])])])])]),o[14]||(o[14]=e("div",{class:"card-footer"},[e("div",{class:"alert alert-warning f-18",role:"alert"},[e("strong",null,"Avoid drawing multiple zones that overlap with each other.")])],-1))])])]),s.successMessage?(r(),g("div",tt,[e("div",ot,[o[15]||(o[15]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[16]||(o[16]=e("strong",null,"Success",-1)),j(" - "+c(s.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:o[7]||(o[7]=(...t)=>a.dismissMessage&&a.dismissMessage(...t)),"aria-label":"Close Success Message"})])])):y("",!0),s.alertMessage?(r(),g("div",st,[e("div",lt,[o[17]||(o[17]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[18]||(o[18]=e("strong",null,"Alert",-1)),j(" - "+c(s.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:o[8]||(o[8]=(...t)=>a.dismissMessage&&a.dismissMessage(...t)),"aria-label":"Close Alert Message"})])])):y("",!0)]),_:1})}const gt=te(de,[["render",at],["__scopeId","data-v-cfc2fc97"]]);export{gt as default};

import{_ as se,Z as le,C as ae,r as v,T as ne,D as ie,g as M,o as r,x as V,w as b,a as U,N as K,k as y,i as u,l as e,n as re,J as d,q as F,K as G,F as B,L as A,B as C,p as ce,M as H,y as de}from"./vendor-ddfbd976.js";import{L as ge}from"./main-306a5ea6.js";import{P as ue}from"./page-header-2dc95532.js";import{u as pe}from"./footer-e648049d.js";import"./app-042fb454.js";const me={components:{Layout:ge,PageHeader:ue,Head:le},props:{zone:Object,googleMapKey:String,successMessage:String,alertMessage:String,app_for:String,existingZones:Array},setup(i){const{zone:o,googleMapKey:w}=i,{t}=ae(),{languages:I,fetchData:E}=pe(),L=v("English"),T=v(i.successMessage||""),h=v(i.alertMessage||""),_=ne({service_location_id:o.service_location_id,languageFields:o?o.languageFields||{}:{},unit:o.unit,coordinates:o.coordinates||[]}),f=v([]);let p,s,g=[];const x=v(null),k=v(null),D=async()=>{const l=await U.get("/zones/list");f.value=l.data.results},S=v(""),z=v([]),J=()=>{S.value.length<3?z.value=[]:setTimeout(()=>{R(S.value)},300)},R=l=>{const a="https://places.googleapis.com/v1/places:autocomplete",n={"Content-Type":"application/json","X-Goog-Api-Key":i.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(a,{method:"POST",headers:n,body:JSON.stringify({input:l})}).then(c=>c.json()).then(c=>{var P;((P=c.suggestions)==null?void 0:P.length)>0&&(z.value=c.suggestions.filter(O=>O.placePrediction).map(O=>({placeId:O.placePrediction.placeId,formattedAddress:O.placePrediction.text.text})))}).catch(c=>{console.error("Error fetching autocomplete results:",c)})},Z=async l=>{const a={"X-Goog-Api-Key":i.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${l.placeId}?fields=viewport,location`,{headers:a}).then(n=>n.json()).then(n=>{S.value="",z.value=[];const m=new google.maps.LatLng(n.location.latitude,n.location.longitude);if(p.setCenter(m),n.viewport&&n.viewport.high&&n.viewport.low){const c=new google.maps.LatLngBounds(new google.maps.LatLng(n.viewport.low.latitude,n.viewport.low.longitude),new google.maps.LatLng(n.viewport.high.latitude,n.viewport.high.longitude));p.fitBounds(c)}else p.setZoom(15)}).catch(n=>{console.error("Error fetching autocomplete results:",n)})},N=()=>{if(o&&o.coordinates){p=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:10}),i.existingZones.forEach(a=>{new google.maps.Polygon({paths:a,fillColor:"#FF0000",fillOpacity:.5,strokeWeight:1,clickable:!1,editable:!1,zIndex:1,map:p})});const l=new google.maps.LatLngBounds;o.coordinates.forEach(a=>{const n=a[0].map(m=>({lat:m.coordinates[1],lng:m.coordinates[0]}));s=new google.maps.Polygon({paths:n,fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1,map:p}),g.push(s),q(s),s.getPath().forEach(m=>l.extend(m))}),p.fitBounds(l),$()}},q=l=>{google.maps.event.addListener(l,"click",()=>{k.value!==l&&(g.forEach(a=>{a.setOptions({fillColor:"#0000FF",editable:!1})}),l.setOptions({fillColor:"#00FF00",editable:!0}),k.value=l)})},j=l=>{if(x.value){let a=l=="draw"?google.maps.drawing.OverlayType.POLYGON:null;x.value.setDrawingMode(a)}},X=()=>{if(k.value){const l=Q(k.value);l>-1&&(g[l].setMap(null),g.splice(l,1)),k.value=null,j("grab")}},W=()=>{g.forEach(l=>{l.setMap(null),k.value=null}),g=[]},Y=(l,a)=>{const n=l.getPath().getArray().map(c=>({lat:c.lat(),lng:c.lng()})),m=a.getPath().getArray().map(c=>({lat:c.lat(),lng:c.lng()}));return JSON.stringify(n)===JSON.stringify(m)},Q=l=>{for(let a=0;a<g.length;a++)if(Y(l,g[a]))return a;return-1},$=()=>{x.value=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{fillColor:"#0000FF",fillOpacity:.5,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),x.value.setMap(p),google.maps.event.addListener(x.value,"overlaycomplete",function(l){l.type===google.maps.drawing.OverlayType.POLYGON&&(g.push(l.overlay),q(l.overlay))})},ee=async()=>{if(i.app_for=="demo"){Swal.fire(t("error"),t("you_are_not_authorised"),"error");return}const l=te();if(Object.keys(l).length===0)try{if(g.length===0){h.value=t("at_least_one_completed_polygon_is_required");return}const a=g.map(c=>c.getPath().getArray().map(P=>[P.lng(),P.lat()])),n={..._.data(),coordinates:JSON.stringify(a)};(await U.post(`/zones/update/${o.id}`,n)).status===200?(T.value=t("zone_created_successfully"),_.reset(),K.get("/zones")):console.error(t("failed_to_update_zone"))}catch(a){a.response&&a.response.status===403?(h.value=a.response.data.alertMessage,setTimeout(()=>{K.get("/zones")},5e3)):a.response&&a.response.status===422?(h.value=a.response.data.message,_.errors={coordinates:a.response.data.message}):(_.errors={},h.value=t("failed_to_create_zone_catch"),console.error(t("error_updating_zone"),a))}else _.errors=l},te=()=>{const{service_location_id:l,unit:a}=_,n={};return a?delete n.unit:n.unit="Unit is required",l?delete n.service_location_id:n.service_location_id=t("service_location_is_required"),n},oe=l=>{L.value=l};return ie(async()=>{let l=!1;if(!w){console.error(t("google_map_api_key_is_null_or_undefined"));return}if(Object.keys(I).length==0&&await E(),document.querySelector(`script[src="https://maps.googleapis.com/maps/api/js?key=${w}&libraries=places,drawing"]`))l||(N(),D(),l=!0);else{const a=document.createElement("script");a.src=`https://maps.googleapis.com/maps/api/js?key=${w}&libraries=places,drawing`,a.onload=()=>{l||(N(),D(),l=!0)},document.head.appendChild(a)}}),{form:_,serviceLocations:f,handleSubmit:ee,serviceLocations:f,setActiveTab:oe,serviceLocations:f,search:S,suggestions:z,handleInput:J,selectSuggestion:Z,alertMessage:h,languages:I,removeAllPolygons:W,removeSelectedPolygon:X,changeDrawingMode:j,activeTab:L}},computed:{selectedUnitLabel(){return this.form.unit==1?this.$t("kilo_meter"):this.form.unit==2?this.$t("miles"):""}}},_e={key:0,class:"row"},fe={class:"col-lg-6"},ve={class:"card"},he={class:"card-body"},be={class:"mb-3"},ye={for:"service_location",class:"form-label"},we={value:"",disabled:""},ke=["value"],Me={key:0,class:"text-danger"},Ce={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},xe={class:"nav-item",role:"presentation"},Pe=["onClick"],Le=["id"],Se={class:"col-sm-6 mt-3"},ze={class:"mb-3"},Oe=["for"],Fe=["placeholder","id","onUpdate:modelValue","required"],Be={class:"mb-3"},Ae={for:"select_unit",class:"form-label"},Ie={disabled:"",value:""},Te={value:"1"},Ee={value:"2"},De={key:0,class:"text-danger"},Ne={class:"text-end"},qe=["disabled"],je={class:"mb-3"},Ve={key:0,class:"text-danger"},Ue={class:"col-lg-6"},Ke={class:"card"},Ge={class:"card-body"},He={class:"autocomplete-container"},Je={class:"input-group"},Re=["placeholder"],Ze={key:0,class:"autocomplete-results"},Xe=["onClick"],We={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},Ye={class:"d-flex align-items-center"},Qe={class:"card-body"},$e={class:"d-flex align-items-center"},et={class:"card-body"},tt={class:"d-flex align-items-center"},ot={class:"card-body"},st={class:"d-flex align-items-center"},lt={class:"card-body"},at={key:1},nt={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},it={class:"alert-content"};function rt(i,o,w,t,I,E){const L=M("Head"),T=M("PageHeader"),h=M("BCol"),_=M("BRow"),f=M("BButton"),p=M("Layout");return r(),V(p,null,{default:b(()=>[y(L,{title:"Edit Zone"}),y(T,{title:i.$t("edit"),pageTitle:i.$t("zone"),pageLink:"/zones"},null,8,["title","pageTitle"]),w.zone?(r(),u("div",_e,[e("div",fe,[e("div",ve,[e("div",he,[e("form",{onSubmit:o[2]||(o[2]=re((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[e("div",be,[e("label",ye,d(i.$t("service_location")),1),F(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.service_location_id=s)},[e("option",we,d(i.$t("select_service_location")),1),(r(!0),u(B,null,A(t.serviceLocations,s=>(r(),u("option",{key:s.id,value:s.id},d(s.name),9,ke))),128))],512),[[G,t.form.service_location_id]]),t.form.errors.service_location_id?(r(),u("span",Me,d(t.form.errors.service_location_id),1)):C("",!0)]),e("ul",Ce,[(r(!0),u(B,null,A(t.languages,s=>(r(),V(_,{key:s.code},{default:b(()=>[y(h,{lg:"12"},{default:b(()=>[e("li",xe,[e("a",{class:ce(["nav-link",{active:t.activeTab===s.label}]),onClick:g=>t.setActiveTab(s.label),role:"tab","aria-selected":"true"},d(s.label),11,Pe)])]),_:2},1024)]),_:2},1024))),128))]),(r(!0),u(B,null,A(t.languages,s=>(r(),u("div",{class:"tab-content text-muted",key:s.code},[t.activeTab===s.label?(r(),u("div",{key:0,class:"tab-pane active show",id:`${s.label}`,role:"tabpanel"},[e("div",Se,[e("div",ze,[e("label",{for:`name-${s.code}`,class:"form-label"},d(i.$t("name")),9,Oe),F(e("input",{type:"text",class:"form-control",placeholder:`Enter Name in ${s.label}`,id:`name-${s.code}`,"onUpdate:modelValue":g=>t.form.languageFields[s.code]=g,required:s.code==="en"},null,8,Fe),[[H,t.form.languageFields[s.code]]])])])],8,Le)):C("",!0)]))),128)),e("div",Be,[e("label",Ae,d(i.$t("select_unit")),1),F(e("select",{id:"select_unit",class:"form-select","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.unit=s)},[e("option",Ie,d(i.$t("choose_unit")),1),e("option",Te,d(i.$t("kilo_meter")),1),e("option",Ee,d(i.$t("miles")),1)],512),[[G,t.form.unit]]),t.form.errors.unit?(r(),u("span",De,d(t.form.errors.unit),1)):C("",!0)]),e("div",Ne,[e("button",{type:"submit",class:"btn btn-primary",disabled:w.app_for==="demo"},d(i.$t("update")),9,qe)]),e("div",je,[t.form.errors.coordinates?(r(),u("span",Ve,d(t.form.errors.coordinates),1)):C("",!0)])],32)])])]),e("div",Ue,[e("div",Ke,[e("div",Ge,[e("div",He,[e("div",Je,[F(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>t.search=s),placeholder:i.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:o[4]||(o[4]=(...s)=>t.handleInput&&t.handleInput(...s))},null,40,Re),[[H,t.search]])]),t.suggestions.length>0?(r(),u("div",Ze,[(r(!0),u(B,null,A(t.suggestions,s=>(r(),u("div",{key:s.placeId,class:"autocomplete-item",onClick:g=>t.selectSuggestion(s)},d(s.formattedAddress),9,Xe))),128))])):C("",!0)]),o[12]||(o[12]=e("div",{id:"map",style:{height:"400px"}},null,-1)),e("div",We,[e("div",Ye,[e("div",Qe,[y(f,{onClick:o[5]||(o[5]=s=>t.changeDrawingMode("grab")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Select"},{default:b(()=>o[8]||(o[8]=[e("i",{class:"bx bxs-hand-up fs-16"},null,-1)])),_:1,__:[8]})])]),e("div",$e,[e("div",et,[y(f,{onClick:o[6]||(o[6]=s=>t.changeDrawingMode("draw")),class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Add"},{default:b(()=>o[9]||(o[9]=[e("i",{class:"bx bx-plus fs-16"},null,-1)])),_:1,__:[9]})])]),e("div",tt,[e("div",ot,[y(f,{onClick:t.removeSelectedPolygon,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove selected polygon"},{default:b(()=>o[10]||(o[10]=[e("i",{class:"bx bx-x fs-16"},null,-1)])),_:1,__:[10]},8,["onClick"])])]),e("div",st,[e("div",lt,[y(f,{onClick:t.removeAllPolygons,class:"align-center btn-dark border border-light","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"Remove all"},{default:b(()=>o[11]||(o[11]=[e("i",{class:"bx bx-trash fs-16"},null,-1)])),_:1,__:[11]},8,["onClick"])])])])]),o[13]||(o[13]=e("div",{class:"card-footer"},[e("div",{class:"alert alert-warning f-18",role:"alert"},[e("strong",null," Avoid make new polygons that overlap with existing zones.")])],-1))])])])):(r(),u("div",at,d(i.$t("lodaing")),1)),t.alertMessage?(r(),u("div",nt,[e("div",it,[o[14]||(o[14]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[15]||(o[15]=e("strong",null,"Alert",-1)),de(" - "+d(t.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:o[7]||(o[7]=(...s)=>i.dismissMessage&&i.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):C("",!0)]),_:1})}const mt=se(me,[["render",rt],["__scopeId","data-v-8ad352de"]]);export{mt as default};

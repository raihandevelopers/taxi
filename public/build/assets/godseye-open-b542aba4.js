import{_ as Y,O as ee,C as te,r,T as ae,Q as G,X as v,D as le,a2 as oe,g as _,o as se,x as ie,w as m,k as d,l as u,J as C,y as J}from"./vendor-ddfbd976.js";import{L as ne}from"./main-306a5ea6.js";import{P as re}from"./page-header-2dc95532.js";import{u as ce}from"./footer-e648049d.js";import"./app-042fb454.js";const de={data(){return{rightOffcanvas:!1}},components:{Layout:ne,PageHeader:re,Multiselect:ee},props:{firebaseSettings:Object,service_location:Array,vehicle_type:Array,default_lat:String,default_lng:String},setup(a){const{t:b}=te(),y=r(null),l=r(null),N=r(""),z=ae({all:"",locked:""}),{selectedLocation:w}=ce(),F=r([]),V=r({}),A=r(!1),H=r(parseFloat(a.default_lat)),I=r(parseFloat(a.default_lng)),S=r(!1),s=r([]),D=r(a.service_location.map(t=>({value:t.id,label:t.name}))),P=r(a.vehicle_type.map(t=>({value:t.id,label:t.name}))),k=()=>{S.value=!0},K=()=>{z.reset(),fetchDatas(),S.value=!1};G([l,s],()=>{L()}),G(w,t=>{y.value=t,L()});let B,o={};const Q=()=>{B=v.map("map").setView({lat:H.value,lng:I.value},15),v.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(B);var t={apiKey:a.firebaseSettings.firebase_api_key,authDomain:a.firebaseSettings.firebase_auth_domain,databaseURL:a.firebaseSettings.firebase_database_url,projectId:a.firebaseSettings.firebase_project_id,storageBucket:a.firebaseSettings.firebase_storage_bucket,messagingSenderId:a.firebaseSettings.firebase_messaging_sender_id,appId:a.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(t),y.value=w.value,L()},X=()=>{l.value=null,s.value=[],L()},Z=()=>{console.log(s.value),L()},L=()=>{const t=firebase.database().ref("drivers");t.on("value",i=>{i.forEach(n=>{const e=n.val(),f=x(e.g);if(f){const g=[f.lat,f.lon];let M=s.value.length>0?s.value.includes("online"):!0,T=s.value.length>0?s.value.includes("onride"):!0,O=s.value.length>0?s.value.includes("offline"):!0,p="";e.hasOwnProperty("is_active")&&e.hasOwnProperty("is_available")&&(e.is_active==1&&e.is_available==!0&&M?p=`/image/map/${e.vehicle_type_icon}.png`:e.is_active==1&&e.is_available==!1&&T?p=`/image/map/${e.vehicle_type_icon}.png`:O&&(p=`/image/map/${e.vehicle_type_icon}.png`));let h=!1;e.service_location_id&&D.value.find(c=>c.id==e.service_location_id)&&(h=!0),y.value&&(h=y.value==e.service_location_id);let U=Array.isArray(e.vehicle_types);if(l.value&&Array.isArray(e.vehicle_types)&&e.vehicle_types.length>0&&(U=(Array.isArray(e.vehicle_types)&&e.vehicle_types.some(c=>l.value===c))??!1),p.length>0&&U&&h)if(o[e.id])j(o[e.id],o[e.id].getLatLng(),g),o[e.id].setIcon(v.icon({iconUrl:p,iconSize:[30,30]}));else{const c=v.marker(g,{icon:v.icon({iconUrl:p,iconSize:[30,30]})}).addTo(B);c.bindTooltip(`<strong>${e.name}</strong><br>Mobile: ${e.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),o[e.id]=c,j(c,c.getLatLng(),g)}else R(e.id)}})}),t.on("child_changed",i=>{const n=i.val();W(n)}),t.on("child_removed",i=>{const n=i.val();R(n.id)})},j=(t,i,n)=>{t.setLatLng(n).update()},W=t=>{const i=x(t.g);if(i){const n=[i.lat,i.lon],e=`/image/map/${t.vehicle_type_icon}.png`;if(o[t.id])j(o[t.id],o[t.id].getLatLng(),n),o[t.id].setIcon(v.icon({iconUrl:e,iconSize:[30,30]}));else{const f=v.marker(n,{icon:v.icon({iconUrl:e,iconSize:[30,30]})}).addTo(B);o[t.id]=f}}else console.error(`${b("failed_to_decode_geohash")} ${t.id}`)},R=t=>{o[t]&&(B.removeLayer(o[t]),delete o[t])},x=t=>{const i="0123456789bcdefghjkmnpqrstuvwxyz",n=[16,8,4,2,1];let e=!0,f=-90,g=90,M=-180,T=180,O,p;if(t){for(let h=0;h<t.length;h++){let U=t.charAt(h),c=i.indexOf(U);for(let E=0;E<5;E++){let q=n[E];if(e){let $=(M+T)/2;c&q?M=$:T=$}else{let $=(f+g)/2;c&q?f=$:g=$}e=!e}}return O=(f+g)/2,p=(M+T)/2,{lat:O,lon:p}}return null};return le(()=>{Q()}),{fetchData:oe.debounce(L,300),results:F,paginator:V,filter:z,searchTerm:N,serviceLocations:D,vehicleTypes:P,selectedServiceLocations:y,selectedVehicleTypes:l,filterData:k,clearFilter:K,clearFilters:X,applyFilters:Z,modalShow:A,modalFilter:S,selectedModes:s}}},_e={class:"row"},fe={class:"col-12 col-lg-4"},pe={class:"mb-3"},ue={for:"select_mode",class:"form-label"},ve={class:"col-12 col-lg-4"},me={class:"mb-3"},ge={for:"vehicle_type",class:"form-label"},he={class:"col-12 col-lg-6 d-flex gap-1"},be={id:"map",style:{height:"400px"}};function ye(a,b,y,l,N,z){const w=_("Head"),F=_("PageHeader"),V=_("Multiselect"),A=_("BButton"),H=_("BCardHeader"),I=_("BCardBody"),S=_("BCard"),s=_("BCol"),D=_("BRow"),P=_("Layout");return se(),ie(P,null,{default:m(()=>[d(w,{title:a.$t("gods-eye")},null,8,["title"]),d(F,{title:a.$t("gods-eye"),pageTitle:a.$t("map")},null,8,["title","pageTitle"]),d(D,null,{default:m(()=>[d(s,{lg:"12"},{default:m(()=>[d(S,{"no-body":"",id:"tasksList"},{default:m(()=>[d(H,{class:"border-0"},{default:m(()=>[u("div",_e,[u("div",fe,[u("div",pe,[u("label",ue,C(a.$t("drivers")),1),d(V,{id:"select_mode",mode:"tags","close-on-select":!1,searchable:!0,"create-option":!1,modelValue:l.selectedModes,"onUpdate:modelValue":b[0]||(b[0]=k=>l.selectedModes=k),options:[{value:"offline",label:a.$t("offline")},{value:"online",label:a.$t("online")},{value:"onride",label:a.$t("onride")}],placeholder:a.$t("select_mode")},null,8,["modelValue","options","placeholder"])])]),u("div",ve,[u("div",me,[u("label",ge,C(a.$t("vehicle_types")),1),d(V,{modelValue:l.selectedVehicleTypes,"onUpdate:modelValue":b[1]||(b[1]=k=>l.selectedVehicleTypes=k),options:l.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:a.$t("select_vehicle_types"),id:"select_service_location"},null,8,["modelValue","options","placeholder"])])]),u("div",he,[d(A,{type:"button",variant:"success",class:"btn btn-md",onClick:l.applyFilters},{default:m(()=>[J(C(a.$t("apply")),1)]),_:1},8,["onClick"]),d(A,{type:"button",variant:"danger",class:"btn btn-md",onClick:l.clearFilters},{default:m(()=>[J(C(a.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),d(I,{class:"border border-dashed border-end-0 border-start-0"},{default:m(()=>[u("div",be,C(a.$t("map_loading")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Te=Y(de,[["render",ye]]);export{Te as default};

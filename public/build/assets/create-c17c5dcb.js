import{_ as W,Z as Q,C as $,r as _,T as ee,D as I,g as P,o as g,x as se,w as k,a as B,N as D,k as f,l as e,n as oe,J as u,q as N,K as te,i as v,L as E,F as G,B as C,M as j,y as q}from"./vendor-ddfbd976.js";import{L as le}from"./main-306a5ea6.js";import{P as ae}from"./page-header-2dc95532.js";import{u as ne}from"./footer-e648049d.js";import"./app-042fb454.js";const ie={components:{Layout:le,PageHeader:ae,Head:Q},props:{googleMapKey:String,successMessage:String,serviceLocations:Object,default_lat:String,default_lng:String,alertMessage:String,languages:Array},setup(n){const{googleMapKey:s}=n,{t:p}=$(),{languages:t,fetchData:A}=ne(),S=_("English"),m=ee({service_location_id:"",name:""}),x=_(n.successMessage||""),r=_(n.alertMessage||""),O=_([]),l=_(""),y=_([]),h=_(null);let c=[];const b=_(null),w=_(null),K=()=>{l.value.length<3?y.value=[]:setTimeout(()=>{V(l.value)},300)},V=o=>{const a="https://places.googleapis.com/v1/places:autocomplete",i={"Content-Type":"application/json","X-Goog-Api-Key":n.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(a,{method:"POST",headers:i,body:JSON.stringify({input:o})}).then(d=>d.json()).then(d=>{var M;((M=d.suggestions)==null?void 0:M.length)>0&&(y.value=d.suggestions.filter(L=>L.placePrediction).map(L=>({placeId:L.placePrediction.placeId,formattedAddress:L.placePrediction.text.text})))}).catch(d=>{console.error("Error fetching autocomplete results:",d)})},H=async o=>{const a={"X-Goog-Api-Key":n.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${o.placeId}?fields=viewport,location`,{headers:a}).then(i=>i.json()).then(i=>{l.value="",y.value=[];const T=new google.maps.LatLng(i.location.latitude,i.location.longitude);if(h.value.setCenter(T),i.viewport&&i.viewport.high&&i.viewport.low){const d=new google.maps.LatLngBounds(new google.maps.LatLng(i.viewport.low.latitude,i.viewport.low.longitude),new google.maps.LatLng(i.viewport.high.latitude,i.viewport.high.longitude));h.value.fitBounds(d)}else h.value.setZoom(15)}).catch(i=>{console.error("Error fetching autocomplete results:",i)})},z=async()=>{const o=await B.get("list");O.value=o.data.results},U=()=>{h.value=new google.maps.Map(document.getElementById("map"),{center:{lat:parseFloat(n.default_lat),lng:parseFloat(n.default_lng)},zoom:10}),b.value=new google.maps.drawing.DrawingManager({drawingMode:google.maps.drawing.OverlayType.POLYGON,drawingControl:!1,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.POLYGON]},polygonOptions:{fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),b.value.setMap(h.value),google.maps.event.addListener(b.value,"overlaycomplete",o=>{o.type===google.maps.drawing.OverlayType.POLYGON&&(google.maps.event.addListener(o.overlay,"click",()=>{w.value!==o.overlay&&(w.value=o.overlay,c.forEach(a=>{a.setOptions({fillColor:"#0000FF",editable:!1})}),o.overlay.setOptions({fillColor:"#00FF00",editable:!0}))}),c.push(o.overlay))})},F=o=>{if(b.value){let a=o=="draw"?google.maps.drawing.OverlayType.POLYGON:null;b.value.setDrawingMode(a)}},X=()=>{if(w.value){const o=c.indexOf(w.value);F("grab"),o>-1&&(c[o].setMap(null),c.splice(o,1))}},Y=()=>{c.forEach(o=>{o.setMap(null),w.value=null}),c=[]},J=async()=>{const o=Z();if(Object.keys(o).length===0)try{if(c.length===0){r.value=p("at_least_one_completed_polygon_is_required");return}const a=c.map(d=>d.getPath().getArray().map(M=>[M.lng(),M.lat()])),i={...m.data(),coordinates:JSON.stringify(a)};(await B.post("store",i)).status===201?(x.value=p("airport_created_successfully"),m.reset(),D.get("/airport")):r.value=p("failed_to_create_airport")}catch(a){a.response&&a.response.status===403?(r.value=a.response.data.alertMessage,setTimeout(()=>{D.get("/airport")},5e3)):a.response&&a.response.status===422?(r.value=a.response.data.message,m.errors={coordinates:a.response.data.message}):(m.errors={},r.value=p("failed_to_create_airport_catch"),console.error(p("error_updating_airport"),a))}else m.errors=o},R=o=>{S.value=o};I(async()=>{Object.keys(t).length==0&&await A()});const Z=()=>{const{service_location_id:o}=m,a={};return o?delete a.service_location_id:a.service_location_id=p("service_location_is_required"),c.length===0?a.coordinates=p("at_least_one_completed_polygon_is_required"):delete a.coordinates,a};return I(()=>{if(!s){console.error(p("google_map_api_key_is_null_or_undefined"));return}const o=document.createElement("script");o.src=`https://maps.googleapis.com/maps/api/js?key=${s}&libraries=places,drawing`,o.onload=()=>{U(),z()},document.head.appendChild(o)}),{form:m,successMessage:x,alertMessage:r,handleSubmit:J,serviceLocations:O,search:l,suggestions:y,handleInput:K,selectSuggestion:H,setActiveTab:R,removeAllPolygons:Y,removeSelectedPolygon:X,changeDrawingMode:F,activeTab:S,languages:t}}},re={class:"row"},ce={class:"col-lg-6"},de={class:"card"},ge={class:"card-body"},ue={class:"mb-3"},pe={for:"service_location",class:"form-label"},me={value:"",disabled:""},_e=["value"],ve={key:0,class:"text-danger"},fe={class:"mb-3"},ye={for:"name",class:"form-label"},he={class:"text-end"},be={type:"submit",class:"btn btn-primary"},we={class:"mb-3"},Me={key:0,class:"text-danger"},ke={class:"col-lg-6 col-md-10 col-sm-10"},Ce={class:"card"},xe={class:"card-body"},Oe={class:"autocomplete-container"},Le={class:"input-group"},Pe=["placeholder"],Se={key:0,class:"autocomplete-results"},Te=["onClick"],Ne={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},Ae={class:"d-flex align-items-center"},Fe={class:"card-body"},Ie={class:"d-flex align-items-center"},Be={class:"card-body"},De={class:"d-flex align-items-center"},Ee={class:"card-body"},Ge={class:"d-flex align-items-center"},je={class:"card-body"},qe={key:0,class:"custom-alert alert alert-success alert-border-left fade show",role:"alert",id:"alertMsg"},Ke={class:"alert-content"},Ve={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},He={class:"alert-content"};function ze(n,s,p,t,A,S){const m=P("Head"),x=P("PageHeader"),r=P("BButton"),O=P("Layout");return g(),se(O,null,{default:k(()=>[f(m,{title:"Airport"}),f(x,{title:n.$t("create"),pageTitle:n.$t("airport"),pageLink:"/airport"},null,8,["title","pageTitle"]),e("div",re,[e("div",ce,[e("div",de,[e("div",ge,[e("form",{onSubmit:s[2]||(s[2]=oe((...l)=>t.handleSubmit&&t.handleSubmit(...l),["prevent"]))},[e("div",ue,[e("label",pe,u(n.$t("service_location")),1),N(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":s[0]||(s[0]=l=>t.form.service_location_id=l)},[e("option",me,u(n.$t("select_service_location")),1),(g(!0),v(G,null,E(t.serviceLocations,l=>(g(),v("option",{key:l.id,value:l.id},u(l.name),9,_e))),128))],512),[[te,t.form.service_location_id]]),t.form.errors.service_location_id?(g(),v("span",ve,u(t.form.errors.service_location_id),1)):C("",!0)]),e("div",fe,[e("label",ye,u(n.$t("name")),1),N(e("input",{type:"text",class:"form-control",placeholder:"Enter Name",id:"name","onUpdate:modelValue":s[1]||(s[1]=l=>t.form.name=l),required:""},null,512),[[j,t.form.name]])]),e("div",he,[e("button",be,u(n.$t("save")),1)]),e("div",we,[t.form.errors.coordinates?(g(),v("span",Me,u(t.form.errors.coordinates),1)):C("",!0)])],32)])])]),e("div",ke,[e("div",Ce,[e("div",xe,[e("div",Oe,[e("div",Le,[N(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[3]||(s[3]=l=>t.search=l),placeholder:n.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:s[4]||(s[4]=(...l)=>t.handleInput&&t.handleInput(...l))},null,40,Pe),[[j,t.search]])]),t.suggestions.length>0?(g(),v("div",Se,[(g(!0),v(G,null,E(t.suggestions,l=>(g(),v("div",{key:l.placeId,class:"autocomplete-item",onClick:y=>t.selectSuggestion(l)},u(l.formattedAddress),9,Te))),128))])):C("",!0)]),s[13]||(s[13]=e("div",{id:"map",style:{height:"400px",position:"relative","z-index":"10"}},null,-1)),e("div",Ne,[e("div",Ae,[e("div",Fe,[f(r,{onClick:s[5]||(s[5]=l=>t.changeDrawingMode("grab")),class:"align-center"},{default:k(()=>s[9]||(s[9]=[e("i",{class:"bx bxs-hand-up fs-16"},null,-1)])),_:1,__:[9]})])]),e("div",Ie,[e("div",Be,[f(r,{onClick:s[6]||(s[6]=l=>t.changeDrawingMode("draw")),class:"align-center"},{default:k(()=>s[10]||(s[10]=[e("i",{class:"bx bx-plus fs-16"},null,-1)])),_:1,__:[10]})])]),e("div",De,[e("div",Ee,[f(r,{onClick:t.removeSelectedPolygon,class:"align-center"},{default:k(()=>s[11]||(s[11]=[e("i",{class:"bx bx-x fs-16"},null,-1)])),_:1,__:[11]},8,["onClick"])])]),e("div",Ge,[e("div",je,[f(r,{onClick:t.removeAllPolygons,class:"align-center"},{default:k(()=>s[12]||(s[12]=[e("i",{class:"bx bx-trash fs-16"},null,-1)])),_:1,__:[12]},8,["onClick"])])])])])])])]),t.successMessage?(g(),v("div",qe,[e("div",Ke,[s[14]||(s[14]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[15]||(s[15]=e("strong",null,"Success",-1)),q(" - "+u(t.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[7]||(s[7]=(...l)=>n.dismissMessage&&n.dismissMessage(...l)),"aria-label":"Close Success Message"})])])):C("",!0),t.alertMessage?(g(),v("div",Ve,[e("div",He,[s[16]||(s[16]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[17]||(s[17]=e("strong",null,"Alert",-1)),q(" - "+u(t.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[8]||(s[8]=(...l)=>n.dismissMessage&&n.dismissMessage(...l)),"aria-label":"Close Alert Message"})])])):C("",!0)]),_:1})}const Ze=W(ie,[["render",ze],["__scopeId","data-v-f7f55da2"]]);export{Ze as default};

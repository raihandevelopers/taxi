import{_ as te,Z as oe,C as se,r as v,T as ae,D as le,g as O,o as d,x as ne,w as k,a as q,N as z,k as b,i as u,l as o,n as ie,J as m,q as D,K as re,F as K,L as V,B as I,M as G,y as ce}from"./vendor-ddfbd976.js";import{L as de}from"./main-306a5ea6.js";import{P as ge}from"./page-header-2dc95532.js";import{u as pe}from"./footer-e648049d.js";import"./app-042fb454.js";const ue={components:{Layout:de,PageHeader:ge,Head:oe},props:{airport:Object,googleMapKey:String,successMessage:String,languages:Array,alertMessage:String,app_for:String},setup(i){const{airport:t,googleMapKey:h}=i,{t:a}=se(),{languages:A,fetchData:E}=pe(),x=v("English"),B=v(i.successMessage||""),g=v(i.alertMessage||""),_=ae({service_location_id:t.service_location_id,name:t.name,coordinates:t.coordinates||[]}),l=v([]);let f,P,c=[];const w=v(null),y=v(null),F=async()=>{const e=await q.get("/airport/list");l.value=e.data.results},C=v(""),L=v([]),H=()=>{C.value.length<3?L.value=[]:setTimeout(()=>{J(C.value)},300)},J=e=>{const s="https://places.googleapis.com/v1/places:autocomplete",n={"Content-Type":"application/json","X-Goog-Api-Key":i.googleMapKey,"X-Goog-FieldMask":"suggestions.placePrediction.placeId,suggestions.placePrediction.place,suggestions.placePrediction.text"};fetch(s,{method:"POST",headers:n,body:JSON.stringify({input:e})}).then(r=>r.json()).then(r=>{var M;((M=r.suggestions)==null?void 0:M.length)>0&&(L.value=r.suggestions.filter(S=>S.placePrediction).map(S=>({placeId:S.placePrediction.placeId,formattedAddress:S.placePrediction.text.text})))}).catch(r=>{console.error("Error fetching autocomplete results:",r)})},U=async e=>{const s={"X-Goog-Api-Key":i.googleMapKey,"X-Goog-FieldMask":"viewport,location"};fetch(`https://places.googleapis.com/v1/places/${e.placeId}?fields=viewport,location`,{headers:s}).then(n=>n.json()).then(n=>{C.value="",L.value=[];const p=new google.maps.LatLng(n.location.latitude,n.location.longitude);if(f.setCenter(p),n.viewport&&n.viewport.high&&n.viewport.low){const r=new google.maps.LatLngBounds(new google.maps.LatLng(n.viewport.low.latitude,n.viewport.low.longitude),new google.maps.LatLng(n.viewport.high.latitude,n.viewport.high.longitude));f.fitBounds(r)}else f.setZoom(15)}).catch(n=>{console.error("Error fetching autocomplete results:",n)})},N=()=>{if(t&&t.coordinates){f=new google.maps.Map(document.getElementById("map"),{center:{lat:0,lng:0},zoom:10});const e=new google.maps.LatLngBounds;t.coordinates.forEach(s=>{const n=s[0].map(p=>({lat:p.coordinates[1],lng:p.coordinates[0]}));P=new google.maps.Polygon({paths:n,fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1,map:f}),c.push(P),T(P),P.getPath().forEach(p=>e.extend(p))}),f.fitBounds(e),R()}},T=e=>{google.maps.event.addListener(e,"click",()=>{y.value!==e&&(c.forEach(s=>{s.setOptions({fillColor:"#0000FF",editable:!1})}),e.setOptions({fillColor:"#00FF00",editable:!0}),y.value=e)})},j=e=>{if(w.value){let s=e=="draw"?google.maps.drawing.OverlayType.POLYGON:null;w.value.setDrawingMode(s)}},X=()=>{if(y.value){const e=Z(y.value);e>-1&&(c[e].setMap(null),c.splice(e,1)),y.value=null,j("grab")}},W=()=>{c.forEach(e=>{e.setMap(null),y.value=null}),c=[]},Y=(e,s)=>{const n=e.getPath().getArray().map(r=>({lat:r.lat(),lng:r.lng()})),p=s.getPath().getArray().map(r=>({lat:r.lat(),lng:r.lng()}));return JSON.stringify(n)===JSON.stringify(p)},Z=e=>{for(let s=0;s<c.length;s++)if(Y(e,c[s]))return s;return-1},R=()=>{w.value=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!1,polygonOptions:{fillColor:"#0000FF",fillOpacity:.3,strokeWeight:1,clickable:!0,editable:!1,zIndex:1}}),w.value.setMap(f),google.maps.event.addListener(w.value,"overlaycomplete",function(e){e.type===google.maps.drawing.OverlayType.POLYGON&&(c.push(e.overlay),T(e.overlay))})},Q=async()=>{if(i.app_for=="demo"){Swal.fire(a("error"),a("you_are_not_authorised"),"error");return}const e=$();if(Object.keys(e).length===0)try{if(c.length===0){g.value=a("at_least_one_completed_polygon_is_required");return}const s=c.map(r=>r.getPath().getArray().map(M=>[M.lng(),M.lat()])),n={..._.data(),coordinates:JSON.stringify(s)};(await q.post(`/airport/update/${t.id}`,n)).status===200?(B.value=a("airport_created_successfully"),_.reset(),z.get("/airport")):console.error(a("failed_to_update_airport"))}catch(s){s.response&&s.response.status===403?(g.value=s.response.data.alertMessage,setTimeout(()=>{z.get("/airport")},5e3)):s.response&&s.response.status===422?(g.value=s.response.data.message,_.errors={coordinates:s.response.data.message}):(_.errors={},g.value=a("failed_to_create_airport_catch"),console.error(a("error_updating_airport"),s))}else _.errors=e},$=()=>{const{service_location_id:e}=_,s={};return e?delete s.service_location_id:s.service_location_id=a("service_location_is_required"),s},ee=e=>{x.value=e};return le(async()=>{let e=!1;if(!h){console.error(a("google_map_api_key_is_null_or_undefined"));return}if(Object.keys(A).length==0&&await E(),document.querySelector(`script[src="https://maps.googleapis.com/maps/api/js?key=${h}&libraries=places,drawing"]`))e||(N(),F(),e=!0);else{const s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?key=${h}&libraries=places,drawing`,s.onload=()=>{e||(N(),F(),e=!0)},document.head.appendChild(s)}}),{form:_,serviceLocations:l,handleSubmit:Q,serviceLocations:l,setActiveTab:ee,serviceLocations:l,search:C,suggestions:L,handleInput:H,selectSuggestion:U,alertMessage:g,languages:A,removeAllPolygons:W,removeSelectedPolygon:X,changeDrawingMode:j,activeTab:x}}},me={key:0,class:"row"},_e={class:"col-lg-6"},fe={class:"card"},ve={class:"card-body"},he={class:"mb-3"},ye={for:"service_location",class:"form-label"},be={value:"",disabled:""},we=["value"],Me={key:0,class:"text-danger"},ke={class:"mb-3"},xe={for:"name",class:"form-label"},Pe={class:"text-end"},Ce=["disabled"],Le={class:"mb-3"},Se={key:0,class:"text-danger"},Oe={class:"col-lg-6"},Ie={class:"card"},Ae={class:"card-body"},Be={class:"autocomplete-container"},De={class:"input-group"},Ee=["placeholder"],Fe={key:0,class:"autocomplete-results"},Ne=["onClick"],Te={class:"col-lg-1 col-md-2 col-sm-2",style:{position:"absolute","z-index":"50",top:"20%"}},je={class:"d-flex align-items-center"},qe={class:"card-body"},ze={class:"d-flex align-items-center"},Ke={class:"card-body"},Ve={class:"d-flex align-items-center"},Ge={class:"card-body"},He={class:"d-flex align-items-center"},Je={class:"card-body"},Ue={key:1},Xe={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},We={class:"alert-content"};function Ye(i,t,h,a,A,E){const x=O("Head"),B=O("PageHeader"),g=O("BButton"),_=O("Layout");return d(),ne(_,null,{default:k(()=>[b(x,{title:"Edit Airport"}),b(B,{title:i.$t("edit"),pageTitle:i.$t("airport"),pageLink:"/airport"},null,8,["title","pageTitle"]),h.airport?(d(),u("div",me,[o("div",_e,[o("div",fe,[o("div",ve,[o("form",{onSubmit:t[2]||(t[2]=ie((...l)=>a.handleSubmit&&a.handleSubmit(...l),["prevent"]))},[o("div",he,[o("label",ye,m(i.$t("service_location")),1),D(o("select",{class:"form-select",id:"service_location","onUpdate:modelValue":t[0]||(t[0]=l=>a.form.service_location_id=l)},[o("option",be,m(i.$t("select_service_location")),1),(d(!0),u(K,null,V(a.serviceLocations,l=>(d(),u("option",{key:l.id,value:l.id},m(l.name),9,we))),128))],512),[[re,a.form.service_location_id]]),a.form.errors.service_location_id?(d(),u("span",Me,m(a.form.errors.service_location_id),1)):I("",!0)]),o("div",ke,[o("label",xe,m(i.$t("name")),1),D(o("input",{type:"text",class:"form-control",placeholder:"Enter Name",id:"name","onUpdate:modelValue":t[1]||(t[1]=l=>a.form.name=l),required:""},null,512),[[G,a.form.name]])]),o("div",Pe,[o("button",{type:"submit",class:"btn btn-primary",disabled:h.app_for==="demo"},m(i.$t("update")),9,Ce)]),o("div",Le,[a.form.errors.coordinates?(d(),u("span",Se,m(a.form.errors.coordinates),1)):I("",!0)])],32)])])]),o("div",Oe,[o("div",Ie,[o("div",Ae,[o("div",Be,[o("div",De,[D(o("input",{type:"text",class:"form-control","onUpdate:modelValue":t[3]||(t[3]=l=>a.search=l),placeholder:i.$t("search_for_a_city"),id:"pac-input",autocomplete:"off",onInput:t[4]||(t[4]=(...l)=>a.handleInput&&a.handleInput(...l))},null,40,Ee),[[G,a.search]])]),a.suggestions.length>0?(d(),u("div",Fe,[(d(!0),u(K,null,V(a.suggestions,l=>(d(),u("div",{key:l.placeId,class:"autocomplete-item",onClick:f=>a.selectSuggestion(l)},m(l.formattedAddress),9,Ne))),128))])):I("",!0)]),t[12]||(t[12]=o("div",{id:"map",style:{height:"400px"}},null,-1)),o("div",Te,[o("div",je,[o("div",qe,[b(g,{onClick:t[5]||(t[5]=l=>a.changeDrawingMode("grab")),class:"align-center"},{default:k(()=>t[8]||(t[8]=[o("i",{class:"bx bxs-hand-up fs-16"},null,-1)])),_:1,__:[8]})])]),o("div",ze,[o("div",Ke,[b(g,{onClick:t[6]||(t[6]=l=>a.changeDrawingMode("draw")),class:"align-center"},{default:k(()=>t[9]||(t[9]=[o("i",{class:"bx bx-plus fs-16"},null,-1)])),_:1,__:[9]})])]),o("div",Ve,[o("div",Ge,[b(g,{onClick:a.removeSelectedPolygon,class:"align-center"},{default:k(()=>t[10]||(t[10]=[o("i",{class:"bx bx-x fs-16"},null,-1)])),_:1,__:[10]},8,["onClick"])])]),o("div",He,[o("div",Je,[b(g,{onClick:a.removeAllPolygons,class:"align-center"},{default:k(()=>t[11]||(t[11]=[o("i",{class:"bx bx-trash fs-16"},null,-1)])),_:1,__:[11]},8,["onClick"])])])])])])])])):(d(),u("div",Ue,m(i.$t("lodaing")),1)),a.alertMessage?(d(),u("div",Xe,[o("div",We,[t[13]||(t[13]=o("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[14]||(t[14]=o("strong",null,"Alert",-1)),ce(" - "+m(a.alertMessage)+" ",1),o("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[7]||(t[7]=(...l)=>i.dismissMessage&&i.dismissMessage(...l)),"aria-label":"Close Alert Message"})])])):I("",!0)]),_:1})}const tt=te(ue,[["render",Ye],["__scopeId","data-v-83cb9067"]]);export{tt as default};

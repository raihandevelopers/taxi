import{_ as le,Z as ne,O as ie,P as re,z as de,C as ce,r as _,T as ue,Q as me,R as fe,g as f,o as d,x as V,w as i,U as P,a as $,N as D,k as c,l as e,J as a,q as A,K as q,i as u,L as T,F as I,y as v,B as g,n as Y}from"./vendor-ddfbd976.js";import{L as _e}from"./main-306a5ea6.js";import{P as ve}from"./page-header-2dc95532.js";import{P as ge}from"./Pagination-f095ae3c.js";import{s as pe}from"./search-2c17aadd.js";import{s as he}from"./searchbar-3acbc236.js";import{u as be,l as ye}from"./footer-e648049d.js";import{_ as ke}from"./search-file-ab3e1046.js";import"./app-042fb454.js";const we={data(){return{rightOffcanvas:!1}},components:{Layout:_e,PageHeader:ve,Head:ne,Pagination:ge,Multiselect:ie,flatPickr:re,Link:de,search:pe,searchbar:he},props:{successMessage:String,alertMessage:String,types:Object,serviceLocations:{type:Object,required:!0}},setup(t){const{t:s}=ce(),{selectedLocation:U}=be(),l=_(""),S=ue({approve:1,transport_type:"all",service_location_id:"all",vehicle_type:[],limit:10}),h=_([]),b=_({}),y=_(!1),p=_(!1),j=_(null),x=_(t.types),F=_(t.serviceLocations),k=_({}),H=_(t.successMessage||""),M=_(t.alertMessage||""),L=()=>{H.value="",M.value=""},O=_(!1),E=()=>{C(),p.value=!0,O.value=!1},R=()=>{S.reset(),C(),O.value=!1},z=async n=>{P.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, delete it!"}).then(async r=>{if(r.isConfirmed)try{await o(n)}catch(m){console.error(s("error_deleting_data"),m),P.fire(s("error"),s("failed_to_delete_the_data"),"error")}})},N=()=>{y.value=!1},o=async n=>{try{await $.delete(`/manage-fleet/delete/${n}`);const r=h.value.findIndex(m=>m.id===n);r!==-1&&h.value.splice(r,1),y.value=!1,P.fire(s("success"),s("approved_drivers_deleted_successfully"),"success")}catch{P.fire(s("error"),s("failed_to_delete_approved_drivers"),"error")}},B=_([]),w=_(null),G=async n=>{try{const r=await $.get(`/manage-fleet/listFleetDriver/${n.id}`);console.log("Response fetched:",r),console.log("Drivers:",r.data.drivers),B.value=r.data.drivers,w.value=n,y.value=!0}catch(r){console.error(s("error_fetching_fleet_drivers"),r)}},J=async(n,r)=>{try{const m=await $.post(`/manage-fleet/assign/${n.id}/${r.id}`);m.status===201&&(console.log(m.data.successMessage),alert(m.data.successMessage),N())}catch(m){console.error(s("error_assigning_driver"),m),m.response&&m.response.status===405?(console.error(m.response.data.successMessage),alert(m.response.data.successMessage)):alert(s("an_error_occurred_while_assigning_the_driver"))}},C=async(n=1)=>{try{const r=S.data();l.value.length>0&&(r.search=l.value),r.page=n;const m=await $.get("/manage-fleet/list",{params:r});h.value=m.data.results,b.value=m.data.paginator,ae(b.value.total),p.value=!1}catch(r){console.error(s("error_fetching_approved_drivers"),r)}},K=async n=>{localStorage.setItem("manage-fleets/list",n),C(n)},Q=async n=>{D.get(`/manage-fleet/edit/${n.id}`)},Z=async n=>{D.get(`/manage-fleet/view-profile/${n.id}`)},W=async n=>{D.get(`/manage-fleet/document/${n.id}`)},X=async n=>{l.value=n,C()},ee=n=>(b.value.current_page-1)*b.value.per_page+n+1,se=async n=>{try{await $.post(`/manage-fleet/approve/${n}`,{status:"disapproved"});const r=h.value.findIndex(m=>m.id===n);r!==-1&&h.value.splice(r,1),y.value=!1,P.fire(s("success"),s("fleet_driver_disapproved_successfully"),"success"),D.get("/manage-fleet")}catch{P.fire(s("error"),s("failed_to_disapprove_fleet_driver"),"error")}},te=async n=>{(await $.get(`/manage-fleet/documents/${n.id}`)).data.data=="uploaddocument"?(setTimeout(()=>{M.value=s("failed_to_upload_document")},15e3),D.get(`/manage-fleet/document/${n.id}`)):D.get("/manage-fleet")},ae=()=>{k.value=[10,25,50,100,200,500]},oe=()=>{C()};return me(U,n=>{S.service_location_id=n,C()}),{results:h,modalShow:y,deleteItemId:j,successMessage:H,alertMessage:M,filterData:E,deleteModal:z,closeModal:N,deleteData:o,SerialNumber:ee,fetchSearch:X,dismissMessage:L,serviceLocations:F,paginator:b,modalFilter:p,clearFilter:R,fetchDatas:C,filter:S,types:x,handlePageChanged:K,editData:Q,documentView:W,viewProfile:Z,fleetDriver:G,fleetDrivers:B,fleet:w,assignDriver:J,rightOffcanvas:O,disapprove:se,approveDocument:te,paginatorOption:k,changeEntriesPerPage:oe,selectedLocation:U}},computed:{...ye,...fe(["permissions"])},mounted(){this.filter.service_location_id=this.selectedLocation,this.fetchDatas();const t=localStorage.getItem("manage-fleet/list");t?this.handlePageChanged(Number(t)):this.handlePageChanged(1)}},Ce={class:"d-flex align-items-center mt-3"},xe={class:"me-2 text-muted"},Me=["value"],Be={class:"ms-2 text-muted"},Pe={class:"d-flex align-items-center gap-2"},$e={class:"table-responsive"},De={class:"table align-middle position-relative table-nowrap"},Se={class:"table-active"},Le={scope:"col"},Oe={scope:"col"},Ve={scope:"col"},Fe={scope:"col"},He={scope:"col"},Ne={scope:"col"},Te={scope:"col"},Ie={key:0},Ue={key:0},je=["href"],Ee={key:0,class:"dropdown-menu dropdown-menu-end"},Re=["onClick"],ze=["onClick"],Ae=["onClick"],qe=["onClick"],Ye={key:1},Ge={colspan:"12",class:"text-center"},Je={key:0,class:"modal fade show",tabindex:"-1",role:"dialog"},Ke={class:"modal-dialog modal-xl",role:"document"},Qe={class:"modal-content"},Ze={class:"modal-header"},We={class:"modal-title"},Xe={class:"modal-body"},es={class:"card-header align-items-center d-flex p-3"},ss={class:"card-title mb-0 flex-grow-1"},ts={class:"row row-cols-xxl-5 row-cols-lg-3 row-cols-sm-2 row-cols-1"},as={class:"col"},os={class:"card bg-dark-subtle"},ls={class:"card-body d-flex"},ns={class:"flex-grow-1"},is={class:"text-muted fs-18 mb-0"},rs={class:"col"},ds={class:"card bg-dark-subtle"},cs={class:"card-body d-flex"},us={class:"flex-grow-1"},ms={class:"text-muted fs-18 mb-0"},fs={class:"col"},_s={class:"card bg-dark-subtle"},vs={class:"card-body d-flex"},gs={class:"flex-grow-1"},ps={class:"text-muted fs-18 mb-0"},hs={class:"col"},bs={class:"card bg-dark-subtle"},ys={class:"card-body d-flex"},ks={class:"flex-grow-1"},ws={class:"text-muted fs-18 mb-0"},Cs={class:"col"},xs={class:"card bg-dark-subtle"},Ms={class:"card-body d-flex"},Bs={class:"flex-grow-1"},Ps={class:"text-muted fs-18 mb-0"},$s={class:"card-header align-items-center d-flex p-3"},Ds={class:"card-title mb-0 flex-grow-1"},Ss={class:"table-responsive"},Ls={class:"table align-middle position-relative table-nowrap"},Os={class:"table-active"},Vs=["src"],Fs=["onClick"],Hs={class:"modal-footer"},Ns={key:1,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},Ts={class:"alert-content"},Is={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},Us={class:"alert-content"},js={class:"offcanvas-body"},Es={class:"mb-4"},Rs={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},zs={value:"all"},As={value:"both"},qs={value:"taxi"},Ys={value:"delivery"},Gs={class:"mb-4"},Js={for:"service-location",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Ks={value:"all"},Qs=["value"],Zs={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function Ws(t,s,U,l,S,h){const b=f("Head"),y=f("PageHeader"),p=f("BCol"),j=f("searchbar"),x=f("BButton"),F=f("Link"),k=f("BRow"),H=f("BCardHeader"),M=f("BBadge"),L=f("BCardBody"),O=f("BCard"),E=f("BFrom"),R=f("BOffcanvas"),z=f("Pagination"),N=f("Layout");return d(),V(N,null,{default:i(()=>[c(b,{title:"Manage Fleet"}),c(y,{title:t.$t("manage_fleet"),pageTitle:t.$t("manage_fleet")},null,8,["title","pageTitle"]),c(k,null,{default:i(()=>[c(p,{lg:"12"},{default:i(()=>[c(O,{"no-body":"",id:"tasksList"},{default:i(()=>[c(H,{class:"border-0"},{default:i(()=>[c(k,{class:"g-2"},{default:i(()=>[c(p,{md:"3"},{default:i(()=>[e("div",Ce,[e("label",xe,a(t.$t("show")),1),A(e("select",{"onUpdate:modelValue":s[0]||(s[0]=o=>l.filter.limit=o),onChange:s[1]||(s[1]=(...o)=>l.changeEntriesPerPage&&l.changeEntriesPerPage(...o)),class:"form-select form-select-sm w-auto"},[(d(!0),u(I,null,T(l.paginatorOption,o=>(d(),u("option",{key:o,value:o},a(o),9,Me))),128))],544),[[q,l.filter.limit]]),e("label",Be,a(t.$t("entries")),1)])]),_:1}),c(p,{md:"auto",class:"ms-auto"},{default:i(()=>[e("div",Pe,[c(j,{onSearch:l.fetchSearch},null,8,["onSearch"]),t.permissions.includes("add-fleet")?(d(),V(F,{key:0,href:"/manage-fleet/create"},{default:i(()=>[c(x,{variant:"primary",class:"float-end"},{default:i(()=>[s[9]||(s[9]=e("i",{class:"ri-add-line align-bottom me-1"},null,-1)),v(" "+a(t.$t("add_fleet")),1)]),_:1,__:[9]})]),_:1})):g("",!0)])]),_:1})]),_:1})]),_:1}),c(L,{class:"border border-dashed border-end-0 border-start-0"},{default:i(()=>[e("div",$e,[e("table",De,[e("thead",Se,[e("tr",null,[e("th",Le,a(t.$t("vehicle_type")),1),e("th",Oe,a(t.$t("car_brand")),1),e("th",Ve,a(t.$t("car_model")),1),e("th",Fe,a(t.$t("document_view")),1),e("th",He,a(t.$t("license_plate_number")),1),e("th",Ne,a(t.$t("status")),1),e("th",Te,a(t.$t("action")),1)])]),l.results.length>0?(d(),u("tbody",Ie,[(d(!0),u(I,null,T(l.results,(o,B)=>(d(),u("tr",{key:B},[e("td",null,a(o.vehicle_type_name??"-"),1),e("td",null,a(o.car_make_name),1),e("td",null,a(o.car_model_name),1),t.permissions.includes("view-fleet-document")?(d(),u("td",Ue,[e("a",{href:`/manage-fleet/document/${o.id}`,target:"_blank"},s[10]||(s[10]=[e("i",{class:"bx bxs-file text-primary",style:{"font-size":"35px"}},null,-1)]),8,je)])):g("",!0),e("td",null,a(o.license_number),1),e("td",null,[o.approve?(d(),V(M,{key:0,variant:"success",class:"text-uppercase"},{default:i(()=>[v(a(t.$t("approved")),1)]),_:1})):(d(),V(M,{key:1,variant:"danger",class:"text-uppercase"},{default:i(()=>[v(a(t.$t("blocked")),1)]),_:1}))]),e("td",null,[c(x,{class:"dropdown btn btn-soft-info btn-sm m-2",size:"sm",type:"button"},{default:i(()=>[s[16]||(s[16]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-12"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),t.permissions.includes("fleet-approval")?(d(),u("div",Ee,[t.permissions.includes("fleet-approval")&&!o.approve?(d(),V(F,{key:0,class:"dropdown-item",onClick:Y(w=>l.approveDocument(o),["prevent"])},{default:i(()=>[s[11]||(s[11]=e("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),v(" "+a(t.$t("approve")),1)]),_:2,__:[11]},1032,["onClick"])):g("",!0),t.permissions.includes("fleet-approval")&&o.approve?(d(),u("div",{key:1,class:"dropdown-item",onClick:w=>l.disapprove(o.id)},[s[12]||(s[12]=e("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),v(" "+a(t.$t("disapprove")),1)],8,Re)):g("",!0),t.permissions.includes("edit-fleet")?(d(),u("a",{key:2,class:"dropdown-item",href:"#",onClick:Y(w=>l.editData(o),["prevent"])},[s[13]||(s[13]=e("i",{class:"bx bxs-edit-alt bx-xs text-muted me-2"},null,-1)),v(a(t.$t("edit")),1)],8,ze)):g("",!0),o.approve?(d(),u("a",{key:3,class:"dropdown-item",onClick:w=>l.fleetDriver(o),href:"#"},[s[14]||(s[14]=e("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),v(a(t.$t("assign")),1)],8,Ae)):g("",!0),t.permissions.includes("delete-fleet")?(d(),u("a",{key:4,class:"dropdown-item",href:"#",onClick:Y(w=>l.deleteModal(o.id),["prevent"])},[s[15]||(s[15]=e("i",{class:"bx bx-trash me-2 bx-xs text-muted"},null,-1)),v(a(t.$t("delete")),1)],8,qe)):g("",!0)])):g("",!0)]),_:2,__:[16]},1024)])]))),128))])):(d(),u("tbody",Ye,[e("tr",null,[e("td",Ge,[s[17]||(s[17]=e("img",{src:ke,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,a(t.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[l.modalShow?(d(),u("div",Je,[e("div",Ke,[e("div",Qe,[e("div",Ze,[e("h5",We,a(t.$t("assign_driver")),1),e("button",{type:"button",class:"btn-close",onClick:s[2]||(s[2]=(...o)=>l.closeModal&&l.closeModal(...o))})]),e("div",Xe,[c(k,null,{default:i(()=>[e("div",es,[e("h3",ss,a(t.$t("fleet_details")),1)]),c(L,{class:"px-1 py-5"},{default:i(()=>[c(p,{xl:"12"},{default:i(()=>[e("div",ts,[e("div",as,[e("div",os,[e("div",ls,[e("div",ns,[e("h5",null,a(t.$t("owner")),1),e("h4",is,a(l.fleet.owner_name),1)]),s[18]||(s[18]=e("div",{class:"flex-shrink-0 avatar-sm"},[e("div",{class:"avatar-title bg-warning-subtle text-warning fs-22 rounded"},[e("i",{class:"ri-user-line"})])],-1))])])]),e("div",rs,[e("div",ds,[e("div",cs,[e("div",us,[e("h5",null,a(t.$t("vehicle_type")),1),e("h4",ms,a(l.fleet.vehicle_type_name),1)]),s[19]||(s[19]=e("div",{class:"flex-shrink-0 avatar-sm"},[e("div",{class:"avatar-title bg-success-subtle text-success fs-22 rounded"},[e("i",{class:"ri-car-line"})])],-1))])])]),e("div",fs,[e("div",_s,[e("div",vs,[e("div",gs,[e("h5",null,a(t.$t("vehicle_color")),1),e("h4",ps,a(l.fleet.car_color),1)]),s[20]||(s[20]=e("div",{class:"flex-shrink-0 avatar-sm"},[e("div",{class:"avatar-title bg-info-subtle text-info fs-22 rounded"},[e("i",{class:"ri-car-fill"})])],-1))])])]),e("div",hs,[e("div",bs,[e("div",ys,[e("div",ks,[e("h5",null,a(t.$t("vehicle_make")),1),e("h4",ws,a(l.fleet.car_make_name),1)]),s[21]||(s[21]=e("div",{class:"flex-shrink-0 avatar-sm"},[e("div",{class:"avatar-title bg-danger-subtle text-danger fs-22 rounded"},[e("i",{class:"ri-car-line"})])],-1))])])]),e("div",Cs,[e("div",xs,[e("div",Ms,[e("div",Bs,[e("h5",null,a(t.$t("vehicle_model"))+":",1),e("h4",Ps,a(l.fleet.car_model_name),1)]),s[22]||(s[22]=e("div",{class:"flex-shrink-0 avatar-sm"},[e("div",{class:"avatar-title bg-primary-subtle text-primary fs-22 rounded"},[e("i",{class:"ri-car-line"})])],-1))])])])])]),_:1})]),_:1})]),_:1}),c(k,null,{default:i(()=>[e("div",$s,[e("h3",Ds,a(t.$t("driver_details")),1)]),c(L,{class:"overflow-y-auto",style:{height:"400px"}},{default:i(()=>[c(p,{xl:"12"},{default:i(()=>[e("div",Ss,[e("table",Ls,[e("thead",Os,[e("tr",null,[e("th",null,a(t.$t("profile")),1),e("th",null,a(t.$t("name")),1),e("th",null,a(t.$t("mobile")),1),e("th",null,a(t.$t("email")),1),e("th",null,a(t.$t("action")),1)])]),e("tbody",null,[(d(!0),u(I,null,T(l.fleetDrivers,o=>(d(),u("tr",{key:o.id},[e("td",null,[e("img",{src:o.profile_picture||"/assets/images/users/user-dummy-img.jpg",alt:"driver",class:"img-thumbnail rounded-circle shadow-none",width:"50",height:"50"},null,8,Vs)]),e("td",null,a(o.name),1),e("td",null,a(o.mobile),1),e("td",null,a(o.email),1),e("td",null,[e("button",{onClick:B=>l.assignDriver(l.fleet,o),class:"btn btn-primary"},a(t.$t("assign")),9,Fs)])]))),128))])])])]),_:1})]),_:1})]),_:1})]),e("div",Hs,[e("button",{type:"button",class:"btn btn-danger",onClick:s[3]||(s[3]=(...o)=>l.closeModal&&l.closeModal(...o))},"Close")])])])])):g("",!0),l.successMessage?(d(),u("div",Ns,[e("div",Ts,[s[23]||(s[23]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[24]||(s[24]=v()),s[25]||(s[25]=e("strong",null,"Success",-1)),v(" - "+a(l.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[4]||(s[4]=(...o)=>l.dismissMessage&&l.dismissMessage(...o)),"aria-label":"Close Success Message"})])])):g("",!0),l.alertMessage?(d(),u("div",Is,[e("div",Us,[s[26]||(s[26]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[27]||(s[27]=v()),s[28]||(s[28]=e("strong",null,"Alert",-1)),v(" - "+a(l.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[5]||(s[5]=(...o)=>l.dismissMessage&&l.dismissMessage(...o)),"aria-label":"Close Alert Message"})])])):g("",!0)]),c(R,{modelValue:l.rightOffcanvas,"onUpdate:modelValue":s[8]||(s[8]=o=>l.rightOffcanvas=o),placement:"end",title:t.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:i(()=>[c(E,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:i(()=>[e("div",js,[e("div",Es,[e("label",Rs,a(t.$t("transport_type")),1),A(e("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":s[6]||(s[6]=o=>l.filter.transport_type=o)},[e("option",zs,a(t.$t("all")),1),e("option",As,a(t.$t("both")),1),e("option",qs,a(t.$t("taxi")),1),e("option",Ys,a(t.$t("delivery")),1)],512),[[q,l.filter.transport_type]])]),e("div",Gs,[e("label",Js,a(t.$t("service_locations")),1),A(e("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"service-location","onUpdate:modelValue":s[7]||(s[7]=o=>l.filter.service_location_id=o)},[e("option",Ks,a(t.$t("all")),1),(d(!0),u(I,null,T(l.serviceLocations,(o,B)=>(d(),u("option",{key:o.id,value:o.id},a(o.name),9,Qs))),128))],512),[[q,l.filter.service_location_id]])])]),e("div",Zs,[c(x,{onClick:l.clearFilter,variant:"light",class:"w-100"},{default:i(()=>[v(a(t.$t("clear_filter")),1)]),_:1},8,["onClick"]),c(x,{onClick:l.filterData,type:"submit",variant:"success",class:"w-100"},{default:i(()=>[v(a(t.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),c(z,{paginator:l.paginator,onPageChanged:l.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const rt=le(we,[["render",Ws]]);export{rt as default};

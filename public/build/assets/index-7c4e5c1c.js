import{_ as te,Z as ae,O as se,P as ie,z as oe,C as le,r as f,T as ne,Q as Y,D as re,a as G,R as de,g as c,o as m,x as J,w as d,U as A,N as ce,k as n,l as e,J as o,q as C,K as me,i as u,L as K,F as Q,p as B,B as k,y as v,n as Z,W as T}from"./vendor-ddfbd976.js";import{L as _e}from"./dispatchmain-37fc6bfb.js";import{P as fe}from"./page-header-2dc95532.js";import{P as ue}from"./Pagination-f095ae3c.js";import{s as ve}from"./search-2c17aadd.js";import{s as pe}from"./searchbar-3acbc236.js";import{u as be}from"./footer-e648049d.js";import{_ as ge}from"./search-file-ab3e1046.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const he={data(){return{rightOffcanvas:!1}},components:{Layout:_e,PageHeader:fe,Head:ae,Pagination:ue,Multiselect:se,flatPickr:ie,Link:oe,search:ve,searchbar:pe},props:{successMessage:String,alertMessage:String,zones:Object,firebaseConfig:Object,ongoing_rides:Object,enable_outstation:Boolean,types:Object,serviceLocations:{type:Object,required:!0}},methods:{navigateToInvoice(i,t){const w=`/dispatcher/rides_request/download-invoice/${t}?invoice_type=${i}`;window.location.href=w},navigateUserInvoice(i){this.navigateToInvoice("user",i)},navigateDriverInvoice(i){this.navigateToInvoice("driver",i)}},setup(i){const{t}=le(),w=f(""),s=f("all"),g=ne({ride_status:"all",is_bid_ride:null,zone_id:null,vehicle_type_id:null,is_paid:null,service_location_id:null,limit:10,payment_opt:null}),P=f(i.zones),H=f(i.types),R=f(i.ongoing_rides),r=f([]),x=f({}),M=f(!1),S=f(!1),F=f(null),D=f(i.successMessage||""),U=f(i.alertMessage||""),z=f({}),{selectedLocation:L}=be(),V=f([]),j=()=>{D.value="",U.value=""},O=f(!1),E=()=>{h(),S.value=!0,O.value=!1},N=()=>{g.reset(),h(),S.value=!1,O.value=!1};Y(s,l=>{g.ride_status=l,h()}),re(async()=>{try{const l=i.firebaseConfig;firebase.apps.length||firebase.initializeApp(l);const _=firebase.database();R.value.forEach(p=>{_.ref(`requests/${p}`).on("value",function(ee){const y=r.value.findIndex(b=>b.id===p);if(y!==-1){const b=ee.val();b.is_completed&&(r.value[y].is_completed=!0),b.accept!==1&&(r.value[y].driver_id=null),b.driver_id&&(r.value[y].driver_id=b.driver_id),b.hasOwnProperty("modified_by_driver")&&(r.value[y].is_driver_started=1),b.trip_arrived==1&&(r.value[y].is_driver_arrived=!0),b.trip_start==1&&(r.value[y].is_trip_start=!0),b.is_completed&&(r.value[y].is_completed=!0),(b.is_cancelled||b.is_cancel)&&(r.value[y].is_cancelled=!0)}})}),g.service_location_id=L,V.value=P.value.filter(p=>p.service_location_id==g.service_location_id),h()}catch(l){console.error(t("error_initializing_firebase_or_fetching_settings"),l)}}),Y(L,l=>{console.log("filter.service_location_id",g.service_location_id),g.service_location_id=l,V.value=P.value.filter(_=>_.service_location_id==g.service_location_id),h()});const a=()=>{M.value=!1},I=async l=>{try{const _=await G.get(`/dispatcher/rides_request/cancel/${l}`),p=r.value.findIndex(W=>W.id===l);p!==-1&&(r.value[p]=_.data.request),M.value=!1,A.fire(t("success"),t("trip_cancelled_successfully"),"success")}catch(_){console.log(_),A.fire(t("error"),t("failed_to_cancel_trip"),"error")}},q=async l=>{A.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async _=>{if(_.isConfirmed)try{await I(l)}catch(p){console.error(t("error_deleting_data"),p),A.fire(t("error"),t("failed_to_cancel_the_data"),"error")}})},X=async l=>{w.value=l,h()},h=async(l=1)=>{try{const _=g.data();w.value.length>0&&(_.search=w.value),_.page=l;const p=await G.get("/dispatcher/rides_request/list",{params:_});r.value=p.data.results,x.value=p.data.paginator,$(x.value.total),S.value=!1}catch(_){console.error(t("error_fetching_requests"),_)}},$=()=>{z.value=[10,25,50,100,200,500]};return{results:r,modalShow:M,deleteItemId:F,successMessage:D,alertMessage:U,filterData:E,deleteModal:q,closeModal:a,deleteData:I,dismissMessage:j,searchTerm:w,paginator:x,modalFilter:S,clearFilter:N,fetchDatas:h,filter:g,zones:P,types:H,rideStatus:l=>l.is_cancelled?"Cancelled":l.is_completed?"Completed":l.is_trip_start?"On Trip":l.is_driver_arrived?"Driver Arrived":l.is_later&&l.is_driver_started?"Driver Started":l.is_driver_started?"Accepted":l.is_later?"Upcoming":"Searching",handlePageChanged:async l=>{h(l)},editData:async l=>{ce.get(`/dispatcher/rides_request/view/${l.id}`)},activeTab:s,fetchSearch:X,rightOffcanvas:O,paginatorOption:z,changeEntriesPerPage:()=>{h()},zoneList:V}},computed:{...de(["permissions"])}},ye={class:"d-flex align-items-center mt-3"},ke={class:"me-2 text-muted"},we=["value"],Ce={class:"ms-2 text-muted"},Be={class:"card-header"},Me={class:"row align-items-center"},Se={class:"col"},Te={class:"nav nav-tabs-custom card-header-tabs border-bottom-0",role:"tablist"},Pe={class:"nav-item",role:"presentation"},Ve={class:"nav-item",role:"presentation"},xe={class:"nav-item",role:"presentation"},De={class:"nav-item",role:"presentation"},Oe={key:0,class:"nav-item",role:"presentation"},qe={class:"nav-item",role:"presentation"},Ue={class:"d-flex align-items-center gap-2"},ze={class:"table-responsive"},Le={class:"table align-middle position-relative table-nowrap"},Ie={class:"table-active"},Ae={scope:"col"},He={scope:"col"},Re={scope:"col"},Fe={scope:"col"},je={scope:"col"},Ee={scope:"col"},Ne={scope:"col"},We={scope:"col"},Ye={key:0},Ge={class:"dropdown"},Je={class:"dropdown-menu dropdown-menu-end"},Ke=["onClick"],Qe={key:1},Ze=["onClick"],Xe={key:2},$e={key:3},et=["onClick"],tt=["onClick"],at={key:1},st={colspan:"10",class:"text-center"},it={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},ot={class:"alert-content"},lt={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},nt={class:"alert-content"},rt={class:"offcanvas-body"},dt={class:"mb-4"},ct={for:"zone-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},mt={class:"mb-4"},_t={for:"vehicle_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},ft={class:"mb-4"},ut={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},vt={class:"form-check form-check-inline"},pt={class:"form-check-label",for:"not_paid"},bt={class:"form-check form-check-inline"},gt={class:"form-check-label",for:"paid"},ht={class:"mb-4"},yt={for:"dispatch-type-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},kt={class:"form-check form-check-inline"},wt={class:"form-check-label",for:"normal"},Ct={class:"form-check form-check-inline"},Bt={class:"form-check-label",for:"bidding"},Mt={class:"mb-4"},St={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Tt={class:"form-check form-check-inline"},Pt={class:"form-check-label",for:"card"},Vt={class:"form-check form-check-inline"},xt={class:"form-check-label",for:"cash"},Dt={class:"form-check form-check-inline"},Ot={class:"form-check-label",for:"wallet"},qt={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function Ut(i,t,w,s,g,P){const H=c("Head"),R=c("PageHeader"),r=c("BCol"),x=c("searchbar"),M=c("BButton"),S=c("BRow"),F=c("BCardHeader"),D=c("BBadge"),U=c("Link"),z=c("BCardBody"),L=c("BCard"),V=c("Multiselect"),j=c("BFrom"),O=c("BOffcanvas"),E=c("Pagination"),N=c("Layout");return m(),J(N,null,{default:d(()=>[n(H,{title:"Rides Request"}),n(R,{title:i.$t("index"),pageTitle:i.$t("ride_request")},null,8,["title","pageTitle"]),n(S,null,{default:d(()=>[n(r,{lg:"12"},{default:d(()=>[n(L,{"no-body":"",id:"tasksList"},{default:d(()=>[n(F,{class:"border-0"},{default:d(()=>[n(S,{class:"g-2"},{default:d(()=>[n(r,{md:"3"},{default:d(()=>[e("div",ye,[e("label",ke,o(i.$t("show")),1),C(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>s.filter.limit=a),onChange:t[1]||(t[1]=(...a)=>s.changeEntriesPerPage&&s.changeEntriesPerPage(...a)),class:"form-select form-select-sm w-auto"},[(m(!0),u(Q,null,K(s.paginatorOption,a=>(m(),u("option",{key:a,value:a},o(a),9,we))),128))],544),[[me,s.filter.limit]]),e("label",Ce,o(i.$t("entries")),1)])]),_:1}),n(r,{md:"6"},{default:d(()=>[e("div",Be,[e("div",Me,[e("div",Se,[e("ul",Te,[e("li",Pe,[e("a",{class:B(["nav-link fw-semibold btn",{active:s.activeTab==="all"}]),onClick:t[2]||(t[2]=a=>s.activeTab="all"),role:"tab","aria-selected":"false"},o(i.$t("all")),3)]),e("li",Ve,[e("a",{class:B(["nav-link fw-semibold btn",{active:s.activeTab==="completed"}]),onClick:t[3]||(t[3]=a=>s.activeTab="completed"),role:"tab","aria-selected":"false"},o(i.$t("completed")),3)]),e("li",xe,[e("a",{class:B(["nav-link fw-semibold btn",{active:s.activeTab==="cancelled"}]),onClick:t[4]||(t[4]=a=>s.activeTab="cancelled"),role:"tab","aria-selected":"true"},o(i.$t("cancelled")),3)]),e("li",De,[e("a",{class:B(["nav-link fw-semibold btn",{active:s.activeTab==="upcoming"}]),onClick:t[5]||(t[5]=a=>s.activeTab="upcoming"),role:"tab","aria-selected":"true"},o(i.$t("upcoming")),3)]),w.enable_outstation?(m(),u("li",Oe,[e("a",{class:B(["nav-link fw-semibold btn",{active:s.activeTab==="outstation"}]),onClick:t[6]||(t[6]=a=>s.activeTab="outstation"),role:"tab","aria-selected":"true"},o(i.$t("outstation")),3)])):k("",!0),e("li",qe,[e("a",{class:B(["nav-link fw-semibold btn",{active:s.activeTab==="ontrip"}]),onClick:t[7]||(t[7]=a=>s.activeTab="ontrip"),role:"tab","aria-selected":"true"},o(i.$t("on_trip")),3)])])])])])]),_:1}),n(r,{md:"auto",class:"ms-auto"},{default:d(()=>[e("div",Ue,[n(x,{onSearch:s.fetchSearch},null,8,["onSearch"]),n(M,{variant:"danger",onClick:t[8]||(t[8]=a=>s.rightOffcanvas=!0)},{default:d(()=>[t[21]||(t[21]=e("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),v(" "+o(i.$t("filters")),1)]),_:1,__:[21]})])]),_:1})]),_:1})]),_:1}),n(z,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[e("div",ze,[e("table",Le,[e("thead",Ie,[e("tr",null,[e("th",Ae,o(i.$t("request_id")),1),e("th",He,o(i.$t("date")),1),e("th",Re,o(i.$t("user_name")),1),e("th",Fe,o(i.$t("driver_name")),1),e("th",je,o(i.$t("transport_type")),1),e("th",Ee,o(i.$t("trip_status")),1),e("th",Ne,o(i.$t("payment_option")),1),e("th",We,o(i.$t("action")),1)])]),s.results.length>0?(m(),u("tbody",Ye,[(m(!0),u(Q,null,K(s.results,(a,I)=>(m(),u("tr",{key:I},[e("td",null,o(a.request_number),1),e("td",null,o(a.converted_updated_at),1),e("td",null,o(a.user_name?a.user_name:"----"),1),e("td",null,o(a.driver_name?a.driver_name:"----"),1),e("td",null,o(a.transport_type=="taxi"?"Taxi":"Delivery")+" "+o(a.is_bid_ride?i.$t("bidding"):""),1),e("td",null,[n(D,{class:B({"text-uppercase":!0,"text-bg-success":s.rideStatus(a)==="Completed"||s.rideStatus(a)==="Accepted"||s.rideStatus(a)==="Driver Started","text-bg-danger":s.rideStatus(a)==="Cancelled","text-bg-info":s.rideStatus(a)==="On Trip","text-bg-warning":s.rideStatus(a)==="Upcoming"||s.rideStatus(a)==="Driver Arrived"||s.rideStatus(a)==="Searching"})},{default:d(()=>[v(o(s.rideStatus(a)),1)]),_:2},1032,["class"])]),e("td",null,[n(D,{class:B({"text-uppercase":!0,"text-bg-success":a.is_paid,"text-bg-danger":!a.is_paid})},{default:d(()=>[v(o(a.payment_opt==1?"Cash":a.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",Ge,[t[27]||(t[27]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",Je,[i.permissions.includes("dispatcher-ride-request-view")?(m(),u("div",{key:0,class:"dropdown-item",type:"button",onClick:Z(q=>s.editData(a),["prevent"])},[t[22]||(t[22]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),v(" "+o(i.$t("view")),1)],8,Ke)):k("",!0),i.permissions.includes("dispatcher-ride-request-cancel")?(m(),u("div",Qe,[!a.is_cancelled&&!a.is_completed?(m(),u("div",{key:0,class:"dropdown-item",type:"button",onClick:Z(q=>s.deleteModal(a.id),["prevent"])},[t[23]||(t[23]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),v(" "+o(i.$t("cancel")),1)],8,Ze)):k("",!0)])):k("",!0),i.permissions.includes("dispatcher-ride-request-assign")?(m(),u("div",Xe,[!a.driver_id&&!a.is_cancelled&&!a.is_completed?(m(),J(U,{key:0,class:"dropdown-item",type:"button",href:`ongoing_request/assign/${a.id}`},{default:d(()=>[t[24]||(t[24]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),v(" "+o(i.$t("assign")),1)]),_:2,__:[24]},1032,["href"])):k("",!0)])):k("",!0),a.is_completed?(m(),u("div",$e,[e("button",{onClick:q=>P.navigateUserInvoice(a.id),class:"dropdown-item"},[t[25]||(t[25]=e("i",{class:"bx bx-file align-center text-muted me-2"},null,-1)),v(" "+o(i.$t("Download User Invoice")),1)],8,et),e("button",{onClick:q=>P.navigateDriverInvoice(a.id),class:"dropdown-item"},[t[26]||(t[26]=e("i",{class:"bx bx-file align-center text-muted me-2"},null,-1)),v(" "+o(i.$t("Download Driver Invoice")),1)],8,tt)])):k("",!0)])])])]))),128))])):(m(),u("tbody",at,[e("tr",null,[e("td",st,[t[28]||(t[28]=e("img",{src:ge,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,o(i.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[s.successMessage?(m(),u("div",it,[e("div",ot,[t[29]||(t[29]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[30]||(t[30]=v()),t[31]||(t[31]=e("strong",null,"Success",-1)),v(" - "+o(s.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:t[9]||(t[9]=(...a)=>s.dismissMessage&&s.dismissMessage(...a)),"aria-label":"Close Success Message"})])])):k("",!0),s.alertMessage?(m(),u("div",lt,[e("div",nt,[t[32]||(t[32]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),t[33]||(t[33]=v()),t[34]||(t[34]=e("strong",null,"Alert",-1)),v(" - "+o(s.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:t[10]||(t[10]=(...a)=>s.dismissMessage&&s.dismissMessage(...a)),"aria-label":"Close Alert Message"})])])):k("",!0)]),n(O,{modelValue:s.rightOffcanvas,"onUpdate:modelValue":t[20]||(t[20]=a=>s.rightOffcanvas=a),placement:"end",title:i.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:d(()=>[n(j,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:d(()=>[e("div",rt,[e("div",dt,[e("label",ct,o(i.$t("zone")),1),n(V,{modelValue:s.filter.zone_id,"onUpdate:modelValue":t[11]||(t[11]=a=>s.filter.zone_id=a),id:"zone_id",mode:"tags",options:s.zoneList.map(a=>({value:a.id,label:a.name})),"close-on-select":!1,multiple:!0,searchable:!0,placeholder:i.$t("select_a_zone"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",mt,[e("label",_t,o(i.$t("vehicle_type")),1),n(V,{id:"vehicle_type_id",mode:"tags",modelValue:s.filter.vehicle_type_id,"onUpdate:modelValue":t[12]||(t[12]=a=>s.filter.vehicle_type_id=a),options:s.types.map(a=>({value:a.id,label:a.name})),"close-on-select":!1,searchable:!0,placeholder:i.$t("select_vehicle_type"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",ft,[e("label",ut,o(i.$t("payment_status")),1),e("div",null,[e("div",vt,[C(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"not_paid",value:"1","onUpdate:modelValue":t[13]||(t[13]=a=>s.filter.is_paid=a)},null,512),[[T,s.filter.is_paid]]),e("label",pt,o(i.$t("paid")),1)]),e("div",bt,[C(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"paid",value:"0","onUpdate:modelValue":t[14]||(t[14]=a=>s.filter.is_paid=a)},null,512),[[T,s.filter.is_paid]]),e("label",gt,o(i.$t("not_paid")),1)])])]),e("div",ht,[e("label",yt,o(i.$t("ride_type")),1),e("div",null,[e("div",kt,[C(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"normal",value:"0","onUpdate:modelValue":t[15]||(t[15]=a=>s.filter.is_bid_ride=a)},null,512),[[T,s.filter.is_bid_ride]]),e("label",wt,o(i.$t("regural")),1)]),e("div",Ct,[C(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"bidding",value:"1","onUpdate:modelValue":t[16]||(t[16]=a=>s.filter.is_bid_ride=a)},null,512),[[T,s.filter.is_bid_ride]]),e("label",Bt,o(i.$t("bidding")),1)])])]),e("div",Mt,[e("label",St,o(i.$t("payment_option")),1),e("div",null,[e("div",Tt,[C(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"card",value:"0","onUpdate:modelValue":t[17]||(t[17]=a=>s.filter.payment_opt=a)},null,512),[[T,s.filter.payment_opt]]),e("label",Pt,o(i.$t("card")),1)]),e("div",Vt,[C(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"cash",value:"1","onUpdate:modelValue":t[18]||(t[18]=a=>s.filter.payment_opt=a)},null,512),[[T,s.filter.payment_opt]]),e("label",xt,o(i.$t("cash")),1)]),e("div",Dt,[C(e("input",{class:"form-check-input",type:"radio",name:"payment_opt",id:"wallet",value:"2","onUpdate:modelValue":t[19]||(t[19]=a=>s.filter.payment_opt=a)},null,512),[[T,s.filter.payment_opt]]),e("label",Ot,o(i.$t("wallet")),1)])])]),t[35]||(t[35]=e("div",null,null,-1))]),e("div",qt,[n(M,{variant:"light",onClick:s.clearFilter,class:"w-100"},{default:d(()=>[v(o(i.$t("clear_filter")),1)]),_:1},8,["onClick"]),n(M,{type:"submit",onClick:s.filterData,variant:"success",class:"w-100"},{default:d(()=>[v(o(i.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),n(E,{paginator:s.paginator,onPageChanged:s.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const Kt=te(he,[["render",Ut]]);export{Kt as default};

import{_ as ie,O as re,C as ce,r,T as de,Q as _e,X as k,D as fe,a2 as ue,g as v,o as L,x as te,w as f,k as o,l as a,J as u,y as K,i as I,F as pe,L as me,B as Q}from"./vendor-ddfbd976.js";import{L as ge}from"./dispatchmain-37fc6bfb.js";import{P as he}from"./page-header-2dc95532.js";import"./footer-e648049d.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const ve={data(){return{rightOffcanvas:!1}},components:{Layout:ge,PageHeader:he,Multiselect:re},props:{firebaseSettings:Object,service_location:Array,vehicle_type:Array,default_lat:String,app_for:String,default_lng:String},setup(s){var Y,ee;const{t:h}=ce(),w=r(null),p=r(""),E=de({all:"",locked:""}),W=r([]),R=r({}),q=r(!1),z=r(parseFloat(s.default_lat)),H=r(parseFloat(s.default_lng)),V=r(!1),n=r([]),B=r([]),$=r(s.service_location.map(t=>({value:t.id,label:t.name}))),G=r(s.vehicle_type.map(t=>({value:t.id,label:t.name}))),j=r((ee=(Y=$.value)==null?void 0:Y[0])==null?void 0:ee.value),l=()=>{V.value=!0},se=()=>{E.reset(),fetchDatas(),V.value=!1};_e([w,n],()=>{D()});let A,i={};const ae=()=>{A=k.map("map").setView({lat:z.value,lng:H.value},15),k.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(A);var t={apiKey:s.firebaseSettings.firebase_api_key,authDomain:s.firebaseSettings.firebase_auth_domain,databaseURL:s.firebaseSettings.firebase_database_url,projectId:s.firebaseSettings.firebase_project_id,storageBucket:s.firebaseSettings.firebase_storage_bucket,messagingSenderId:s.firebaseSettings.firebase_messaging_sender_id,appId:s.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(t),D()},le=()=>{w.value=null,n.value=[],D()},oe=()=>{console.log(n.value),D()},D=()=>{const t=firebase.database().ref("drivers");B.value=[],t.on("value",c=>{c.forEach(d=>{const e=d.val(),b=Z(e.g);if(b){const M=[b.lat,b.lon];let F=n.value.length>0?n.value.includes("online"):!0,O=n.value.length>0?n.value.includes("onride"):!0,N=n.value.length>0?n.value.includes("offline"):!0,y="",S="offline",m="";if(e.hasOwnProperty("is_active")&&e.hasOwnProperty("is_available")){if(e.is_active==1&&e.is_available==!0&&F)y=`/image/map/${e.vehicle_type_icon}.png`,S="online";else if(e.is_active==1&&e.is_available==!1&&O)y=`/image/map/${e.vehicle_type_icon}.png`,S="onride";else if(N){y=`/image/map/${e.vehicle_type_icon}.png`;let g=new Date-new Date(e.updated_at),_=parseInt(g/6e4),T=0,C=0,P=0;_>59&&(T=parseInt(_/60),T>23&&(C=parseInt(T/24),C>6&&(P=parseInt(C/7)))),_<=1&&(m="just now"),_>1&&_<59&&(m=_+" minutes ago"),T==1&&(m="An hour ago"),T>1&&(m=T+" hours ago"),C==1&&(m="A day ago"),C>1&&(m=C+" days ago"),P==1&&(m="A week ago"),P>1&&(m=P+" weeks ago")}}let U=!!e.service_location_id;j.value&&(U=j.value==e.service_location_id);let x=Array.isArray(e.vehicle_types);if(w.value&&Array.isArray(e.vehicle_types)&&e.vehicle_types.length>0&&(x=(Array.isArray(e.vehicle_types)&&e.vehicle_types.some(g=>w.value===g))??!1),y.length>0&&x&&U)if(i[e.id])J(i[e.id],i[e.id].getLatLng(),M),i[e.id].setIcon(k.icon({iconUrl:y,iconSize:[30,30]}));else{const g=k.marker(M,{icon:k.icon({iconUrl:y,iconSize:[30,30]})}).addTo(A);g.bindTooltip(`<strong>${e.name}</strong><br>Mobile: ${s.app_for=="demo"?"**********":e.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),i[e.id]=g,J(g,g.getLatLng(),M),e.status=S,e.last_seen=m,B.value.push(e)}else X(e.id)}})}),t.on("child_changed",c=>{const d=c.val();ne(d)}),t.on("child_removed",c=>{const d=c.val();X(d.id)})},J=(t,c,d)=>{t.setLatLng(d).update()},ne=t=>{const c=Z(t.g);if(c){const d=[c.lat,c.lon],e=`/image/map/${t.vehicle_type_icon}.png`;if(i[t.id])J(i[t.id],i[t.id].getLatLng(),d),i[t.id].setIcon(k.icon({iconUrl:e,iconSize:[30,30]}));else{const b=k.marker(d,{icon:k.icon({iconUrl:e,iconSize:[30,30]})}).addTo(A);i[t.id]=b}}else console.error(`${h("failed_to_decode_geohash")} ${t.id}`)},X=t=>{i[t]&&(A.removeLayer(i[t]),delete i[t])},Z=t=>{const c="0123456789bcdefghjkmnpqrstuvwxyz",d=[16,8,4,2,1];let e=!0,b=-90,M=90,F=-180,O=180,N,y;if(t){for(let S=0;S<t.length;S++){let m=t.charAt(S),U=c.indexOf(m);for(let x=0;x<5;x++){let g=d[x];if(e){let _=(F+O)/2;U&g?F=_:O=_}else{let _=(b+M)/2;U&g?b=_:M=_}e=!e}}return N=(b+M)/2,y=(F+O)/2,{lat:N,lon:y}}return null};return fe(()=>{ae()}),{fetchData:ue.debounce(D,300),results:W,paginator:R,filter:E,searchTerm:p,serviceLocations:$,vehicleTypes:G,drivers_list:B,selectedVehicleTypes:w,filterData:l,clearFilter:se,clearFilters:le,applyFilters:oe,modalShow:q,modalFilter:V,selectedModes:n}}},be={class:"row"},ye={class:"col-12 col-lg-3"},ke={class:"mb-3"},Le={for:"select_mode",class:"form-label"},we={class:"col-12 col-lg-3"},Be={class:"mb-3"},Me={for:"vehicle_type",class:"form-label"},Se={class:"col-12 col-lg-12 d-flex gap-1"},xe={key:0,class:"overflow-auto",style:{height:"400px"}},Te={class:"accordion-item border-0"},Ce={class:"accordion-header",id:"headingThree"},Ie={class:"accordion-button p-2 shadow-none","data-bs-toggle":"collapse",href:"#","aria-expanded":"false","aria-controls":"collapseThree"},Ve={class:"d-flex align-items-center"},$e={class:"flex-shrink-0 border border-4 rounded-circle",style:{border:"var(--landing_header_act_text)"}},Ae=["src"],De={class:"d-flex justify-content-around"},Fe={class:"flex-grow-1 ms-3"},Oe={class:"fs-15 mb-1 fw-semibold",style:{color:"var(--landing_header_act_text)"}},Ue={class:"fs-15 mb-1 fw-normal",style:{color:"var(--landing_header_act_text)"}},ze={class:"fs-15 mb-1 fw-normal"},He={class:"text-end ms-5 d-block"},je={key:0,class:"fs-15 mb-1 fw-semibold text-danger"},Ne={key:1,class:"fs-15 mb-1 fw-semibold text-success"},Pe={key:2,class:"fs-15 mb-1 fw-semibold text-primary"},Ee={class:"flex-grow-1 fs-15 mb-1 text-muted mt-5"},Re={key:1,class:"d-flex",style:{height:"400px"}},qe={id:"map",style:{height:"400px"}};function Ge(s,h,w,p,E,W){const R=v("Head"),q=v("PageHeader"),z=v("Multiselect"),H=v("BButton"),V=v("BCardHeader"),n=v("BCard"),B=v("BCol"),$=v("BRow"),G=v("BCardBody"),j=v("Layout");return L(),te(j,null,{default:f(()=>[o(R,{title:s.$t("gods-eye")},null,8,["title"]),o(q,{title:s.$t("gods-eye"),pageTitle:s.$t("dispatch")},null,8,["title","pageTitle"]),o($,null,{default:f(()=>[o(B,{lg:"12"},{default:f(()=>[o(n,{"no-body":"",id:"tasksList"},{default:f(()=>[o(V,{class:"border-0"},{default:f(()=>[a("div",be,[a("div",ye,[a("div",ke,[a("label",Le,u(s.$t("drivers")),1),o(z,{id:"select_mode",mode:"tags","close-on-select":!1,searchable:!0,"create-option":!1,modelValue:p.selectedModes,"onUpdate:modelValue":h[0]||(h[0]=l=>p.selectedModes=l),options:[{value:"offline",label:s.$t("offline")},{value:"online",label:s.$t("online")},{value:"onride",label:s.$t("onride")}],placeholder:s.$t("select_mode")},null,8,["modelValue","options","placeholder"])])]),a("div",we,[a("div",Be,[a("label",Me,u(s.$t("vehicle_types")),1),o(z,{modelValue:p.selectedVehicleTypes,"onUpdate:modelValue":h[1]||(h[1]=l=>p.selectedVehicleTypes=l),options:p.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:s.$t("select_vehicle_types"),id:"select_service_location"},null,8,["modelValue","options","placeholder"])])]),a("div",Se,[o(H,{type:"button",variant:"success",class:"btn btn-md",onClick:p.applyFilters},{default:f(()=>[K(u(s.$t("apply")),1)]),_:1},8,["onClick"]),o(H,{type:"button",variant:"danger",class:"btn btn-md",onClick:p.clearFilters},{default:f(()=>[K(u(s.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),o(G,{class:"border border-dashed border-end-0 border-start-0"},{default:f(()=>[o($,null,{default:f(()=>[o(B,{lg:"4"},{default:f(()=>[p.drivers_list.length>0?(L(),I("div",xe,[(L(!0),I(pe,null,me(p.drivers_list,l=>(L(),te(n,{class:"col-lg-12"},{default:f(()=>[a("div",Te,[a("div",Ce,[a("a",Ie,[a("div",Ve,[a("div",$e,[a("img",{src:l.profile_picture,alt:"",class:"avatar-md rounded-circle"},null,8,Ae)]),a("div",De,[a("div",Fe,[a("h4",Oe,u(l.name),1),a("h6",Ue,u(w.app_for=="demo"?"*********":l.mobile),1),a("h6",ze,[K(u(l.rating)+" ",1),h[2]||(h[2]=a("i",{class:"ri-star-fill text-warning align-bottom me-1"},null,-1))])]),a("div",He,[l.status=="offline"?(L(),I("h4",je,u(l.status),1)):Q("",!0),l.status=="online"?(L(),I("h4",Ne,u(l.status),1)):Q("",!0),l.status=="onride"?(L(),I("h4",Pe,u(l.status),1)):Q("",!0),a("p",Ee,u(l.last_seen),1)])])])])])])]),_:2},1024))),256))])):(L(),I("div",Re,h[3]||(h[3]=[a("img",{src:"/image/map/no-drivers.png",style:{width:"60%",margin:"auto"},alt:"No Drivers Found"},null,-1)])))]),_:1}),o(B,{lg:"8"},{default:f(()=>[a("div",qe,u(s.$t("map_loading")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ye=ie(ve,[["render",Ge]]);export{Ye as default};

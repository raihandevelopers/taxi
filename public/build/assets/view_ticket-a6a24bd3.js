import{_ as S,Z as W,O as D,an as z,am as j,C as H,r as h,T as Z,D as A,g,o as a,x as B,w as d,a as q,N,k as c,l as e,J as i,y as p,i as n,F as T,L as U,a1 as P,B as F,p as V,n as O}from"./vendor-ddfbd976.js";import{L as R}from"./main-306a5ea6.js";import{P as E}from"./page-header-2dc95532.js";import{F as Y}from"./FormValidation-a9047131.js";import{u as J}from"./footer-e648049d.js";import{_ as Q}from"./UserWebMenu-2e0e812c.js";import{I as G}from"./ImageUp-1fee9a5c.js";import"./app-042fb454.js";const K={components:{Layout:R,PageHeader:E,Head:W,Multiselect:D,FormValidation:Y,UserWebMenu:Q,ImageUp:G,ckeditor:z.component},props:{support_ticket:Object,successMessage:String,alertMessage:String,app_for:String,title:Array,languages:Array,titleType:String,user:Object,supportTicket:Array,reply_message:Array,attachment:Array},data(){return{editor:j,showModal:!1,selectedFile:null,zoomLevel:1}},methods:{openPreview(t){this.selectedFile=t,this.showModal=!0},closePreview(){this.showModal=!1,this.selectedFile=null},handleWheelZoom(t){t.preventDefault(),t.deltaY<0?this.zoomLevel+=.1:this.zoomLevel=Math.max(1,this.zoomLevel-.1)},stripHtmlTags(t){return new DOMParser().parseFromString(t,"text/html").body.textContent||""}},setup(t){const{t:l}=H(),{languages:u,fetchData:s}=J(),_=h("English"),m=h({}),M=h(null),k=h(t.title),v=h(t.supportTicket);console.log("results",v.value);const I=h(t.reply_message);console.log("reply",t.user);const b=h(t.attachment),f=Z({message:t.support_ticket&&t.support_ticket.message||""}),C=h(t.successMessage||""),w=h(t.alertMessage||""),x={message:{required:!0}},o=h(""),y=async()=>{try{let r;r=await q.post(`/ticket/reply/${t.supportTicket.id}`,f.data()),r.status===201?(C.value=l("ticket_created_successfully"),f.reset(),N.get(`/ticket/view/${v.value.id}`)):w.value=l("failed_to_create_ticket")}catch(r){r.response&&r.response.status===422?m.value=r.response.data.errors:(console.error(l("error_creating_ticket"),r),w.value=l("failed_to_create_ticket_catch"))}},L=r=>{_.value=r};return A(async()=>{Object.keys(u).length==0&&await s()}),{form:f,successMessage:C,alertMessage:w,errors:m,handleSubmit:y,validationRef:M,validationRules:x,searchQuery:o,setActiveTab:L,activeTab:_,languages:u,title:k,filterTitle:()=>{t.titleType==="request"&&(k.value=t.title.filter(r=>r.title_type==="request")),t.titleType==="general"&&(k.value=t.title.filter(r=>r.title_type==="general"))},handleFileUpload:r=>{f.attachment=Array.from(r.target.files)},results:v,reply:I,attachments:b,getFullImageUrl:r=>r?`/storage/uploads/support/support-tickets-files/${r}`:"",isImage:r=>/\.(jpg|jpeg|png|gif|svg|pdf)$/i.test(r),isVideo:r=>/\.(mp4|webm|ogg)$/i.test(r),isPDF:r=>/\.pdf$/i.test(r)}},mounted(){this.filterTitle()},computed:{sortedMessages(){return[...this.reply_messages].sort((t,l)=>new Date(t.converted_created_at)-new Date(l.converted_created_at))}}},X={class:"d-flex align-items-center justify-content-between"},$={class:"text-uppercase"},ee={class:"row"},se={class:"col-lg-9"},te={class:"row row-cols-auto justify-content-between align-items-center g-3"},le={class:"col"},oe=["src"],ie={class:"fs-20 ms-2"},ae={class:"col"},re={class:"ms-auto"},ne={class:"mt-5"},de={class:"mb-3"},ce={key:0,class:"file-container d-flex flex-wrap gap-3"},_e=["onClick"],me=["src"],ue={key:1,class:"file-preview"},fe=["src"],he=["src"],ge={key:3,class:"file-preview d-flex align-items-center justify-content-center"},ve={key:1,class:"no-files text-center text-muted fs-18"},ye={class:"modal-content"},pe=["src"],be={key:1,controls:"",class:"popup-content"},ke=["src"],we=["src"],xe=["href"],Fe={class:"mb-4 ms-2"},Ce={class:"col"},Be=["src"],Me={class:"fs-16 ms-2",style:{"font-weight":"600"}},Ie={class:"badge bg-light text-body fs-12 p-2 mt-2"},Te={class:"col"},Ue={key:1,class:"no-files text-center text-muted fs-18"},Pe={class:"row"},Ve={class:"col-sm-12"},Le={class:"mb-3"},Se={for:"description",class:"form-label"},We={class:"col-lg-12"},De={class:"text-end"},ze=["disabled"],je={class:"col-lg-3"},He={class:"row row-cols-auto justify-content-between align-items-center g-3"},Ze={class:"col"},Ae={class:"col"},qe={class:"ms-auto"},Ne={class:"d-flex align-items-center mb-2"},Oe={class:"flex-shrink-0"},Re={class:"text-muted mb-0"},Ee={class:"flex-grow-1 ms-2"},Ye={class:"mb-0"},Je={key:0,class:"d-flex align-items-center mb-2"},Qe={class:"flex-shrink-0"},Ge={class:"text-muted mb-0"},Ke={class:"flex-grow-1 ms-2"},Xe={class:"mb-0"},$e={class:"d-flex align-items-center mb-2"},es={class:"flex-shrink-0"},ss={class:"text-muted mb-0"},ts={class:"flex-grow-1 ms-2"},ls={class:"mb-0"},os={class:"d-flex align-items-center mb-2"},is={class:"flex-shrink-0"},as={class:"text-muted mb-0"},rs={class:"flex-grow-1 ms-2"},ns={key:0,class:"mb-0"},ds={key:1,class:"mb-0"},cs={class:"d-flex align-items-center mb-2"},_s={class:"flex-shrink-0"},ms={class:"text-muted mb-0"},us={class:"flex-grow-1 ms-2"},fs={class:"mb-0"},hs={class:"d-flex align-items-center mb-2"},gs={class:"flex-shrink-0"},vs={class:"text-muted mb-0"},ys={class:"flex-grow-1 ms-2"},ps={class:"mb-0"};function bs(t,l,u,s,_,m){const M=g("Head"),k=g("UserWebMenu"),v=g("BCardHeader"),I=g("BLink"),b=g("BCardBody"),f=g("BCard"),C=g("ckeditor"),w=g("FormValidation"),x=g("BBadge");return a(),B(f,{style:{"margin-bottom":"0px"}},{default:d(()=>[c(M,{title:"Taxi Ride"}),c(v,{class:"border-0"},{default:d(()=>[c(k,{user:u.user},null,8,["user"])]),_:1}),c(b,null,{default:d(()=>[e("div",X,[e("h4",$,i(t.$t("view_ticket"))+" : "+i(s.results.ticket_id),1),c(I,{href:"/get-support",class:"btn btn-primary float-end"},{default:d(()=>[p(i(t.$t("back")),1)]),_:1})])]),_:1}),e("div",ee,[e("div",se,[c(f,{class:"border"},{default:d(()=>[c(v,{class:"border-0"},{default:d(()=>{var o;return[e("div",te,[e("div",le,[e("img",{src:(o=u.user)==null?void 0:o.profile_picture,class:"img-fluid avatar-md rounded-circle",width:"100",alt:"user-profile"},null,8,oe),e("span",ie,i(s.results.user_name),1)]),e("div",ae,[e("h6",re,i(s.results.converted_created_at),1)])])]}),_:1}),c(b,null,{default:d(()=>[e("h5",null,i(s.results.title),1),e("h6",null,i(s.results.description),1),e("div",ne,[e("h5",de,i(t.$t("attachments"))+" : ",1),s.attachments.length>0?(a(),n("div",ce,[(a(!0),n(T,null,U(s.attachments,(o,y)=>(a(),n("div",{key:y,class:"file-box",onClick:L=>m.openPreview(o.image_name)},[s.isImage(o.image_name)?(a(),n("img",{key:0,src:s.getFullImageUrl(o.image_name),class:"file-preview"},null,8,me)):s.isVideo(o.image_name)?(a(),n("video",ue,[e("source",{src:s.getFullImageUrl(o.image_name),type:"video/mp4"},null,8,fe),l[7]||(l[7]=p(" Your browser does not support video playback. "))])):s.isPDF(o.image_name)?(a(),n("embed",{key:2,src:s.getFullImageUrl(o.image_name),type:"application/pdf",class:"file-preview"},null,8,he)):(a(),n("div",ge,l[8]||(l[8]=[e("i",{class:"fas fa-file-alt fa-2x"},null,-1)])))],8,_e))),128))])):(a(),n("div",ve,[l[9]||(l[9]=e("i",{class:"ri-file-unknow-line",style:{"font-size":"32px"}},null,-1)),e("p",null,i(t.$t("no_attachments_here")),1)]))]),_.showModal?(a(),n("div",{key:0,class:"modal-overlay",onClick:l[4]||(l[4]=(...o)=>m.closePreview&&m.closePreview(...o))},[e("div",ye,[e("span",{class:"close-btn",onClick:l[0]||(l[0]=(...o)=>m.closePreview&&m.closePreview(...o))},"Ã—"),s.isImage(_.selectedFile)?(a(),n("img",{key:0,src:s.getFullImageUrl(_.selectedFile),class:"popup-content",style:P({transform:`scale(${_.zoomLevel})`}),onWheel:l[1]||(l[1]=(...o)=>m.handleWheelZoom&&m.handleWheelZoom(...o))},null,44,pe)):s.isVideo(_.selectedFile)?(a(),n("video",be,[e("source",{src:s.getFullImageUrl(_.selectedFile),type:"video/mp4",style:P({transform:`scale(${_.zoomLevel})`}),onWheel:l[2]||(l[2]=(...o)=>m.handleWheelZoom&&m.handleWheelZoom(...o))},null,44,ke)])):s.isPDF(_.selectedFile)?(a(),n("embed",{key:2,src:s.getFullImageUrl(_.selectedFile),type:"application/pdf",class:"popup-content",style:P({transform:`scale(${_.zoomLevel})`}),onWheel:l[3]||(l[3]=(...o)=>m.handleWheelZoom&&m.handleWheelZoom(...o))},null,44,we)):(a(),n("a",{key:3,href:s.getFullImageUrl(_.selectedFile),target:"_blank",class:"btn btn-primary"},"Download File",8,xe))])])):F("",!0)]),_:1})]),_:1}),e("h4",Fe,i(t.$t("reply_message")),1),c(f,{class:"border",style:{"max-height":"500px","overflow-y":"auto"}},{default:d(()=>[s.reply.length>0?(a(!0),n(T,{key:0},U(s.reply,(o,y)=>(a(),n("div",{class:"card p-3 border mt-2",key:y},[e("div",{class:V(["border-0",o.sender_id===u.user.id?"text-end":"text-start"])},[e("div",{class:V(["row row-cols-auto align-items-center g-3",o.sender_id===u.user.id?"flex-row-reverse":""])},[e("div",Ce,[e("img",{src:o.sender_id===u.user.id?u.user.profile_picture:s.results.admin_details.profile_picture,class:"img-fluid avatar-xs rounded-circle",width:"100",alt:"user-profile"},null,8,Be),e("span",Me,i(o.sender_id===u.user.id?u.user.name:s.results.admin_name),1)])],2)],2),e("div",{class:V(o.sender_id===u.user.id?"text-end":"text-start ms-4")},[e("h6",Ie,i(m.stripHtmlTags(o.message)),1),e("div",Te,[e("h6",null,i(o.converted_created_at),1)])],2)]))),128)):(a(),n("div",Ue,[l[10]||(l[10]=e("i",{class:"ri-chat-delete-line",style:{"font-size":"32px"}},null,-1)),e("p",null,i(t.$t("no_messages_here")),1)]))]),_:1}),c(f,{class:"border"},{default:d(()=>[c(v,{class:"border-0"},{default:d(()=>[e("h4",null,[l[11]||(l[11]=e("i",{class:"ri-reply-fill bx-sm me-2"},null,-1)),p(i(t.$t("reply")),1)])]),_:1}),c(b,null,{default:d(()=>[e("form",{onSubmit:l[6]||(l[6]=O((...o)=>s.handleSubmit&&s.handleSubmit(...o),["prevent"]))},[c(w,{form:s.form,rules:s.validationRules,ref:"validationRef"},{default:d(()=>[e("div",Pe,[e("div",Ve,[e("div",Le,[e("label",Se,[p(i(t.$t("message"))+" ",1),l[12]||(l[12]=e("span",{class:"text-danger"},"*",-1))]),c(C,{disabled:u.app_for==="demo",modelValue:s.form.message,"onUpdate:modelValue":l[5]||(l[5]=o=>s.form.message=o),editor:_.editor},null,8,["disabled","modelValue","editor"]),(a(!0),n(T,null,U(s.errors.message,(o,y)=>(a(),n("span",{key:y,class:"text-danger"},i(o),1))),128))])]),e("div",We,[e("div",De,[e("button",{disabled:s.results.status==3||s.results.status==1,type:"submit",class:"btn btn-primary"},i(t.$t("send")),9,ze)])])])]),_:1},8,["form","rules"])],32)]),_:1})]),_:1})]),e("div",je,[c(f,{class:"border"},{default:d(()=>[c(v,{class:"border-bottom-0"},{default:d(()=>[l[13]||(l[13]=e("div",{class:"row"},null,-1)),e("div",He,[e("div",Ze,[e("h4",null,i(t.$t("ticket_details")),1)]),e("div",Ae,[e("div",qe,[s.results.status==1?(a(),B(x,{key:0,variant:"success",class:"text-uppercase"},{default:d(()=>[p(i(t.$t("pending")),1)]),_:1})):F("",!0),s.results.status==2?(a(),B(x,{key:1,variant:"warning",class:"text-uppercase"},{default:d(()=>[p(i(t.$t("acknowledge")),1)]),_:1})):F("",!0),s.results.status==3?(a(),B(x,{key:2,variant:"danger",class:"text-uppercase"},{default:d(()=>[p(i(t.$t("closed")),1)]),_:1})):F("",!0)])])])]),_:1,__:[13]}),c(b,null,{default:d(()=>[e("div",Ne,[e("div",Oe,[e("p",Re,i(t.$t("ticket_id"))+":",1)]),e("div",Ee,[e("h6",Ye,i(s.results.ticket_id),1)])]),s.results.request_id?(a(),n("div",Je,[e("div",Qe,[e("p",Ge,i(t.$t("request_id"))+":",1)]),e("div",Ke,[e("h6",Xe,i(s.results.request_id??"-"),1)])])):F("",!0),e("div",$e,[e("div",es,[e("p",ss,i(t.$t("ticket_title"))+":",1)]),e("div",ts,[e("h6",ls,i(s.results.title),1)])]),e("div",os,[e("div",is,[e("p",as,i(t.$t("assign_to"))+":",1)]),e("div",rs,[s.results.assign_to?(a(),n("h6",ns,i(s.results.admin_details.first_name),1)):(a(),n("h6",ds,i(t.$t("not_assigned")),1))])]),e("div",cs,[e("div",_s,[e("p",ms,i(t.$t("support_type"))+":",1)]),e("div",us,[e("h6",fs,i(s.results.support_type),1)])]),e("div",hs,[e("div",gs,[e("p",vs,i(t.$t("created"))+":",1)]),e("div",ys,[e("h6",ps,i(s.results.converted_created_at),1)])])]),_:1})]),_:1})])])]),_:1})}const Ws=S(K,[["render",bs],["__scopeId","data-v-86710fa7"]]);export{Ws as default};

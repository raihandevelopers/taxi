import{_ as U,Z,C as j,r as g,T as R,D as G,g as y,o as i,x as F,w as D,a as V,X as f,N,k as z,l as e,n as J,y as L,J as l,q as E,K as q,i as d,L as x,F as B,B as b,p as K,M as X}from"./vendor-ddfbd976.js";import{L as Q}from"./main-306a5ea6.js";import{P as W}from"./page-header-2dc95532.js";import{u as Y}from"./footer-e648049d.js";import"./app-042fb454.js";const $={components:{Layout:Q,PageHeader:W,Head:Z},props:{successMessage:String,alertMessage:String,default_lat:String,default_lng:String,existingZones:Array},setup(a){const{t:s}=j(),{languages:M,fetchData:o}=Y(),C=g("English"),v=R({service_location_id:"",languageFields:{},unit:""}),S=g(parseFloat(a.default_lat)),T=g(parseFloat(a.default_lng)),h=g(a.successMessage||""),m=g(a.alertMessage||""),w=g([]);let t=[];const k=async()=>{const n=await V.get("list");w.value=n.data.results},A=()=>{const n=f.map("map").setView({lat:S.value,lng:T.value},10);f.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(n);const r=new f.FeatureGroup;n.addLayer(r),a.existingZones.forEach(p=>{const _=p.map(u=>[u.lat,u.lng]);f.polygon(_,{color:"red",interactive:!1}).addTo(n)});const c=new f.Control.Draw({draw:{polygon:{allowIntersection:!1},rectangle:!1,circle:!1,polyline:!1,marker:!1},edit:{featureGroup:r,remove:!0}});n.addControl(c),n.on(f.Draw.Event.CREATED,p=>{const _=p.layer;t.push(_),r.addLayer(_),n.addLayer(_)}),n.on(f.Draw.Event.DELETED,function(p){p.layers.eachLayer(function(u){console.log("Deleted layer:",u),t=t.filter(O=>O!==u)})})},H=async()=>{const n=P();if(Object.keys(n).length===0)try{if(t.length===0){m.value=s("at_least_one_completed_polygon_is_required");return}const r=t.map(_=>_.getLatLngs()[0].map(u=>[u.lng,u.lat])),c={...v.data(),coordinates:JSON.stringify(r)};(await V.post("store",c)).status===201?(h.value=s("zone_created_successfully"),v.reset(),N.get("/zones")):m.value=s("failed_to_create_zone")}catch(r){r.response&&r.response.status===403?(m.value=r.response.data.alertMessage,setTimeout(()=>{N.get("/zones")},5e3)):(console.error(s("error_creating_zone"),r),m.value=s("failed_to_create_zone_catch"))}else v.errors=n},I=n=>{C.value=n};G(async()=>{Object.keys(M).length==0&&await o(),A(),k()});const P=()=>{const{service_location_id:n,unit:r}=v,c={};return r?delete c.unit:c.unit=s("unit_is_required"),n?delete c.service_location_id:c.service_location_id=s("service_location_is_required"),t.length===0?c.coordinates=s("at_least_one_completed_polygon_is_required"):delete c.coordinates,c};return{form:v,successMessage:h,alertMessage:m,handleSubmit:H,serviceLocations:w,setActiveTab:I,activeTab:C,languages:M}}},ee={class:"row"},te={class:"col-lg-6"},se={class:"card"},oe={class:"card-body"},ae={class:"mb-3"},ne={for:"service_location",class:"form-label"},le={value:"",disabled:""},re=["value"],ie={key:0,class:"text-danger"},ce={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},de={class:"nav-item",role:"presentation"},_e=["onClick"],ue=["id"],me={class:"col-sm-6 mt-3"},fe={class:"mb-3"},ve=["for"],pe=["placeholder","id","onUpdate:modelValue","required"],ge={class:"mb-3"},ye={for:"select_unit",class:"form-label"},be={disabled:"",value:""},he={value:"1"},we={value:"2"},ke={key:0,class:"text-danger"},Le={class:"text-end"},Me={type:"submit",class:"btn btn-primary"},Ce={class:"mb-3"},Se={key:0,class:"text-danger"},Te={class:"col-lg-6"},De={class:"card"},ze={class:"card-body"},Ee=["placeholder"],xe={key:0,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},Be={class:"alert-content"};function Fe(a,s,M,o,C,v){const S=y("Head"),T=y("PageHeader"),h=y("BCol"),m=y("BRow"),w=y("Layout");return i(),F(w,null,{default:D(()=>[z(S,{title:"Zones"}),z(T,{title:a.$t("create"),pageTitle:a.$t("zone"),pageLink:"/zones"},null,8,["title","pageTitle"]),e("div",ee,[e("div",te,[e("div",se,[e("div",oe,[e("form",{onSubmit:s[2]||(s[2]=J((...t)=>o.handleSubmit&&o.handleSubmit(...t),["prevent"]))},[e("div",ae,[e("label",ne,[L(l(a.$t("service_location"))+" ",1),s[4]||(s[4]=e("span",{class:"text-danger"},"*",-1))]),E(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":s[0]||(s[0]=t=>o.form.service_location_id=t)},[e("option",le,l(a.$t("select_service_location")),1),(i(!0),d(B,null,x(o.serviceLocations,t=>(i(),d("option",{key:t.id,value:t.id},l(t.name),9,re))),128))],512),[[q,o.form.service_location_id]]),o.form.errors.service_location_id?(i(),d("span",ie,l(o.form.errors.service_location_id),1)):b("",!0)]),e("ul",ce,[(i(!0),d(B,null,x(o.languages,t=>(i(),F(m,{key:t.code},{default:D(()=>[z(h,{lg:"12"},{default:D(()=>[e("li",de,[e("a",{class:K(["nav-link",{active:o.activeTab===t.label}]),onClick:k=>o.setActiveTab(t.label),role:"tab","aria-selected":"true"},l(t.label),11,_e)])]),_:2},1024)]),_:2},1024))),128))]),(i(!0),d(B,null,x(o.languages,t=>(i(),d("div",{class:"tab-content text-muted",key:t.code},[o.activeTab===t.label?(i(),d("div",{key:0,class:"tab-pane active show",id:`${t.label}`,role:"tabpanel"},[e("div",me,[e("div",fe,[e("label",{for:`name-${t.code}`,class:"form-label"},[L(l(a.$t("name"))+" ",1),s[5]||(s[5]=e("span",{class:"text-danger"},"*",-1))],8,ve),E(e("input",{type:"text",class:"form-control",placeholder:`Enter Name in ${t.label}`,id:`name-${t.code}`,"onUpdate:modelValue":k=>o.form.languageFields[t.code]=k,required:t.code==="en"},null,8,pe),[[X,o.form.languageFields[t.code]]])])])],8,ue)):b("",!0)]))),128)),e("div",ge,[e("label",ye,[L(l(a.$t("select_unit"))+" ",1),s[6]||(s[6]=e("span",{class:"text-danger"},"*",-1))]),E(e("select",{id:"select_unit",class:"form-select","onUpdate:modelValue":s[1]||(s[1]=t=>o.form.unit=t)},[e("option",be,l(a.$t("choose_unit")),1),e("option",he,l(a.$t("kilo_meter")),1),e("option",we,l(a.$t("miles")),1)],512),[[q,o.form.unit]]),o.form.errors.unit?(i(),d("span",ke,l(o.form.errors.unit),1)):b("",!0)]),e("div",Le,[e("button",Me,l(a.$t("save")),1)]),e("div",Ce,[o.form.errors.coordinates?(i(),d("span",Se,l(o.form.errors.coordinates),1)):b("",!0)])],32)])])]),e("div",Te,[e("div",De,[e("div",ze,[e("input",{id:"pac-input",class:"form-control",type:"text",placeholder:a.$t("search_for_a_city"),ref:"autocompleteInput"},null,8,Ee),s[7]||(s[7]=e("div",{id:"map",style:{height:"400px"}},null,-1))])])])]),o.alertMessage?(i(),d("div",xe,[e("div",Be,[s[8]||(s[8]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[9]||(s[9]=e("strong",null,"Alert",-1)),L(" - "+l(o.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[3]||(s[3]=(...t)=>a.dismissMessage&&a.dismissMessage(...t)),"aria-label":"Close Alert Message"})])])):b("",!0)]),_:1})}const Ie=U($,[["render",Fe],["__scopeId","data-v-909ed5cd"]]);export{Ie as default};

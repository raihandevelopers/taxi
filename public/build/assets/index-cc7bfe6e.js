import{_ as Y,Z as G,O as J,P as Q,z as W,C as Z,T as K,r as p,Q as X,D as ee,R as te,g as u,S as se,o as f,x as U,w as c,U as b,a as $,N as ae,k as i,l as t,y as h,J as d,i as g,B as x,F as oe,L as ne,p as le,n as j,q as D,W as E}from"./vendor-ddfbd976.js";import{L as ie}from"./main-306a5ea6.js";import{P as re}from"./page-header-2dc95532.js";import{P as ce}from"./Pagination-f095ae3c.js";import{s as de}from"./searchbar-3acbc236.js";import{u as ue,l as fe}from"./footer-e648049d.js";import{_ as _e}from"./search-file-ab3e1046.js";import"./app-042fb454.js";const me={data(){return{rightOffcanvas:!1}},components:{Layout:ie,PageHeader:re,Head:G,Pagination:ce,Multiselect:J,flatPickr:Q,Link:W,searchbar:de},props:{successMessage:String,alertMessage:String,serviceLocations:Array,firebaseConfig:Object,peak_zone:Array,zones:{type:Object,required:!0}},setup(a){const{t:e}=Z(),v=K({zone_id:null,peak_location:null}),s=p(a.peak_zone),A=p({}),O=p(a.successMessage||""),L=p(a.alertMessage||""),V=p(a.serviceLocations||""),k=p(!1),_=p(!1),P=p(null),{selectedLocation:C}=ue();console.log("peak_zone",a.peak_zone);const H=()=>{O.value="",L.value=""},F=async(n,l)=>{b.fire({title:e("are_you_sure"),text:e("you_are_about_to_change_status"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:e("yes"),cancelButtonText:e("cancel")}).then(async r=>{if(r.isConfirmed)try{const y=await $.post(`/peak_zone/update_status/${n}`,{id:n,active:l}),B=s.value.findIndex(z=>z.id===n);B!==-1&&(s.value[B]=y.data.peakzone),b.fire(e("changed"),e("status_updated_successfully"),"success")}catch(y){console.error(e("error_updating_status"),y),b.fire(e("error"),e("failed_to_update_status"),"error")}})},w=p(!1),I=()=>{m(),_.value=!0,w.value=!1},T=()=>{v.reset(),m(),w.value=!1},N=()=>{k.value=!1},m=async(n=1)=>{try{const l=v.data();l.page=n;const r=await $.get("/peak_zone/fetch",{params:l});s.value=r.data.results,A.value=r.data.paginator,_.value=!1,v.status!==""&&(l.status=v.status)}catch(l){console.error(e("error_fetching_peak_zone"),l)}};X(C,n=>{v.peak_location=n,m()}),ee(async()=>{try{const n=a.firebaseConfig;firebase.apps.length||firebase.initializeApp(n);const l=firebase.database();s.value.forEach(r=>{l.ref(`peak-zones/${r.id}`).on("value",function(B){const z=s.value.findIndex(M=>M.id===r.id);if(!B.exists()){z===-1&&s.value.splice(z,1);return}if(z!==-1){const M=B.val();M&&(M.active===1&&(s.value.active=!0),s.value.converted_start_time=M.start_time)}})}),l.ref("peak-zones").on("child_added",function(r){const y=r.val();m()}),l.ref("peak-zones").on("child_removed",function(r){const y=r.val();m()}),v.service_location_id=C}catch(n){console.error(e("error_initializing_firebase_or_fetching_settings"),n)}});const o=async n=>{m(n)},R=async n=>{ae.get(`/peak_zone/map/${n.id}`)},S=async n=>{b.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, delete it!"}).then(async l=>{if(l.isConfirmed)try{await q(n)}catch(r){console.error(e("error_deleting_data"),r),b.fire(e("error"),e("failed_to_delete_the_data"),"error")}})},q=async n=>{try{await $.delete(`/peak_zone/delete/${n}`);const l=s.value.findIndex(r=>r.id===n);l!==-1&&s.value.splice(l,1),k.value=!1,b.fire(e("success"),e("peak_zone_deleted_successfully"),"success")}catch{b.fire(e("error"),e("failed_to_delete_peak_zone"),"error")}};return{results:s,deleteItemId:P,successMessage:O,alertMessage:L,filterData:I,closeModal:N,dismissMessage:H,paginator:A,modalFilter:_,serviceLocations:V,clearFilter:T,filter:v,handlePageChanged:o,mapData:R,toggleActiveStatus:F,selectedLocation:C,rightOffcanvas:w,deleteModal:S,deleteData:q}},computed:{...fe,...te(["permissions"])},mounted(){this.filter.peak_location=this.selectedLocation}},pe={class:"d-flex align-items-center gap-2"},ve={class:"table"},ge={class:"table align-middle position-relative table-nowrap"},be={class:"table-active"},he={scope:"col"},ke={scope:"col"},ye={scope:"col"},Ce={key:0,scope:"col"},we={key:0},Be={class:"d-flex"},ze={class:"flex-grow-1"},Me=["onClick","id","checked","disabled"],xe={key:0},Le={key:1},Pe={colspan:"4",class:"text-center"},Se={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},De={class:"alert-content"},Ae={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},Oe={class:"alert-content"},Ve={class:"offcanvas-body"},He={class:"mb-4"},Fe={for:"status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Ie={class:"form-check form-check-inline"},Te={class:"form-check-label",for:"statusActive"},Ne={class:"form-check form-check-inline"},Re={class:"form-check-label",for:"statusInactive"},Ue={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function $e(a,e,v,s,A,O){const L=u("Head"),V=u("PageHeader"),k=u("BCol"),_=u("BButton"),P=u("BRow"),C=u("BCardHeader"),H=u("BCardBody"),F=u("BCard"),w=u("BForm"),I=u("BOffcanvas"),T=u("Pagination"),N=u("Layout"),m=se("b-tooltip");return f(),U(N,null,{default:c(()=>[i(L,{title:a.$t("peakzone")},null,8,["title"]),i(V,{title:a.$t("peakzone"),pageTitle:a.$t("peakzone")},null,8,["title","pageTitle"]),i(P,null,{default:c(()=>[i(k,{lg:"12"},{default:c(()=>[i(F,{"no-body":"",id:"tasksList"},{default:c(()=>[i(C,{class:"border-0"},{default:c(()=>[i(P,{class:"g-2"},{default:c(()=>[i(k,{md:"3"}),i(k,{md:"auto",class:"ms-auto"},{default:c(()=>[t("div",pe,[i(_,{variant:"danger",onClick:e[0]||(e[0]=o=>s.rightOffcanvas=!0)},{default:c(()=>[e[6]||(e[6]=t("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),h(" "+d(a.$t("filters")),1)]),_:1,__:[6]})])]),_:1})]),_:1})]),_:1}),i(H,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[t("div",ve,[t("table",ge,[t("thead",be,[t("tr",null,[t("th",he,d(a.$t("name")),1),t("th",ke,d(a.$t("start_time")),1),t("th",ye,d(a.$t("status")),1),a.permissions.includes("peak-zone-map-view")?(f(),g("th",Ce,d(a.$t("action")),1)):x("",!0)])]),s.results.length>0?(f(),g("tbody",we,[(f(!0),g(oe,null,ne(s.results,(o,R)=>(f(),g("tr",{key:R},[t("td",null,[t("div",Be,[t("div",ze,d(o.name),1)])]),t("td",null,d(o.converted_start_time),1),t("td",null,[t("div",{class:le({"form-check":!0,"form-switch":!0,"form-switch-lg":!0,"form-switch-success":o.active})},[t("input",{class:"form-check-input",type:"checkbox",role:"switch",onClick:j(S=>s.toggleActiveStatus(o.id,!o.active),["prevent"]),id:"status_"+o.id,checked:o.active,disabled:!a.permissions.includes("peak-zone-toggle")},null,8,Me)],2)]),a.permissions.includes("peak-zone-map-view")?(f(),g("td",xe,[D((f(),U(_,{onClick:j(S=>s.mapData(o),["prevent"]),class:"btn btn-soft-success btn-sm m-2","data-bs-toggle":"tooltip",title:"zone_map_view"},{default:c(()=>e[7]||(e[7]=[t("i",{class:"ri-inbox-archive-line bx-xs"},null,-1)])),_:2,__:[7]},1032,["onClick"])),[[m,void 0,void 0,{hover:!0}]]),a.permissions.includes("delete-peak-zone")&&a.app_for!=="demo"?D((f(),U(_,{key:0,class:"btn btn-soft-danger btn-sm m-2",size:"sm",type:"button",onClick:j(S=>s.deleteModal(o.id),["prevent"]),"data-bs-toggle":"tooltip",title:"Delete"},{default:c(()=>e[8]||(e[8]=[t("i",{class:"bx bx-trash bx-xs"},null,-1)])),_:2,__:[8]},1032,["onClick"])),[[m,void 0,void 0,{hover:!0}]]):x("",!0)])):x("",!0)]))),128))])):(f(),g("tbody",Le,[t("tr",null,[t("td",Pe,[e[9]||(e[9]=t("img",{src:_e,alt:"Loading...",style:{width:"100px"}},null,-1)),t("h5",null,d(a.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),t("div",null,[s.successMessage?(f(),g("div",Se,[t("div",De,[e[10]||(e[10]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[11]||(e[11]=h()),e[12]||(e[12]=t("strong",null,"Success",-1)),h(" - "+d(s.successMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-success",onClick:e[1]||(e[1]=(...o)=>s.dismissMessage&&s.dismissMessage(...o)),"aria-label":"Close Success Message"})])])):x("",!0),s.alertMessage?(f(),g("div",Ae,[t("div",Oe,[e[13]||(e[13]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[14]||(e[14]=h()),e[15]||(e[15]=t("strong",null,"Alert",-1)),h(" - "+d(s.alertMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-danger",onClick:e[2]||(e[2]=(...o)=>s.dismissMessage&&s.dismissMessage(...o)),"aria-label":"Close Alert Message"})])])):x("",!0)]),i(I,{modelValue:s.rightOffcanvas,"onUpdate:modelValue":e[5]||(e[5]=o=>s.rightOffcanvas=o),placement:"end",title:a.$t("zone_filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:c(()=>[i(w,null,{default:c(()=>[t("div",Ve,[t("div",He,[t("label",Fe,d(a.$t("status")),1),t("div",null,[t("div",Ie,[D(t("input",{class:"form-check-input",type:"radio",name:"status",id:"statusActive","onUpdate:modelValue":e[3]||(e[3]=o=>s.filter.status=o),value:"1"},null,512),[[E,s.filter.status]]),t("label",Te,d(a.$t("active")),1)]),t("div",Ne,[D(t("input",{class:"form-check-input",type:"radio",name:"status",id:"statusInactive","onUpdate:modelValue":e[4]||(e[4]=o=>s.filter.status=o),value:"0"},null,512),[[E,s.filter.status]]),t("label",Re,d(a.$t("inactive")),1)])])])]),t("div",Ue,[i(_,{variant:"light",class:"w-100",onClick:s.clearFilter},{default:c(()=>[h(d(a.$t("clear_filter")),1)]),_:1},8,["onClick"]),i(_,{type:"submit",variant:"success",class:"w-100",onClick:s.filterData},{default:c(()=>[h(d(a.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),i(T,{paginator:s.paginator,onPageChanged:s.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const Ze=Y(me,[["render",$e]]);export{Ze as default};

import{aa as R,ab as A,$ as D,ac as z,a as k,_ as F,g as j,o as P,i as M,k as b,w as g,l as w,J as N,y as O}from"./vendor-ddfbd976.js";const G={...R("layout",{layoutType:s=>s.layoutType,sidebarSize:s=>s.sidebarSize,layoutWidth:s=>s.layoutWidth,topbar:s=>s.topbar,mode:s=>s.mode,position:s=>s.position,sidebarView:s=>s.sidebarView,sidebarColor:s=>s.sidebarColor,sidebarImage:s=>s.sidebarImage,visibility:s=>s.visibility})},Q=A("layout",["changeLayoutType","changeLayoutWidth","changeSidebarSize","changeTopbar","changeMode","changePosition","changeSidebarView","changeSidebarColor","changeSidebarImage","changePreloader","changeVisibility"]);A("notification",["success","error","clear"]);({...R("todo",{todos:s=>s.todos})});A("todo",["fetchTodos"]);const t=D({languages:null,locations:null,selectedLocation:null,notifications:[],chats:[],unreadNotification:0,unreadChat:0,permissions:[]});function X(){const s=async()=>{if(t.languages==null){const e=await(await fetch("/current-languages")).json();t.languages=e.data.map(o=>({value:o.id,label:o.name,code:o.code,default:o.default_status,direction:o.direction}))}},u=new Audio("/audio/notification.mp3");let h=!1;const _=()=>{h||(h=!0,u.play().then(()=>{h=!1}).catch(a=>{console.error("Audio playback failed:",a),h=!1}),u.onended=()=>{h=!1})},y=async()=>{if(t.permissions==null){const e=await(await fetch("/user/permissions")).json();t.permissions=e.data}},L=async()=>{if(t.locations==null){const e=await(await fetch("/current-locations")).json();t.locations=e.data.map(o=>({value:o.id,label:o.name}))}},m=a=>{t.selectedLocation=a,localStorage.setItem("selectedLocation",a)};localStorage.getItem("selectedLocation")&&(t.selectedLocation=localStorage.getItem("selectedLocation"));const C=(a,e)=>{a.child(e).on("value",async function(o){const n=o.val();if(n&&n.sender_type==="user"){let c=t.chats.find(l=>l.id===n.conversation_id);c&&(c.unread=parseInt(c.unread)+1,c.last_sent=n.created_at,c.last_message=n.message,u.paused&&_())}})},v=a=>{if(a){const e=new Date(a),o=e.getHours().toString().padStart(2,"0"),n=e.getMinutes().toString().padStart(2,"0");return`${o}:${n}`}return""},$=async()=>{try{const e=(await k.get("/firebase/get")).data.response,o={apiKey:e.firebase_api_key,authDomain:e.firebase_auth_domain,databaseURL:e.firebase_database_url,projectId:e.firebase_project_id,storageBucket:e.firebase_storage_bucket,messagingSenderId:e.firebase_messaging_sender_id,appId:e.firebase_app_id};firebase.apps.length||firebase.initializeApp(o),firebase.database().ref("admin-notification").on("value",d=>{const i=d.val();if(i){const f=Object.keys(i).map(r=>({id:r,...i[r]})).filter(r=>!r.read).sort((r,p)=>p.updated_at-r.updated_at);t.notifications=f,t.unreadNotification=f.length}else console.log("No notifications found.")});const c=firebase.database().ref("conversation");let l=new Set,S=!1;const I=await fetch("/chat/fetchChat").then(d=>d.json()).then(d=>d);t.chats=I,t.chats.forEach(d=>{d.unread&&(t.unreadChat+=parseInt(d.unread)),l.add(d.id),c.child(d.id).on("value",async function(i){var f=i.val();if(S&&f&&f.sender_type=="user"){let r=t.chats.find(p=>p.id===f.conversation_id);r&&(r.unread=parseInt(r.unread)+1,r.last_seen=v(f.created_at),r.last_message=f.message,t.unreadChat++,_())}})}),setTimeout(()=>{S=!0},4e3),c.on("child_added",async function(d){if(S){const i=d.val();if(l.has(i.conversation_id))return;if((await k.get(`/chat/verify-chat?conversationId=${i.conversation_id}`)).data.data){l.add(i.conversation_id);const p=await B(i.sender_id);let V={id:i.conversation_id,unread:1,subject:p.name,profile_picture:p.profile_picture,last_seen:v(i.created_at),last_message:i.message};C(c,i.conversation_id),t.unreadChat++,t.chats.unshift(V),_()}}})}catch(a){console.error("Error initializing Firebase or fetching settings:",a)}},x=async a=>{try{const o=(await firebase.database().ref(`admin-notification/${a}`).once("value")).val();o?(console.log("Snapshot Data:",o),o.read||(await firebase.database().ref(`admin-notification/${a}`).update({read:!0}),await new Promise(n=>setTimeout(n,100)),await firebase.database().ref(`admin-notification/${a}`).remove(),o.read=!0,t.unreadNotification=t.notifications.filter(n=>!n.read).length,console.log("Notification marked as read:",a)),o.url&&(window.location.href=o.url)):console.error("Notification not found in Firebase:",a)}catch(e){console.error("Error fetching, updating, or removing notification:",e)}},B=async a=>{try{return(await k.get(`/chat/fetch-user?user_id=${a}`)).data}catch(e){console.error(e)}},T=async a=>{try{const e=t.chats.find(o=>o.id==a);t.unreadChat-=e.unread,t.chats=t.chats.filter(o=>o.id!==a)}catch(e){console.error(e)}},E=async(a="notification")=>{try{if(t.unreadNotification>0&&a=="notification"){const e=firebase.database().ref("admin-notification"),n=(await e.once("value")).val();if(n){const c={};Object.keys(n).forEach(l=>{c[`${l}/read`]=!0}),await e.update(c),t.notifications.forEach(l=>l.read=!0),t.unreadNotification=0,window.location.reload()}}t.unreadChat>0&&a=="chat"&&(await fetch("/chat/readAll").then(e=>e.json()).then(e=>e),t.chats=[],t.unreadChat=0)}catch(e){console.error("Error marking all notifications as read:",e)}};return{...z(t),fetchData:s,fetchLocations:L,setServiceLocation:m,fetchFirebaseSettings:$,handleNotificationClick:x,handleMarkAllAsRead:E,markChatAsRead:T,playAudioOnce:_,fetchPermissions:y}}const W={data(){return{footerContent1:window.footer_content1,footerContent2:window.footer_content2}}},U={class:"footer"},H={class:"text-sm-start d-none d-sm-block"},J={class:"text-sm-center d-none d-sm-block"};function K(s,u,h,_,y,L){const m=j("BCol"),C=j("BRow"),v=j("BContainer");return P(),M("footer",U,[b(v,{fluid:""},{default:g(()=>[b(C,null,{default:g(()=>[b(m,{col:"",sm:"4"},{default:g(()=>[w("div",H,N(y.footerContent1),1)]),_:1}),b(m,{col:"",sm:"4"},{default:g(()=>[w("div",J,N(y.footerContent2),1)]),_:1}),b(m,{col:"",sm:"4"},{default:g(()=>u[0]||(u[0]=[w("div",{class:"text-sm-end d-none d-sm-block"},[O(" App version "),w("span",{class:"badge bg-success-subtle text-success fs-12"},"1.8")],-1)])),_:1,__:[0]})]),_:1})]),_:1})])}const Y=F(W,[["render",K]]);export{Y as F,Q as a,G as l,X as u};

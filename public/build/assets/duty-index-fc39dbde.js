import{_ as U,Z as N,O as A,P as Y,C as j,T as q,r as v,Q as x,G as E,g as m,o as d,x as G,w as h,a as T,N as J,k as u,l as t,y as M,J as r,q as F,K as R,i as c,L as y,F as D,B as I,n as K}from"./vendor-ddfbd976.js";import{L as Q}from"./main-306a5ea6.js";import{P as Z}from"./page-header-2dc95532.js";import{P as z}from"./Pagination-f095ae3c.js";import{i as W}from"./imageUpload-4f5efd67.js";import{F as X}from"./FormValidation-a9047131.js";import"./footer-e648049d.js";import"./app-042fb454.js";/* empty css                                                    */const $={components:{Layout:Q,PageHeader:Z,Head:N,Pagination:z,Multiselect:A,FormValidation:X,imageUpload:W,flatPickr:Y},props:{successMessage:String,alertMessage:String,validate:Function,serviceLocations:Array},setup(l){const{t:o}=j(),i=q({date:"",select_date_option:"",service_location_id:"",driver_id:"",file_format:""}),a=v([]),O={driver_id:{required:!0},select_date_option:{required:!0},file_format:{required:!0}},S=v(null),b=v({}),w=v(l.successMessage||""),f=v(l.alertMessage||""),C=()=>{w.value="",f.value=""},k=v(!1),B=async()=>{if(!i.service_location_id){a.value=[];return}try{const e=await T.get("/report/getDrivers",{params:{service_location_id:i.service_location_id}});e.data&&e.status===200?(e.data.drivers.length||(f.value=o("no_drivers_found")),a.value=e.data.drivers.length>0?e.data.drivers:[]):(a.value=[],f.value=o("no_drivers_found"))}catch(e){console.error(o("error_fetching_drivers"),e),f.value=o("failed_to_fetch_drivers")}},g=v(""),p=v("");x(()=>i.select_date_option,e=>{const s=new Date;let _,n;switch(e){case"today":_=n=s;break;case"this_week":_=new Date(s.setDate(s.getDate()-s.getDay())),n=new Date(s.setDate(s.getDate()+6-s.getDay()));break;case"this_month":_=new Date(s.getFullYear(),s.getMonth(),1),n=new Date(s.getFullYear(),s.getMonth()+1,0);break;case"this_year":_=new Date(s.getFullYear(),0,1),n=new Date(s.getFullYear(),11,31);break;case"date":_=n=null;break;default:_=n=null}g.value=_?_.toISOString().split("T")[0]:"",p.value=n?n.toISOString().split("T")[0]:""});const L=async()=>{if(b.value=S.value.validate(),i.select_date_option==="date"){console.log("date update"),console.log(i.date);const e=i.date.split(" to ");if(e.length===2){const s=e[0].trim(),_=e[1].trim(),n=new Date(s),H=new Date(_);g.value=n.toISOString().split("T")[0],p.value=H.toISOString().split("T")[0],console.log("Formatted fromDate:",g.value),console.log("Formatted toDate:",p.value)}else{console.error("Invalid date range format");return}}if(!(Object.keys(b.value).length>0)){k.value=!0;try{const e={driver_id:i.driver_id,from_date:g.value,to_date:p.value,file_format:i.file_format};console.log("API params:",e);const s=await T.post("/report/driver-duty-report-download",e,{responseType:"blob"}),_=window.URL.createObjectURL(new Blob([s.data])),n=document.createElement("a");n.href=_,n.setAttribute("download",`driver_duty_report.${i.file_format}`),document.body.appendChild(n),n.click(),n.remove(),w.value=o("report_downloaded_successfully"),i.reset(),J.get("/report/driver-duty-report")}catch(e){e.response&&e.response.status===422?b.value=e.response.data.errors:(console.error(o("error_downloading_report"),e),f.value=o("failed_to_download_report"))}finally{k.value=!1}}},V=E(()=>{if(i.date&&i.date.length===2){const e=new Date(i.date[0]),s=new Date(i.date[1]),_=e.toLocaleString("default",{month:"short"}),n=s.toLocaleString("default",{month:"short"});return`${e.getDate()} ${_} - ${s.getDate()} ${n}`}return""});return{form:i,drivers:a,successMessage:w,alertMessage:f,handleSubmit:L,dismissMessage:C,validationRules:O,validationRef:S,errors:b,formattedDate:V,rangeDateconfig:{mode:"range",dateFormat:"Y-m-d",maxDate:"today",parseDate:e=>new Date(e)},handleServiceLocationChange:B,fromDate:g,toDate:p,loading:k}}},ee={class:"row"},te={class:"col-sm-6"},oe={for:"service_location_id",class:"form-label"},ae={value:""},se=["value"],re={class:"text-danger"},le={class:"col-sm-6"},ne={for:"driver_id",class:"form-label"},ie={class:"text-danger"},de={class:"col-sm-6 mt-4"},ce={class:"mb-3"},_e={for:"select_date_option",class:"form-label"},me={disabled:"",value:""},ue={value:"today"},fe={value:"this_week"},ve={value:"this_month"},ge={value:"this_year"},pe={value:"date"},be={key:0,class:"col-sm-6"},he={class:"mb-4"},ye={for:"datepicker-range",class:"form-label"},De={class:"col-sm-6 mt-4"},we={class:"mb-3"},ke={for:"file_format",class:"form-label"},Me={disabled:"",selected:"",value:""},Se={value:"xlsx"},Ce={value:"csv"},Be={class:"col-lg-12"},Le={class:"text-end"},Ve=["disabled"],Fe={key:0,class:"custom-alert alert alert-success alert-border-left fade show",role:"alert",id:"alertMsg"},Re={class:"alert-content"},Ie={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},Oe={class:"alert-content"};function Pe(l,o,i,a,O,S){const b=m("Head"),w=m("PageHeader"),f=m("BCardHeader"),C=m("Multiselect"),k=m("flat-pickr"),B=m("FormValidation"),g=m("BCardBody"),p=m("BCard"),L=m("BCol"),V=m("BRow"),P=m("Layout");return d(),G(P,null,{default:h(()=>[u(b,{title:"Driver Duties Report"}),u(w,{title:l.$t("driver_duty_report"),pageTitle:l.$t("driver_duty_report")},null,8,["title","pageTitle"]),u(V,null,{default:h(()=>[u(L,{lg:"12"},{default:h(()=>[u(p,{"no-body":"",id:"tasksList"},{default:h(()=>[u(f,{class:"border-0"}),u(g,{class:"border border-dashed border-end-0 border-start-0"},{default:h(()=>[t("form",{onSubmit:o[6]||(o[6]=K((...e)=>a.handleSubmit&&a.handleSubmit(...e),["prevent"]))},[u(B,{form:a.form,rules:a.validationRules,ref:"validationRef"},{default:h(()=>[t("div",ee,[t("div",te,[t("label",oe,[M(r(l.$t("service_location"))+" ",1),o[9]||(o[9]=t("span",{class:"text-danger"},"*",-1))]),F(t("select",{"onUpdate:modelValue":o[0]||(o[0]=e=>a.form.service_location_id=e),class:"form-select",onChange:o[1]||(o[1]=(...e)=>a.handleServiceLocationChange&&a.handleServiceLocationChange(...e))},[t("option",ae,r(l.$t("select")),1),(d(!0),c(D,null,y(i.serviceLocations,e=>(d(),c("option",{key:e.id,value:e.id},r(e.name),9,se))),128))],544),[[R,a.form.service_location_id]]),(d(!0),c(D,null,y(a.errors.service_location_id,e=>(d(),c("span",re,r(e),1))),256))]),t("div",le,[t("label",ne,[M(r(l.$t("driver"))+" ",1),o[10]||(o[10]=t("span",{class:"text-danger"},"*",-1))]),u(C,{id:"driver_id",modelValue:a.form.driver_id,"onUpdate:modelValue":o[2]||(o[2]=e=>a.form.driver_id=e),options:a.drivers.map(e=>({value:e.id,label:e.name})),"close-on-select":!0,searchable:!0,placeholder:l.$t("select"),"create-option":!1},null,8,["modelValue","options","placeholder"]),(d(!0),c(D,null,y(a.errors.driver_id,e=>(d(),c("span",ie,r(e),1))),256))]),t("div",de,[t("div",ce,[t("label",_e,[M(r(l.$t("date_option"))+" ",1),o[11]||(o[11]=t("span",{class:"text-danger"},"*",-1))]),F(t("select",{id:"select_date_option",class:"form-select","onUpdate:modelValue":o[3]||(o[3]=e=>a.form.select_date_option=e)},[t("option",me,r(l.$t("select")),1),t("option",ue,r(l.$t("today")),1),t("option",fe,r(l.$t("this_week")),1),t("option",ve,r(l.$t("this_month")),1),t("option",ge,r(l.$t("this_year")),1),t("option",pe,r(l.$t("date")),1)],512),[[R,a.form.select_date_option]]),(d(!0),c(D,null,y(a.errors.select_date_option,(e,s)=>(d(),c("span",{key:s,class:"text-danger"},r(e),1))),128))])]),a.form.select_date_option==="date"?(d(),c("div",be,[t("div",he,[t("label",ye,r(l.$t("from_to_date")),1),u(k,{placeholder:l.$t("select_date"),modelValue:a.form.date,"onUpdate:modelValue":o[4]||(o[4]=e=>a.form.date=e),config:a.rangeDateconfig,class:"form-control flatpickr-input",id:"datepicker-range"},null,8,["placeholder","modelValue","config"]),(d(!0),c(D,null,y(a.errors.date,(e,s)=>(d(),c("span",{key:s,class:"text-danger"},r(e),1))),128))])])):I("",!0),t("div",De,[t("div",we,[t("label",ke,r(l.$t("file_format")),1),F(t("select",{id:"file_format",class:"form-select","onUpdate:modelValue":o[5]||(o[5]=e=>a.form.file_format=e)},[t("option",Me,r(l.$t("select_file_format")),1),t("option",Se,r(l.$t("excel")),1),t("option",Ce,r(l.$t("csv")),1)],512),[[R,a.form.file_format]]),(d(!0),c(D,null,y(a.errors.file_format,(e,s)=>(d(),c("span",{key:s,class:"text-danger"},r(e),1))),128))])]),t("div",Be,[t("div",Le,[t("button",{type:"submit",class:"btn btn-primary",disabled:a.loading},r(l.$t("download")),9,Ve)])])])]),_:1},8,["form","rules"])],32)]),_:1})]),_:1})]),_:1})]),_:1}),t("div",null,[a.successMessage?(d(),c("div",Fe,[t("div",Re,[o[12]||(o[12]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[13]||(o[13]=t("strong",null,"Success",-1)),M(" - "+r(a.successMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-success",onClick:o[7]||(o[7]=(...e)=>a.dismissMessage&&a.dismissMessage(...e)),"aria-label":"Close Success Message"})])])):I("",!0),a.alertMessage?(d(),c("div",Ie,[t("div",Oe,[o[14]||(o[14]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[15]||(o[15]=t("strong",null,"Alert",-1)),M(" - "+r(a.alertMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-danger",onClick:o[8]||(o[8]=(...e)=>a.dismissMessage&&a.dismissMessage(...e)),"aria-label":"Close Alert Message"})])])):I("",!0)])]),_:1})}const Ee=U($,[["render",Pe]]);export{Ee as default};

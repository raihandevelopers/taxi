import{_ as $,Z as z,O as G,C as W,r as b,Q as q,D as J,g as f,o as p,x as R,w as c,k as n,l as t,J as r,y as F,i as C,F as K,L as Q,B as P}from"./vendor-ddfbd976.js";import{L as Z}from"./dispatchmain-37fc6bfb.js";import{P as X}from"./page-header-2dc95532.js";import{g as Y}from"./googleMap-1f997b81.js";import"./footer-e648049d.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const ee={components:{Head:z,Layout:Z,PageHeader:X,Multiselect:G,googleMap:Y},props:{firebaseSettings:Object,map_key:String,service_location:Array,vehicle_type:Array,app_for:String,baseUrl:String,default_location:Object},setup(s){W(),b(null);const o=b(null),u=b(null),a=b([]),I=b([]),E=b(s.service_location.map(i=>({value:i.id,label:i.name}))),O=b(s.vehicle_type.map(i=>({value:i.id,label:i.name}))),V=b({}),x=()=>{o.value=null,u.value=null,a.value=[],w()},T=()=>{w()},w=async()=>{firebase.database().ref("drivers").once("value",L=>{const v=L.val();v&&(V.value={},I.value=[],Object.keys(v).forEach(h=>{const e=v[h],l=e.g,g=H(l);if(g&&e.service_location_id){let B=!!e.service_location_id;o.value&&(B=o.value==e.service_location_id);let A=Array.isArray(e.vehicle_types);u.value&&Array.isArray(e.vehicle_types)&&e.vehicle_types.length>0&&(A=(Array.isArray(e.vehicle_types)&&e.vehicle_types.some(_=>u.value===_))??!1);let j=a.value.length>0?a.value.includes("online"):!0,D=a.value.length>0?a.value.includes("onride"):!0,N=a.value.length>0?a.value.includes("offline"):!0,y=!1,k="offline",d="";if(e.hasOwnProperty("is_active")&&e.hasOwnProperty("is_available")){if(e.is_active==1&&e.is_available==!0&&j)y=!0,k="online";else if(e.is_active==1&&e.is_available==!1&&D)k="onride",y=!0;else if(N){y=!0;let _=new Date-new Date(e.updated_at),m=parseInt(_/6e4),M=0,S=0,U=0;m>59&&(M=parseInt(m/60),M>23&&(S=parseInt(M/24),S>6&&(U=parseInt(S/7)))),m<=1&&(d="just now"),m>1&&m<59&&(d=m+" minutes ago"),M==1&&(d="An hour ago"),M>1&&(d=M+" hours ago"),S==1&&(d="A day ago"),S>1&&(d=S+" days ago"),U==1&&(d="A week ago"),U>1&&(d=U+" weeks ago")}}if(B&&A&&y){e.status=k,e.last_seen=d,I.value.push(e);const _=`<strong>${e.name}</strong><br>Mobile: ${s.app_for=="demo"?"**********":e.mobile}`,m=document.createElement("div");m.innerHTML=_,V.value[e.id]={lat:g.lat,lng:g.lon,type_icon:e.vehicle_type_icon,info:m}}}}))})},H=i=>{const L="0123456789bcdefghjkmnpqrstuvwxyz",v=[16,8,4,2,1];let h=!0,e=-90,l=90,g=-180,B=180,A,j;if(i){for(let D=0;D<i.length;D++){let N=i.charAt(D),y=L.indexOf(N);for(let k=0;k<5;k++){let d=v[k];if(h){let _=(g+B)/2;y&d?g=_:B=_}else{let _=(e+l)/2;y&d?e=_:l=_}h=!h}}return A=(e+l)/2,j=(g+B)/2,{lat:A,lon:j}}};return q([o,u],()=>{w()}),J(async()=>{var i={apiKey:s.firebaseSettings.firebase_api_key,authDomain:s.firebaseSettings.firebase_auth_domain,databaseURL:s.firebaseSettings.firebase_database_url,projectId:s.firebaseSettings.firebase_project_id,storageBucket:s.firebaseSettings.firebase_storage_bucket,messagingSenderId:s.firebaseSettings.firebase_messaging_sender_id,appId:s.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(i),w()}),{serviceLocations:E,vehicleTypes:O,selectedServiceLocations:o,selectedDriverModes:a,driverMarkers:V,drivers_list:I,clearFilters:x,applyFilters:T,selectedVehicleTypes:u}}},te={class:"row"},se={class:"col-12 col-lg-3"},le={class:"mb-3"},ae={for:"select_location",class:"form-label"},oe={class:"col-12 col-lg-3"},ie={class:"mb-3"},ne={for:"select_driver_mode",class:"form-label"},re={class:"col-12 col-lg-3"},ce={class:"mb-3"},de={for:"vehicle_type",class:"form-label"},_e={class:"col-12 col-lg-6 d-flex gap-1"},fe={key:0,class:"overflow-auto",style:{height:"400px"}},ue={class:"accordion-item border-0"},me={class:"accordion-header",id:"headingThree"},ve={class:"accordion-button p-2 shadow-none","data-bs-toggle":"collapse",href:"#","aria-expanded":"false","aria-controls":"collapseThree"},be={class:"d-flex align-items-center"},pe={class:"flex-shrink-0 border border-4 rounded-circle",style:{border:"var(--landing_header_act_text)"}},he=["src"],ge={class:"d-flex justify-content-around"},ye={class:"flex-grow-1 ms-3"},ke={class:"fs-15 mb-1 fw-semibold",style:{color:"var(--landing_header_act_text)"}},we={class:"fs-15 mb-1 fw-normal",style:{color:"var(--landing_header_act_text)"}},Be={class:"fs-15 mb-1 fw-normal"},Me={class:"text-end ms-5 d-block"},Se={key:0,class:"fs-15 mb-1 fw-semibold text-danger"},Ce={key:1,class:"fs-15 mb-1 fw-semibold text-success"},Ve={key:2,class:"fs-15 mb-1 fw-semibold text-primary"},xe={class:"flex-grow-1 fs-15 mb-1 text-muted mt-5"},Le={key:1,class:"d-flex",style:{height:"400px"}},Ae={id:"map",style:{height:"400px"}};function De(s,o,u,a,I,E){const O=f("Head"),V=f("PageHeader"),x=f("Multiselect"),T=f("BButton"),w=f("BCardHeader"),H=f("BCard"),i=f("BCol"),L=f("googleMap"),v=f("BRow"),h=f("BCardBody"),e=f("Layout");return p(),R(e,null,{default:c(()=>[n(O,{title:s.$t("gods-eye")},null,8,["title"]),n(V,{title:s.$t("gods-eye"),pageTitle:s.$t("dispatch")},null,8,["title","pageTitle"]),n(v,null,{default:c(()=>[n(i,{lg:"12"},{default:c(()=>[n(H,{"no-body":"",id:"tasksList"},{default:c(()=>[n(w,{class:"border-0"},{default:c(()=>[t("h4",null,r(s.$t("filters")),1),t("div",te,[t("div",se,[t("div",le,[t("label",ae,r(s.$t("service_location")),1),n(x,{modelValue:a.selectedServiceLocations,"onUpdate:modelValue":o[0]||(o[0]=l=>a.selectedServiceLocations=l),options:a.serviceLocations,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:s.$t("select_service_locations")},null,8,["modelValue","options","placeholder"])])]),t("div",oe,[t("div",ie,[t("label",ne,r(s.$t("drivers")),1),n(x,{modelValue:a.selectedDriverModes,"onUpdate:modelValue":o[1]||(o[1]=l=>a.selectedDriverModes=l),id:"select_driver_mode",mode:"tags","close-on-select":!1,searchable:!0,"create-option":!1,options:[{value:"offline",label:s.$t("offline")},{value:"online",label:s.$t("online")},{value:"onride",label:s.$t("onride")}],placeholder:s.$t("select_mode")},null,8,["modelValue","options","placeholder"])])]),t("div",re,[t("div",ce,[t("label",de,r(s.$t("vehicle_types")),1),n(x,{modelValue:a.selectedVehicleTypes,"onUpdate:modelValue":o[2]||(o[2]=l=>a.selectedVehicleTypes=l),options:a.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:s.$t("select_vehicle_types")},null,8,["modelValue","options","placeholder"])])]),t("div",_e,[n(T,{type:"button",variant:"success",class:"btn btn-md",onClick:a.applyFilters},{default:c(()=>[F(r(s.$t("apply")),1)]),_:1},8,["onClick"]),n(T,{type:"button",variant:"danger",class:"btn btn-md",onClick:a.clearFilters},{default:c(()=>[F(r(s.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),n(h,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[n(v,null,{default:c(()=>[n(i,{lg:"4"},{default:c(()=>[a.drivers_list.length>0?(p(),C("div",fe,[(p(!0),C(K,null,Q(a.drivers_list,l=>(p(),R(H,{class:"col-lg-12"},{default:c(()=>[t("div",ue,[t("div",me,[t("a",ve,[t("div",be,[t("div",pe,[t("img",{src:l.profile_picture,alt:"",class:"avatar-md rounded-circle"},null,8,he)]),t("div",ge,[t("div",ye,[t("h4",ke,r(l.name),1),t("h6",we,r(u.app_for=="demo"?"*********":l.mobile),1),t("h6",Be,[F(r(l.rating)+" ",1),o[3]||(o[3]=t("i",{class:"ri-star-fill text-warning align-bottom me-1"},null,-1))])]),t("div",Me,[l.status=="offline"?(p(),C("h4",Se,r(l.status),1)):P("",!0),l.status=="online"?(p(),C("h4",Ce,r(l.status),1)):P("",!0),l.status=="onride"?(p(),C("h4",Ve,r(l.status),1)):P("",!0),t("p",xe,r(l.last_seen),1)])])])])])])]),_:2},1024))),256))])):(p(),C("div",Le,o[4]||(o[4]=[t("img",{src:"/image/map/no-drivers.png",style:{width:"60%",margin:"auto"},alt:"No Drivers Found"},null,-1)])))]),_:1}),n(i,{lg:"8"},{default:c(()=>[t("div",Ae,[n(L,{baseUrl:u.baseUrl,default_location:u.default_location,nearbyDrivers:a.driverMarkers,map_key:u.map_key,libraries:["marker"]},{default:c(()=>[F(r(s.$t("map_loading")),1)]),_:1},8,["baseUrl","default_location","nearbyDrivers","map_key"])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ne=$(ee,[["render",De]]);export{Ne as default};

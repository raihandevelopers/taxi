import{_ as j,Z as I,C as R,r as M,T as G,X as v,D as J,g as y,o as c,x as V,w as C,a as F,N,k as T,i as d,l as e,n as K,J as r,q as E,K as q,F as S,L as B,B as g,p as X,M as Q,y as W}from"./vendor-ddfbd976.js";import{L as Y}from"./main-306a5ea6.js";import{P as $}from"./page-header-2dc95532.js";import{u as ee}from"./footer-e648049d.js";import"./app-042fb454.js";const se={components:{Layout:Y,PageHeader:$,Head:I},props:{zone:Object,successMessage:String,alertMessage:String,existingZones:Array},setup(a){const{zone:o}=a,{t:f}=R(),{languages:t,fetchData:D}=ee(),L=M("English"),h=M(a.successMessage||""),b=M(a.alertMessage||""),p=G({service_location_id:o.service_location_id,languageFields:o?o.languageFields||{}:{},unit:o.unit,coordinates:o.coordinates||[]}),k=M([]);let _,s,m=[];const x=v.latLngBounds(),A=async()=>{const n=await F.get("/zones/list");k.value=n.data.results},H=()=>{if(o&&o.coordinates){_=v.map("map").setView([0,0],10),v.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:"Â© OpenStreetMap"}).addTo(_);const n=new v.FeatureGroup;_.addLayer(n),a.existingZones.forEach(l=>{const i=l.map(u=>[u.lat,u.lng]);v.polygon(i,{color:"red",interactive:!1}).addTo(_)}),o.coordinates.forEach(l=>{const i=l[0].map(u=>[u.coordinates[1],u.coordinates[0]]);s=v.polygon(i,{color:"blue",weight:3,fillOpacity:.2}).addTo(n),x.extend(s.getBounds()),m.push(s)}),_.fitBounds(x),O(n)}},O=n=>{const l=new v.Control.Draw({edit:{featureGroup:n,remove:!0},draw:{polygon:{allowIntersection:!1},rectangle:!1,circle:!1,polyline:!1,marker:!1}});_.addControl(l),_.on(v.Draw.Event.CREATED,function(i){const u=i.layer;n.addLayer(u),m.push(u)}),_.on(v.Draw.Event.DELETED,function(i){i.layers.eachLayer(function(z){m=m.filter(w=>w!==z)})})},P=async()=>{const n=U();if(Object.keys(n).length===0)try{if(m.length===0){b.value=f("at_least_one_completed_polygon_is_required");return}const l=m.map(z=>z.getLatLngs()[0].map(w=>[w.lng,w.lat])),i={...p.data(),coordinates:JSON.stringify(l)};(await F.post(`/zones/update/${o.id}`,i)).status===200?(h.value=f("zone_created_successfully"),p.reset(),N.get("/zones")):console.error(f("failed_to_update_zone"))}catch(l){l.response&&l.response.status===403?(b.value=l.response.data.alertMessage,setTimeout(()=>{N.get("/zones")},5e3)):console.error(f("error_updating_zone"),l)}else p.errors=n},U=()=>{const{service_location_id:n,unit:l}=p,i={};return l?delete i.unit:i.unit="Unit is required",n?delete i.service_location_id:i.service_location_id=f("service_location_is_required"),i},Z=n=>{L.value=n};return J(async()=>{Object.keys(t).length==0&&await D(),H(),A()}),{form:p,serviceLocations:k,handleSubmit:P,setActiveTab:Z,languages:t,activeTab:L,successMessage:h,alertMessage:b}}},te={key:0,class:"row"},oe={class:"col-lg-6"},ae={class:"card"},ne={class:"card-body"},ie={class:"mb-3"},re={for:"service_location",class:"form-label"},le={value:"",disabled:""},ce=["value"],de={key:0,class:"text-danger"},_e={class:"nav nav-tabs nav-tabs-custom nav-success nav-justified",role:"tablist"},ue={class:"nav-item",role:"presentation"},me=["onClick"],ve=["id"],fe={class:"col-sm-6 mt-3"},pe={class:"mb-3"},ge=["for"],be=["placeholder","id","onUpdate:modelValue","required"],ye={class:"mb-3"},he={for:"select_unit",class:"form-label"},ke={disabled:"",value:""},we={value:"1"},Me={value:"2"},Le={key:0,class:"text-danger"},ze={class:"text-end"},Ce={type:"submit",class:"btn btn-primary"},Te={class:"mb-3"},Ee={key:0,class:"text-danger"},Se={key:1,class:"alert alert-success"},Be={key:2,class:"custom-alert alert alert-danger alert-border-left fade show",role:"alert",id:"alertMsg"},De={class:"alert-content"};function xe(a,o,f,t,D,L){const h=y("Head"),b=y("PageHeader"),p=y("BCol"),k=y("BRow"),_=y("Layout");return c(),V(_,null,{default:C(()=>[T(h,{title:"Edit Zone"}),T(b,{title:a.$t("edit"),pageTitle:a.$t("zone"),pageLink:"/zones"},null,8,["title","pageTitle"]),f.zone?(c(),d("div",te,[e("div",oe,[e("div",ae,[e("div",ne,[e("form",{onSubmit:o[2]||(o[2]=K((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[e("div",ie,[e("label",re,r(a.$t("service_location")),1),E(e("select",{class:"form-select",id:"service_location","onUpdate:modelValue":o[0]||(o[0]=s=>t.form.service_location_id=s)},[e("option",le,r(a.$t("select_service_location")),1),(c(!0),d(S,null,B(t.serviceLocations,s=>(c(),d("option",{key:s.id,value:s.id},r(s.name),9,ce))),128))],512),[[q,t.form.service_location_id]]),t.form.errors.service_location_id?(c(),d("span",de,r(t.form.errors.service_location_id),1)):g("",!0)]),e("ul",_e,[(c(!0),d(S,null,B(t.languages,s=>(c(),V(k,{key:s.code},{default:C(()=>[T(p,{lg:"12"},{default:C(()=>[e("li",ue,[e("a",{class:X(["nav-link",{active:t.activeTab===s.label}]),onClick:m=>t.setActiveTab(s.label),role:"tab","aria-selected":"true"},r(s.label),11,me)])]),_:2},1024)]),_:2},1024))),128))]),(c(!0),d(S,null,B(t.languages,s=>(c(),d("div",{class:"tab-content text-muted",key:s.code},[t.activeTab===s.label?(c(),d("div",{key:0,class:"tab-pane active show",id:`${s.label}`,role:"tabpanel"},[e("div",fe,[e("div",pe,[e("label",{for:`name-${s.code}`,class:"form-label"},r(a.$t("name")),9,ge),E(e("input",{type:"text",class:"form-control",placeholder:`Enter Name in ${s.label}`,id:`name-${s.code}`,"onUpdate:modelValue":m=>t.form.languageFields[s.code]=m,required:s.code==="en"},null,8,be),[[Q,t.form.languageFields[s.code]]])])])],8,ve)):g("",!0)]))),128)),e("div",ye,[e("label",he,r(a.$t("select_unit")),1),E(e("select",{id:"select_unit",class:"form-select","onUpdate:modelValue":o[1]||(o[1]=s=>t.form.unit=s)},[e("option",ke,r(a.$t("choose_unit")),1),e("option",we,r(a.$t("kilo_meter")),1),e("option",Me,r(a.$t("miles")),1)],512),[[q,t.form.unit]]),t.form.errors.unit?(c(),d("span",Le,r(t.form.errors.unit),1)):g("",!0)]),e("div",ze,[e("button",Ce,r(a.$t("update")),1)]),e("div",Te,[t.form.errors.coordinates?(c(),d("span",Ee,r(t.form.errors.coordinates),1)):g("",!0)])],32)])])]),o[4]||(o[4]=e("div",{class:"col-lg-6"},[e("div",{class:"card"},[e("div",{class:"card-body"},[e("div",{id:"map",style:{height:"400px"}})])])],-1))])):g("",!0),t.successMessage?(c(),d("div",Se,r(t.successMessage),1)):g("",!0),t.alertMessage?(c(),d("div",Be,[e("div",De,[o[5]||(o[5]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),o[6]||(o[6]=e("strong",null,"Alert",-1)),W(" - "+r(t.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:o[3]||(o[3]=(...s)=>a.dismissMessage&&a.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):g("",!0)]),_:1})}const He=j(se,[["render",xe],["__scopeId","data-v-d4446cb6"]]);export{He as default};

import{_ as J,O as Q,P as X,Z as $,z as ee,T as te,N as A,C as se,r as q,D as V,g as k,o as d,i as n,k as o,w as i,l as e,J as s,F as G,a as ae,U as N,x as C,y as b,B as c,n as K,L as Y}from"./vendor-ddfbd976.js";import{L as le}from"./main-306a5ea6.js";import{s as re}from"./searchbar-3acbc236.js";import{_ as ie}from"./UserWebMenu-2e0e812c.js";import{P as oe}from"./Pagination-f095ae3c.js";import{i as de}from"./app-042fb454.js";import"./footer-e648049d.js";const ne={props:{successMessage:String,alertMessage:String,serviceLocations:{type:Object,required:!0},googleMapKey:String,pick_icon:String,drop_icon:String,stop_icon:String,rejected_drivers:Object,firebaseConfig:Object,request:Object,user:Object,supportTicket:Boolean},data(){return{searchTerm:""}},components:{Layout:le,Multiselect:Q,flatPickr:X,Head:$,searchbar:re,UserWebMenu:ie,Pagination:oe,Link:ee,useForm:te,router:A},setup(l){const{t:a}=se(),r=q(l.request),t=q(l.rejected_drivers),E=q(!1),U=q(l.request?l.request.requestStops.data:[]),z=q([]),j=q(l.successMessage||""),M=q(l.alertMessage||""),D=()=>{j.value="",M.value=""},F=u=>{const v=document.getElementById("map").offsetWidth,S=u.getSouthWest().lng();let f=u.getNorthEast().lng()-S;return f<0&&(f+=360),Math.floor(Math.log(v*360/f/256)/Math.LN2)},{googleMapKey:h}=l,L=()=>{const u=l.pick_icon,m=l.drop_icon,v=r.value,S=new google.maps.LatLng(v.pick_lat,v.pick_lng),T=new google.maps.LatLng(v.drop_lat,v.drop_lng),f=v.stops,I=[];f&&f.forEach(g=>{const R=new google.maps.LatLng(g.latitude,g.longitude);I.push(R)});const O=new google.maps.LatLngBounds;O.extend(S),O.extend(T),I.forEach(g=>{O.extend(g)});const P=new google.maps.Map(document.getElementById("map"),{center:{lat:v.pick_lat,lng:v.pick_lng},zoom:F(O)});if(new google.maps.Marker({position:S,icon:u,map:P}),V(async()=>{try{const g=l.firebaseConfig;firebase.apps.length||firebase.initializeApp(g),firebase.database().ref(`requests/${r.value.id}`).on("value",function(Z){const x=Z.val();x.is_completed&&(r.value.is_completed=!0),x.accept!==1&&(r.value.driver_id=null),x.driver_id&&(r.value.driver_id=x.driver_id),x.hasOwnProperty("modified_by_driver")&&(r.value.is_driver_started=1),x.trip_arrived==1&&(r.value.is_driver_arrived=!0),x.trip_start==1&&(r.value.is_trip_start=!0),x.is_completed&&(r.value.is_completed=!0),(x.is_cancelled||x.is_cancel)&&(r.value.is_cancelled=!0)})}catch(g){console.error(a("error_initializing_firebase_or_fetching_settings"),g)}}),new google.maps.Marker({position:T,icon:m,map:P}),I.forEach(g=>{new google.maps.Marker({position:g,icon:m,map:P})}),P.fitBounds(O),v.poly_line){const g=google.maps.geometry.encoding.decodePath(v.poly_line);g.length>0&&new google.maps.Polyline({path:g,geodesic:!0,strokeColor:"#0066FF",strokeOpacity:4,strokeWeight:5}).setMap(P)}},B=()=>{E.value=!1},y=async u=>{try{const m=await ae.get(`/rides-request/cancel/${u}`);r.value=m.data.request,E.value=!1,N.fire(a("success"),a("trip_cancelled_successfully"),"success")}catch{N.fire(a("error"),a("failed_to_cancel_trip"),"error")}},_=q(""),W=()=>{const u=new Date,m={weekday:"short",day:"numeric",month:"short",year:"numeric"};return u.toLocaleDateString("en-US",m)},p=async u=>{N.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel it!",cancelButtonText:"Close"}).then(async m=>{if(m.isConfirmed)try{await y(u)}catch(v){console.error(a("error_deleting_data"),v),N.fire(a("error"),a("failed_to_delete_the_data"),"error")}})};V(async()=>{const u=localStorage.getItem("locale")||"en";if(await de(u),console.log(r.value),!r.value.is_cancelled&&!r.value.is_completed)try{const m=l.firebaseConfig;firebase.apps.length||firebase.initializeApp(m),firebase.database().ref(`requests/${r.value.id}`).on("value",T=>{const f=T.val();f&&(f.hasOwnProperty("is_completed")&&(r.value.is_completed=!0,_.value=a("ride_completed"),setTimeout(()=>{window.location.reload()},2e3)),f.accept!==1&&(r.value.driver_id=null,_.value=a("searching")),f.driver_id&&r.value.driver_id&&window.location.reload(),r.value.is_later&&f.hasOwnProperty("modified_by_driver")&&(_.value=a("driver_started"),r.value.is_driver_started=1),f.trip_arrived==1&&(_.value=a("driver_arrived"),r.value.is_driver_arrived=!0,r.value.converted_arrived_at||(r.value.converted_arrived_at=W())),f.trip_start==1&&(_.value=a("on_trip"),r.value.is_trip_start=!0,r.value.converted_trip_start_time||(r.value.converted_trip_start_time=W())),(f.is_cancelled||f.is_cancel)&&(r.value.is_cancelled=!0,setTimeout(()=>{window.location.reload()},2e3)))})}catch(m){console.error("Error initializing Firebase or fetching settings:",m)}else r.value.is_cancelled?_.value=a("ride_cancelled"):r.value.is_completed?_.value=a("ride_completed"):r.value.is_result.value_start?_.value=a("on_trip"):r.value.is_driver_arrived?_.value=a("driver_arrived"):r.value.is_later&&r.value.is_driver_started?_.value=a("driver_started"):r.value.driver_id?_.value=a("accepted"):r.value.is_later?_.value=a("upcoming"):_.value=a("searching")}),V(()=>{if(!h){console.error(a("google_map_api_key_is_null_or_undefined"));return}const u=document.createElement("script");u.src=`https://maps.googleapis.com/maps/api/js?key=${h}&libraries=geometry`,u.onload=()=>{L()},document.head.appendChild(u)});const w=q(a("normal"));return r.value.is_bid_ride&&(w.value=a("bidding")),r.value.is_rental&&(w.value=a("rental")),r.value.is_out_station&&(r.value.is_round_trip?w.value=a("round_trip_outstation_trip"):w.value=a("one_way_outstation_trip")),{result:r,modalShow:E,successMessage:j,alertMessage:M,paymentGateways:z,rejected_drivers:t,deleteModal:p,closeModal:B,stops:U,dispatch_type:w,deleteData:y,rideStatus:_,dismissMessage:D,createTicket:async()=>{A.get("/create-ticket",{id:r.value.id,titleType:"request"})}}}},ce={class:"row"},_e={class:"col-sm-12"},ue={class:"card"},me={class:"d-flex m-auto"},fe={class:"text-center p-3 fs-18"},pe={class:"badge bg-primary-subtle text-primary p-3"},ve={class:"text-center p-3 fs-18"},ge={class:"badge bg-success-subtle text-success p-3"},he={class:"d-flex align-items-center"},be={class:"avatar-md flex-shrink-0"},ye={class:"avatar-title bg-light rounded-circle"},ke=["src"],we={class:"flex-grow-1 ms-3"},xe={class:"fs-14 mb-1"},Be={class:"text-muted fs-12 mb-0"},qe={class:"text-muted fs-12 mb-0"},Ce={class:"d-flex align-items-center"},Le={class:"flex-grow-1 ms-3"},Me={class:"fs-14 mb-1"},De={class:"text-muted fs-14 mb-2 mt-2"},Se={class:"d-flex align-items-center"},Te={class:"flex-grow-1 ms-3"},Oe={class:"fs-14 mb-1"},Pe={class:"text-muted fs-14 mb-2 mt-2"},Ee={class:"d-flex align-items-center"},je={class:"flex-grow-1 ms-3"},We={class:"fs-14 mb-1"},Ne={class:"text-muted fs-14 mb-2 mt-2"},ze={class:"text-dark"},Fe={key:0,class:"flex-grow-1 ms-3"},He={class:"fs-14 mb-1"},Ie={class:"text-muted fs-14 mb-2 mt-2"},Re={class:"text-dark"},Ve={class:"flex-grow-1 ms-3"},Ge={class:"fs-14 mb-1"},Ue={class:"text-muted fs-14 mb-2 mt-2"},Ae={class:"text-dark"},Ke={key:0},Ye={key:1,class:"fs-14 mb-1"},Ze={key:2,class:"text-muted fs-14 mb-2 mt-2"},Je={class:"text-dark"},Qe={class:"flex-shrink-0 text-end"},Xe={class:"mb-1 text-success"},$e={class:"text-muted fs-13 mb-0"},et={key:0},tt={key:1},st={key:2},at={class:"d-flex align-items-center"},lt={class:"flex-grow-1 ms-3"},rt={class:"fs-14 mb-1"},it={class:"text-muted fs-14 mb-2 mt-2"},ot={class:"text-center"},dt=["href"],nt={key:1,class:"text-muted"},ct={class:"text-center"},_t={class:"border-top border-top-dashed mt-2"},ut={class:"table table-borderless table-nowrap align-middle mb-0 m-auto",style:{width:"250px"}},mt={class:"text-end"},ft={class:"text-end"},pt={class:"text-end"},vt={key:0},gt={class:"text-end"},ht={class:"text-end"},bt={class:"text-end"},yt={key:1},kt={class:"text-end"},wt={key:2},xt={class:"text-end"},Bt={key:3},qt={class:"text-end"},Ct={key:4},Lt={class:"text-end"},Mt={key:5},Dt={key:0,class:"text-end"},St={key:1,class:"text-end"},Tt={key:2,class:"text-end"},Ot={key:3,class:"text-end"},Pt={class:"border-top border-top-dashed fs-15"},Et={scope:"row"},jt={class:"text-end"},Wt={id:"pay",class:"modal fade",tabindex:"-1","aria-labelledby":"payLabel","aria-hidden":"true",style:{display:"none"}},Nt={class:"modal-dialog"},zt={class:"modal-content"},Ft={class:"modal-header"},Ht={class:"modal-title",id:"payLabel"},It={class:"modal-body"},Rt=["src","alt"];function Vt(l,a,r,t,E,U){const z=k("Head"),j=k("UserWebMenu"),M=k("BCardHeader"),D=k("BButton"),F=k("Link"),h=k("BCol"),L=k("BRow"),B=k("BCardBody"),y=k("BCard"),_=k("BBadge"),W=k("BLink");return d(),n(G,null,[o(y,null,{default:i(()=>[o(z,{title:"Taxi Ride"}),o(M,{class:"border-0"},{default:i(()=>[o(j,{user:r.user},null,8,["user"])]),_:1}),o(L,null,{default:i(()=>[o(h,{lg:"12"},{default:i(()=>[o(y,{"no-body":"",id:"tasksList"},{default:i(()=>[o(M,{class:"border-0"},{default:i(()=>[e("h3",null,s(l.$t("view_details")),1),t.result.is_completed?(d(),C(F,{key:0,onClick:a[0]||(a[0]=K(p=>t.createTicket(t.result),["prevent"]))},{default:i(()=>[r.supportTicket==1?(d(),C(D,{key:0,variant:"primary",class:"float-end"},{default:i(()=>[a[2]||(a[2]=e("i",{class:"ri-add-line align-bottom me-1"},null,-1)),b(" "+s(l.$t("make_ticket")),1)]),_:1,__:[2]})):c("",!0)]),_:1})):c("",!0)]),_:1}),o(B,{class:"border border-dashed border-end-0 border-start-0"},{default:i(()=>[o(L,null,{default:i(()=>[o(h,{lg:"12"},{default:i(()=>[e("div",ce,[a[4]||(a[4]=e("div",{class:"mt-3"},null,-1)),e("div",_e,[e("div",ue,[a[3]||(a[3]=e("div",{class:"card-body"},[e("div",{id:"map",style:{height:"400px"}})],-1)),e("div",me,[e("div",fe,[e("span",pe,[b(s(l.$t("request_id"))+" : ",1),e("strong",null,s(t.result.request_number??"-"),1)])]),e("div",ve,[e("span",ge,[b(s(l.$t("ride_otp"))+" : ",1),e("strong",null,s(t.result.ride_otp??"-"),1)])])])])])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(L,null,{default:i(()=>[t.result.driverDetail?(d(),C(h,{key:0,lg:"4"},{default:i(()=>[o(y,{class:"card-animate border border-dashed border-primary"},{default:i(()=>[o(B,null,{default:i(()=>{var p,w,H,u,m;return[e("div",he,[e("div",be,[e("span",ye,[e("img",{src:(w=(p=t.result.driverDetail)==null?void 0:p.data)==null?void 0:w.profile_picture,class:"img-fluid avatar-md rounded-circle",alt:""},null,8,ke)])]),e("div",we,[e("h6",xe,s(t.result.driverDetail?(H=t.result.driverDetail.data)==null?void 0:H.name:"-"),1),e("p",Be,[a[5]||(a[5]=e("i",{class:"mdi mdi-circle-medium text-success fs-15 align-middle"},null,-1)),b(" "+s(t.result.driverDetail?(u=t.result.driverDetail.data)==null?void 0:u.mobile:"-"),1)]),e("p",qe,[a[6]||(a[6]=e("i",{class:"mdi mdi-circle-medium text-success fs-15 align-middle"},null,-1)),b(" "+s(t.result.driverDetail?(m=t.result.driverDetail.data)==null?void 0:m.email:"-"),1)])])])]}),_:1})]),_:1})]),_:1})):c("",!0),o(h,{lg:"4"},{default:i(()=>[o(y,{class:"card-animate border border-dashed border-primary"},{default:i(()=>[o(B,null,{default:i(()=>[e("div",Ce,[a[7]||(a[7]=e("div",{class:"avatar-xs flex-shrink-0"},[e("span",{class:"avatar-title bg-light rounded-circle"},[e("i",{class:"ri-map-pin-fill icon-dual-success fs-18"})])],-1)),e("div",Le,[e("h6",Me,s(l.$t("pickup_location")),1),e("p",De,s(t.result.pick_address),1)])])]),_:1})]),_:1})]),_:1}),o(h,{lg:"4"},{default:i(()=>[t.result.drop_address?(d(),C(y,{key:0,class:"card-animate border border-dashed border-primary"},{default:i(()=>[o(B,null,{default:i(()=>[e("div",Se,[a[8]||(a[8]=e("div",{class:"avatar-xs flex-shrink-0"},[e("span",{class:"avatar-title bg-light rounded-circle"},[e("i",{class:"ri-map-pin-fill icon-dual-danger fs-18"})])],-1)),e("div",Te,[e("h6",Oe,s(l.$t("drop_location")),1),e("p",Pe,s(t.result.drop_address),1)])])]),_:1})]),_:1})):c("",!0)]),_:1}),o(h,{lg:"6"},{default:i(()=>[o(y,{class:"card-animate border border-dashed border-primary"},{default:i(()=>[o(B,null,{default:i(()=>[e("div",Ee,[a[10]||(a[10]=e("div",{class:"avatar-xs flex-shrink-0"},[e("span",{class:"avatar-title bg-light rounded-circle"},[e("i",{class:"ri-route-fill icon-dual-primary fs-18"})])],-1)),e("div",je,[e("h6",We,s(l.$t("trip_status"))+s(t.result.is_bid_ride?l.$t("bidding"):""),1),e("span",Ne,[e("div",null,[e("p",ze,s(t.rideStatus),1),!t.result.is_cancelled&&!t.result.is_trip_start?(d(),C(D,{key:0,class:"btn btn-danger btn-md",type:"button",onClick:a[1]||(a[1]=K(p=>t.deleteModal(t.result.id),["prevent"]))},{default:i(()=>[a[9]||(a[9]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),b(" "+s(l.$t("cancel")),1)]),_:1,__:[9]})):c("",!0),t.paymentGateways.length>0?(d(),C(D,{key:1,"data-bs-toggle":"modal","data-bs-target":"#pay",class:"btn btn-success btn-md",type:"button"},{default:i(()=>[b(s(l.$t("pay")),1)]),_:1})):c("",!0)])])]),t.result.rental_package_name!=="-"?(d(),n("div",Fe,[e("h6",He,s(l.$t("rental_pack")),1),e("span",Ie,[e("div",null,[e("p",Re,s(t.result.rental_package_name),1)])])])):c("",!0),e("div",Ve,[e("h6",Ge,s(l.$t("ride_type")),1),e("span",Ue,[e("div",null,[e("p",Ae,s(t.dispatch_type),1)])]),t.result.is_completed?c("",!0):(d(),n("p",Ke,s(l.$t("tripStarted"))+" : "+s(t.result.converted_trip_start_time),1)),t.result.is_round_trip?(d(),n("h6",Ye,s(l.$t("return_time")),1)):c("",!0),t.result.is_round_trip?(d(),n("span",Ze,[e("div",null,[e("p",Je,s(t.result.return_time),1)])])):c("",!0)]),e("div",Qe,[e("h6",Xe,s(t.result.vehicle_type_name??"-"),1),e("p",$e,[t.result.transport_type==="taxi"?(d(),n("span",et,s(l.$t("taxi"))+" "+s(t.result.is_bid_ride?l.$t("bidding"):""),1)):t.result.transport_type==="delivery"?(d(),n("span",tt,s(l.$t("delivery"))+" "+s(t.result.is_bid_ride?l.$t("bidding"):""),1)):(d(),n("span",st,s(l.$t("all")),1))])])])]),_:1})]),_:1})]),_:1}),t.stops.length>0?(d(),C(h,{key:1,lg:"4"},{default:i(()=>[o(y,{class:"card-animate border border-dashed border-primary"},{default:i(()=>[o(B,null,{default:i(()=>[e("div",at,[a[11]||(a[11]=e("div",{class:"avatar-xs flex-shrink-0"},[e("span",{class:"avatar-title bg-light rounded-circle"},[e("i",{class:"ri-map-pin-fill icon-dual-danger fs-18"})])],-1)),e("div",lt,[e("h6",rt,s(l.$t("location")),1),(d(!0),n(G,null,Y(t.stops,(p,w)=>(d(),n("p",it,s(p.address),1))),256))])])]),_:1})]),_:1})]),_:1})):c("",!0)]),_:1}),o(L,null,{default:i(()=>{var p;return[e("div",ot,[t.result.driverDetail&&((p=t.result.driverDetail.data)!=null&&p.mobile)?(d(),n("a",{key:0,href:`tel:${t.result.driverDetail.data.mobile}`,type:"button",class:"btn btn-success btn-label waves-effect waves-light fs-18"},[a[12]||(a[12]=e("i",{class:"ri-phone-fill label-icon align-middle fs-16 me-2"},null,-1)),b(" "+s(l.$t("call")),1)],8,dt)):(d(),n("span",nt))]),t.result.requestBill?(d(),C(h,{key:0,lg:"12"},{default:i(()=>[o(y,null,{default:i(()=>[o(B,null,{default:i(()=>[e("h4",ct,s(l.$t("fare_breakup")),1),e("div",_t,[e("table",ut,[e("tbody",null,[e("tr",null,[e("td",null,s(l.$t("base_price")),1),e("td",mt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.base_price),1)]),e("tr",null,[e("td",null,s(l.$t("distance_price")),1),e("td",ft,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.distance_price),1)]),e("tr",null,[e("td",null,s(l.$t("time_price")),1),e("td",pt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.time_price),1)]),t.result.requestBill.data.cancellation_fee>0?(d(),n("tr",vt,[e("td",null,s(l.$t("cancellation_fee")),1),e("td",gt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.cancellation_fee),1)])):c("",!0),e("tr",null,[e("td",null,s(l.$t("service_tax")),1),e("td",ht,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.service_tax),1)]),e("tr",null,[e("td",null,s(l.$t("convenience_fee")),1),e("td",bt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.admin_commision),1)]),t.result.requestBill.data.promo_discount>0?(d(),n("tr",yt,[e("td",null,s(l.$t("promo_discount")),1),e("td",kt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.promo_discount),1)])):c("",!0),t.result.requestBill.data.tips>0?(d(),n("tr",wt,[e("td",null,s(l.$t("driver_tips")),1),e("td",xt,s(t.result.requested_currency_symbol)+s(t.result.requestBill.data.tips),1)])):c("",!0),t.result.requestBill.data.waiting_charge>0?(d(),n("tr",Bt,[e("td",null,s(l.$t("waiting_charge"))+"("+s(l.$t("For"))+" "+s(t.result.requestBill.data.waiting_charge)+" min)",1),e("td",qt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.waiting_charge),1)])):c("",!0),t.result.requestBill.data.airport_surge_fee>0&&t.result.transport_type==="taxi"?(d(),n("tr",Ct,[e("td",null,s(l.$t("airport_surge_fee")),1),e("td",Lt,s(t.result.requested_currency_symbol)+s(t.result.requestBill.data.airport_surge_fee),1)])):c("",!0),t.result.payment_opt?(d(),n("tr",Mt,[e("td",null,s(l.$t("payment_option")),1),t.result.payment_opt==0?(d(),n("td",Dt,[o(_,{variant:"success",class:"text-uppercase"},{default:i(()=>[b(s(l.$t("card")),1)]),_:1})])):c("",!0),t.result.payment_opt==1?(d(),n("td",St,[o(_,{variant:"success",class:"text-uppercase"},{default:i(()=>[b(s(l.$t("cash")),1)]),_:1})])):c("",!0),t.result.payment_opt==2?(d(),n("td",Tt,[o(_,{variant:"success",class:"text-uppercase"},{default:i(()=>[b(s(l.$t("wallet")),1)]),_:1})])):c("",!0),t.result.payment_opt==3?(d(),n("td",Ot,[o(_,{variant:"success",class:"text-uppercase"},{default:i(()=>[b(s(l.$t("wallet/cash")),1)]),_:1})])):c("",!0)])):c("",!0),e("tr",Pt,[e("th",Et,s(l.$t("total")),1),e("th",jt,s(t.result.requested_currency_symbol)+" "+s(t.result.requestBill.data.total_amount),1)])])])])]),_:1})]),_:1})]),_:1})):c("",!0)]}),_:1})]),_:1}),e("div",Wt,[e("div",Nt,[e("div",zt,[e("div",Ft,[e("h5",Ht,s(l.$t("payment_option")),1),a[13]||(a[13]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",It,[o(L,{style:{"max-height":"400px","overflow-y":"auto"}},{default:i(()=>[(d(!0),n(G,null,Y(t.paymentGateways,(p,w)=>(d(),C(h,{lg:"12"},{default:i(()=>[o(W,{href:p.url+`?user_id=${r.user.id}&request_id=${t.result.id}&amount=${t.result.requestBill.data.total_amount}`,class:"d-flex"},{default:i(()=>[e("img",{src:p.image,alt:p.gateway,width:"200",class:"img-fluid m-auto"},null,8,Rt)]),_:2},1032,["href"])]),_:2},1024))),256))]),_:1})])])])])],64)}const Xt=J(ne,[["render",Vt]]);export{Xt as default};

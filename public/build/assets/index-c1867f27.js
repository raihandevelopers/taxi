import{_ as ut,Z as _t,O as mt,P as ft,z as pt,C as gt,r as u,T as W,Q as ht,R as vt,a as B,g as c,o as _,x as yt,w as d,U as b,N as $,k as i,l as t,J as o,q as O,K as G,i as m,L as J,F as K,y as f,B as E,n as Z,W as X}from"./vendor-ddfbd976.js";import{L as bt}from"./main-306a5ea6.js";import{P as kt}from"./page-header-2dc95532.js";import{P as wt}from"./Pagination-f095ae3c.js";import{s as Ct}from"./searchbar-3acbc236.js";import{u as Bt,l as xt}from"./footer-e648049d.js";import{_ as St}from"./search-file-ab3e1046.js";import"./app-042fb454.js";const Mt={data(){return{rightOffcanvas:!1,counts:{open:0,acknowledge:0,closed:0,total:0}}},components:{Layout:bt,PageHeader:kt,Head:_t,Pagination:wt,Multiselect:mt,flatPickr:ft,Link:pt,searchbar:Ct},props:{successMessage:String,alertMessage:String,app_for:String,employees:Array,ticket:Object,support_ticket:Array,admin:Array},setup(a){const{t:e}=gt(),T=u(""),{selectedLocation:n}=Bt(),g=W({support_type:null,service_location_id:"all",status:null,limit:10}),h=u([]),x=u({}),S=u(!1),v=u(!1),D=u(null),k=u(!1),M=u([]);u(a.support_ticket);const P=u(),V=u(null),A=u({}),H=u(a.admin),w=W({assign_to:a.ticket&&a.ticket.assign_to||""}),j={assign_to:{required:!0}},R=u(a.successMessage||""),U=u(a.alertMessage||""),N=()=>{R.value="",U.value=""},L=u(!1),I=()=>{y(),v.value=!0,L.value=!1},z=()=>{g.reset(),y(),L.value=!1},s=()=>{S.value=!1},F=async l=>{try{await B.delete(`/title/delete/${l}`);const r=h.value.findIndex(p=>p.id===l);r!==-1&&h.value.splice(r,1),S.value=!1,b.fire(e("success"),e("title_deleted_successfully"),"success")}catch{b.fire(e("error"),e("failed_to_delete_title"),"error")}},Y=async l=>{b.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, delete it!"}).then(async r=>{if(r.isConfirmed)try{await F(l)}catch(p){console.error(e("error_deleting_data"),p),b.fire(e("error"),e("failed_to_delete_the_data"),"error")}})},tt=async l=>{T.value=l,y()},y=async(l=1)=>{try{const r=g.data();r.search=T.value,r.page=l;const p=await B.get("/support-tickets/list",{params:r});h.value=p.data.results,console.log("result",h.value),x.value=p.data.paginator,rt(x.value.total),v.value=!1}catch(r){console.error(e("error_fetching_title"),r)}},et=async(l,r,p)=>{b.fire({title:e("are_you_sure"),text:e("you_are_about_to_change_status"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:e("yes"),cancelButtonText:e("cancel")}).then(async q=>{if(q.isConfirmed)try{await B.post("/support-tickets/update-status",{id:l,status:r,employee_id:p});const C=h.value.findIndex(ct=>ct.id===l);C!==-1&&(h.value[C].active=r),b.fire(e("changed"),e("status_updated_successfully"),"success"),$.get("/support-tickets")}catch(C){console.error(e("error_updating_status"),C),b.fire(e("error"),e("failed_to_update_status"),"error")}})},st=async l=>{y(l)},ot=async l=>{$.get(`/title/edit/${l.id}`)},at=async l=>{k.value=!0,P.value=l;const r=P.value.ticket_title.category_type;r?await Q(r):console.error("Category type is undefined")},Q=async l=>{try{const r=await B.get(`/admins/list?category_type=${l}`),p=l.split(",");console.log(r.data.results),M.value=r.data.results.filter(q=>q.category_type&&p.some(C=>q.category_type.includes(C)))}catch(r){console.error("Error fetching employees:",r)}},nt=async()=>{console.log("data",w.data());try{const l=await B.post(`support-tickets/update/${P.value.id}`,{assign_to:w.assign_to});l.status===200||l.status===201?(w.reset(),$.get("/support-tickets")):console.error("Unexpected response status:",l.status)}catch(l){console.error("Error submitting form:",l)}},lt=l=>{switch(l){case 1:return"Pending";case 2:return"Acknowledge";case 3:return"Closed";default:return"Unknown"}},it=l=>{switch(l){case 1:return"primary";case 2:return"warning";case 3:return"danger";default:return"secondary"}},rt=()=>{A.value=[10,25,50,100,200,500]},dt=()=>{y()};return ht(n,l=>{g.service_location_id=l,y()}),{results:h,modalShow:S,deleteItemId:D,successMessage:R,alertMessage:U,filterData:I,deleteModal:Y,closeModal:s,deleteData:F,dismissMessage:N,searchTerm:T,fetchSearch:tt,paginator:x,modalFilter:v,clearFilter:z,fetchDatas:y,filter:g,handlePageChanged:st,editData:ot,rightOffcanvas:L,toggleActiveStatus:et,assignEmployees:at,showEmployess:k,employees_name:M,handleSubmit:nt,validationRules:j,validationRef:V,form:w,fetchEmployees:Q,getStatusLabel:lt,getStatusVariant:it,paginatorOption:A,changeEntriesPerPage:dt,employee_id:H,selectedLocation:n}},computed:{...xt,...vt(["permissions"])},methods:{async fetchTicketCounts(){try{const a=await B.get("/support-tickets/ticket-counts",{params:{service_location_id:this.selectedLocation}});this.counts=a.data}catch(a){console.error("Error fetching ticket counts:",a)}}},mounted(){this.filter.service_location_id=this.selectedLocation,this.fetchDatas(),this.fetchTicketCounts(),setInterval(this.fetchTicketCounts,1e4)}},Pt={class:"row"},Vt={class:"col-xxl-3 col-sm-6"},Lt={class:"card card-animate"},Ot={class:"card-body"},Et={class:"d-flex justify-content-between"},Tt={class:"fw-medium text-muted mb-0"},At={class:"mt-4 ff-secondary fw-semibold"},Rt={class:"counter-value","data-target":"547"},Ut={class:"col-xxl-3 col-sm-6"},Ft={class:"card card-animate"},qt={class:"card-body"},Dt={class:"d-flex justify-content-between"},Ht={class:"fw-medium text-muted mb-0"},jt={class:"mt-4 ff-secondary fw-semibold"},Nt={class:"counter-value","data-target":"547"},It={class:"col-xxl-3 col-sm-6"},zt={class:"card card-animate"},Yt={class:"card-body"},$t={class:"d-flex justify-content-between"},Gt={class:"fw-medium text-muted mb-0"},Jt={class:"mt-4 ff-secondary fw-semibold"},Kt={class:"counter-value","data-target":"124"},Qt={class:"col-xxl-3 col-sm-6"},Wt={class:"card card-animate"},Zt={class:"card-body"},Xt={class:"d-flex justify-content-between"},te={class:"fw-medium text-muted mb-0"},ee={class:"mt-4 ff-secondary fw-semibold"},se={class:"counter-value","data-target":"107"},oe={class:"d-flex align-items-center mt-3"},ae={class:"me-2 text-muted"},ne=["value"],le={class:"ms-2 text-muted"},ie={class:"d-flex align-items-center gap-2"},re={class:"table-responsive"},de={class:"table align-middle position-relative table-nowrap"},ce={class:"table-active"},ue={scope:"col"},_e={scope:"col"},me={scope:"col"},fe={scope:"col"},pe={scope:"col"},ge={scope:"col"},he={scope:"col"},ve={scope:"col"},ye={scope:"col"},be={key:0},ke={key:0},we={style:{cursor:"pointer"}},Ce={key:0},Be={key:1},xe={class:"dropdown"},Se={class:"dropdown-menu dropdown-menu-end"},Me={key:0,class:"dropdown-item",href:"#"},Pe=["onClick"],Ve=["onClick"],Le={key:1},Oe={colspan:"12",class:"text-center"},Ee={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},Te={class:"alert-content"},Ae={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},Re={class:"alert-content"},Ue={class:"row"},Fe={class:"col-sm-12"},qe={class:"mb-3"},De={for:"assing_to",class:"form-label"},He={value:"",disabled:""},je=["value"],Ne={class:"modal-footer v-modal-footer"},Ie={class:"offcanvas-body"},ze={class:"mb-4"},Ye={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},$e={selected:"",disabled:""},Ge={value:"1"},Je={value:"2"},Ke={value:"3"},Qe={class:"mb-4"},We={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Ze={class:"form-check form-check-inline"},Xe={class:"form-check-label",for:"general"},ts={class:"form-check form-check-inline"},es={class:"form-check-label",for:"request"},ss={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function os(a,e,T,n,g,h){const x=c("Head"),S=c("PageHeader"),v=c("BCol"),D=c("searchbar"),k=c("BButton"),M=c("BRow"),P=c("BCardHeader"),V=c("BBadge"),A=c("Link"),H=c("BCardBody"),w=c("BCard"),j=c("BLink"),R=c("FormValidation"),U=c("BModal"),N=c("BFrom"),L=c("BOffcanvas"),I=c("Pagination"),z=c("Layout");return _(),yt(z,null,{default:d(()=>[i(x,{title:"Tickets"}),i(S,{title:a.$t("tickets"),pageTitle:a.$t("support_management")},null,8,["title","pageTitle"]),t("div",Pt,[t("div",Vt,[t("div",Lt,[t("div",Ot,[t("div",Et,[t("div",null,[t("h5",Tt,o(a.$t("total_tickets")),1),t("h2",At,[t("span",Rt,o(g.counts.total??0),1)])]),e[14]||(e[14]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-success-subtle text-success rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])]),t("div",Ut,[t("div",Ft,[t("div",qt,[t("div",Dt,[t("div",null,[t("h5",Ht,o(a.$t("pending"))+" "+o(a.$t("tickets")),1),t("h2",jt,[t("span",Nt,o(g.counts.open??0),1)])]),e[15]||(e[15]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-info-subtle text-info rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])]),t("div",It,[t("div",zt,[t("div",Yt,[t("div",$t,[t("div",null,[t("h5",Gt,o(a.$t("assigned_tickets")),1),t("h2",Jt,[t("span",Kt,o(g.counts.acknowledge??0),1)])]),e[16]||(e[16]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-warning-subtle text-warning rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])]),t("div",Qt,[t("div",Wt,[t("div",Zt,[t("div",Xt,[t("div",null,[t("h5",te,o(a.$t("closed_tickets")),1),t("h2",ee,[t("span",se,o(g.counts.closed??0),1)])]),e[17]||(e[17]=t("div",null,[t("div",{class:"avatar-sm flex-shrink-0"},[t("span",{class:"avatar-title bg-danger-subtle text-danger rounded-circle fs-4"},[t("i",{class:"ri-ticket-2-line"})])])],-1))])])])])]),i(M,null,{default:d(()=>[i(v,{lg:"12"},{default:d(()=>[i(w,{"no-body":"",id:"tasksList"},{default:d(()=>[i(P,{class:"border-0"},{default:d(()=>[i(M,{class:"g-2"},{default:d(()=>[i(v,{md:"3"},{default:d(()=>[t("div",oe,[t("label",ae,o(a.$t("show")),1),O(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>n.filter.limit=s),onChange:e[1]||(e[1]=(...s)=>n.changeEntriesPerPage&&n.changeEntriesPerPage(...s)),class:"form-select form-select-sm w-auto"},[(_(!0),m(K,null,J(n.paginatorOption,s=>(_(),m("option",{key:s,value:s},o(s),9,ne))),128))],544),[[G,n.filter.limit]]),t("label",le,o(a.$t("entries")),1)])]),_:1}),i(v,{md:"3"}),i(v,{md:"auto",class:"ms-auto"},{default:d(()=>[t("div",ie,[i(D,{placeholder:"search_by_ticket_id",onSearch:n.fetchSearch},null,8,["onSearch"]),i(k,{variant:"danger",onClick:e[2]||(e[2]=s=>n.rightOffcanvas=!0)},{default:d(()=>[e[18]||(e[18]=t("i",{class:"ri-filter-2-line me-1 align-bottom"},null,-1)),f(" "+o(a.$t("filters")),1)]),_:1,__:[18]})])]),_:1})]),_:1})]),_:1}),i(H,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[t("div",re,[t("table",de,[t("thead",ce,[t("tr",null,[t("th",ue,o(a.$t("ticket_id")),1),t("th",_e,o(a.$t("title")),1),t("th",me,o(a.$t("support_type")),1),t("th",fe,o(a.$t("service_location")),1),t("th",pe,o(a.$t("user_name")),1),t("th",ge,o(a.$t("user_type")),1),t("th",he,o(a.$t("assign_to")),1),t("th",ve,o(a.$t("status")),1),t("th",ye,o(a.$t("action")),1)])]),n.results.length>0?(_(),m("tbody",be,[(_(!0),m(K,null,J(n.results,(s,F)=>(_(),m("tr",{key:F},[t("td",null,o(s.ticket_id),1),t("td",null,o(s.title),1),t("td",null,[f(o(s.support_type)+" ",1),s.request_id?(_(),m("span",ke,"("+o(s.request_id)+")",1)):E("",!0)]),t("td",null,o(s.service_location_name),1),t("td",null,o(s.user_name),1),t("td",null,o(s.user_type),1),t("td",we,[s!=null&&s.admin_details?(_(),m("span",Ce,[i(V,{variant:"success"},{default:d(()=>[f(o(s.admin_details.first_name),1)]),_:2},1024)])):(_(),m("span",Be,[i(V,{variant:"warning"},{default:d(()=>[f(o(a.$t("not_taken")),1)]),_:1})]))]),t("td",null,[i(V,{variant:n.getStatusVariant(s.status)},{default:d(()=>[f(o(n.getStatusLabel(s.status)),1)]),_:2},1032,["variant"])]),t("div",xe,[e[22]||(e[22]=t("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[t("span",{class:"text-muted fs-18"},[t("i",{class:"mdi mdi-dots-vertical"})])],-1)),t("div",Se,[s.status===1?(_(),m("a",Me,[e[19]||(e[19]=t("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),t("span",{onClick:Y=>n.toggleActiveStatus(s.id,2,n.employee_id.user_id)},o(a.$t("acknowledge")),9,Pe)])):E("",!0),s.status===2?(_(),m("a",{key:1,class:"dropdown-item",href:"#",onClick:Y=>n.toggleActiveStatus(s.id,3,n.employee_id.user_id)},[e[20]||(e[20]=t("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),t("span",null,o(a.$t("closed")),1)],8,Ve)):E("",!0),i(A,{class:"dropdown-item",href:`/support-tickets/view-details/${s.id}`},{default:d(()=>[e[21]||(e[21]=t("i",{class:"bx bx-radio-circle-marked align-center text-muted me-2"},null,-1)),f(" "+o(a.$t("view")),1)]),_:2,__:[21]},1032,["href"])])])]))),128))])):(_(),m("tbody",Le,[t("tr",null,[t("td",Oe,[e[23]||(e[23]=t("img",{src:St,alt:"Loading...",style:{width:"100px"}},null,-1)),t("h5",null,o(a.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),t("div",null,[n.successMessage?(_(),m("div",Ee,[t("div",Te,[e[24]||(e[24]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[25]||(e[25]=f()),e[26]||(e[26]=t("strong",null,"Success",-1)),f(" - "+o(n.successMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-success",onClick:e[3]||(e[3]=(...s)=>n.dismissMessage&&n.dismissMessage(...s)),"aria-label":"Close Success Message"})])])):E("",!0),n.alertMessage?(_(),m("div",Ae,[t("div",Re,[e[27]||(e[27]=t("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),e[28]||(e[28]=f()),e[29]||(e[29]=t("strong",null,"Alert",-1)),f(" - "+o(n.alertMessage)+" ",1),t("button",{type:"button",class:"btn-close btn-close-danger",onClick:e[4]||(e[4]=(...s)=>n.dismissMessage&&n.dismissMessage(...s)),"aria-label":"Close Alert Message"})])])):E("",!0)]),i(U,{modelValue:n.showEmployess,"onUpdate:modelValue":e[9]||(e[9]=s=>n.showEmployess=s),"hide-footer":"",title:a.$t("assign_to"),class:"v-modal-custom",size:"md"},{default:d(()=>[t("form",{onSubmit:e[8]||(e[8]=Z((...s)=>n.handleSubmit&&n.handleSubmit(...s),["prevent"])),enctype:"multipart/form-data"},[i(R,{form:n.form,rules:n.validationRules,ref:"validationRef"},{default:d(()=>[t("div",Ue,[t("div",Fe,[t("div",qe,[t("label",De,[f(o(a.$t("assign_to")),1),e[30]||(e[30]=t("span",{class:"text-danger"},"*",-1))]),O(t("select",{id:"assing_to",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=s=>n.form.assign_to=s)},[t("option",He,o(a.$t("select_title")),1),(_(!0),m(K,null,J(n.employees_name,s=>(_(),m("option",{key:s.first_name,value:s.user_id},o(s.first_name),9,je))),128))],512),[[G,n.form.assign_to]])])])]),t("div",Ne,[i(j,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:e[6]||(e[6]=s=>n.showEmployess=!1)},{default:d(()=>[e[31]||(e[31]=t("i",{class:"ri-close-line me-1 align-middle"},null,-1)),f(" "+o(a.$t("close")),1)]),_:1,__:[31]}),t("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:e[7]||(e[7]=Z((...s)=>n.handleSubmit&&n.handleSubmit(...s),["prevent"]))},o(a.$t("submit")),1)])]),_:1},8,["form","rules"])],32)]),_:1},8,["modelValue","title"]),i(L,{modelValue:n.rightOffcanvas,"onUpdate:modelValue":e[13]||(e[13]=s=>n.rightOffcanvas=s),placement:"end",title:a.$t("Ticket_filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:d(()=>[i(N,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:d(()=>[t("div",Ie,[t("div",ze,[t("label",Ye,o(a.$t("status")),1),O(t("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":e[10]||(e[10]=s=>n.filter.status=s)},[t("option",$e,o(a.$t("select")),1),t("option",Ge,o(a.$t("open")),1),t("option",Je,o(a.$t("acknowledge")),1),t("option",Ke,o(a.$t("closed")),1)],512),[[G,n.filter.status]])]),t("div",Qe,[t("label",We,o(a.$t("support_type")),1),t("div",null,[t("div",Ze,[O(t("input",{class:"form-check-input","onUpdate:modelValue":e[11]||(e[11]=s=>n.filter.support_type=s),type:"radio",name:"inlineRadioOptions",id:"general",value:"general"},null,512),[[X,n.filter.support_type]]),t("label",Xe,o(a.$t("general")),1)]),t("div",ts,[O(t("input",{class:"form-check-input","onUpdate:modelValue":e[12]||(e[12]=s=>n.filter.support_type=s),type:"radio",name:"inlineRadioOptions",id:"request",value:"request"},null,512),[[X,n.filter.support_type]]),t("label",es,o(a.$t("request")),1)])])])]),t("div",ss,[i(k,{variant:"light",onClick:n.clearFilter,class:"w-100"},{default:d(()=>[f(o(a.$t("clear_filter")),1)]),_:1},8,["onClick"]),i(k,{type:"submit",onClick:n.filterData,variant:"success",class:"w-100"},{default:d(()=>[f(o(a.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"]),i(I,{paginator:n.paginator,onPageChanged:n.handlePageChanged},null,8,["paginator","onPageChanged"])]),_:1})}const _s=ut(Mt,[["render",os]]);export{_s as default};

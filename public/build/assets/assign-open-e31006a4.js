import{_ as K,Z as X,z as Q,Y as ee,P as te,R as se,U as w,C as ae,r as x,D as oe,g as h,o as B,x as ie,w as l,a as ne,X as p,k as n,l as e,J as o,i as T,F as W,L as Y,B as Z,y as P,N as le}from"./vendor-ddfbd976.js";import{L as re}from"./main-306a5ea6.js";import{P as de}from"./page-header-2dc95532.js";import{F as ce}from"./FormValidation-a9047131.js";import"./footer-e648049d.js";import"./app-042fb454.js";const _e={data(){return{rightOffcanvas:!1}},components:{Layout:re,PageHeader:de,Head:X,Link:Q,Scrollbar:ee,FormValidation:ce,flatPickr:te},computed:{...se(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object},methods:{timer(){let a;w.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,onBeforeOpen:()=>{w.showLoading(),a=setInterval(()=>{w.getContent().querySelector("b").textContent=w.getTimerLeft()},100)},onClose:()=>{clearInterval(a)}}).then(t=>{t.dismiss===w.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(a){const{t}=ae(),r=x(!1),v=x(a.driver_radius??10),j=x(a.successMessage||""),H=x(a.alertMessage||""),N=()=>{j.value="",H.value=""},D=x([]),y=x(null),m=x(a.result),C=s=>{y.value=s,r.value=!0},R=async s=>{try{const c=await ne.post(`/ongoing-rides/assign-driver/${m.value.id}`,{driver_id:s.id});c.data.status?(r.value=!1,w.fire(t("success"),t("users_deleted_successfully"),"success")):(w.fire(t("Warning"),c.data.message,"warning"),console.log(c))}catch(c){w.fire(t("Warning"),response.data.message,"warning"),console.error(c)}},O=(s,c,_,u)=>{const L=(_-s)*Math.PI/180,k=(u-c)*Math.PI/180,g=Math.sin(L/2)*Math.sin(L/2)+Math.cos(s*Math.PI/180)*Math.cos(_*Math.PI/180)*Math.sin(k/2)*Math.sin(k/2);return 6371*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))},A=()=>{D.value=[];const s=firebase.database().ref("drivers");firebase.database().ref("requests").child(m.value.id).on("value",_=>{const u=_.val();(u.is_accept||u.hasOwnProperty("driver_id"))&&le.get(`/rides-request/view/${m.value.id}`)}),s.on("value",_=>{D.value=[],_.forEach(u=>{const i=u.val(),k=Date.now()-15*60*1e3;if(i.updated_at<k)return;const g=V(i.g);if(g)if(O(m.value.pick_lat,m.value.pick_lng,g.lat,g.lon)<=v.value&&i.is_available&&i.is_active&&i.vehicle_types.includes(m.value.vehicle_type_id)){let I=`/image/map/${i.vehicle_type_icon}-online.png`;const S=[g.lat,g.lon];if(D.value.push(i),f[i.id])q(f[i.id],f[i.id].getLatLng(),S),f[i.id].setIcon(p.icon({iconUrl:I,iconSize:[30,30]}));else{const z=p.marker(S,{icon:p.icon({iconUrl:I,iconSize:[30,30]})}).addTo(b);z.bindTooltip(`<strong>${i.name}</strong><br>Mobile: ${app_for=="demo"?"***********":i.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),f[i.id]=z,q(z,z.getLatLng(),S)}}else M(i.id)})}),s.on("child_changed",_=>{const u=_.val();d(u)}),s.on("child_removed",_=>{const u=_.val();M(u.id)})},V=s=>{const c="0123456789bcdefghjkmnpqrstuvwxyz",_=[16,8,4,2,1];let u=!0,i=-90,L=90,k=-180,g=180,$,I;if(s){for(let S=0;S<s.length;S++){let z=s.charAt(S),F=c.indexOf(z);for(let E=0;E<5;E++){let G=_[E];if(u){let U=(k+g)/2;F&G?k=U:g=U}else{let U=(i+L)/2;F&G?i=U:L=U}u=!u}}return $=(i+L)/2,I=(k+g)/2,{lat:$,lon:I}}return null},q=(s,c,_)=>{s.setLatLng(_).update()},d=s=>{const c=V(s.g);if(c){const _=[c.lat,c.lon],u=`/image/map/${s.vehicle_type_icon}.png`;if(f[s.id])q(f[s.id],f[s.id].getLatLng(),_),f[s.id].setIcon(p.icon({iconUrl:u,iconSize:[30,30]}));else{const i=p.marker(_,{icon:p.icon({iconUrl:u,iconSize:[30,30]})}).addTo(b);f[s.id]=i}}else console.error(`${t("failed_to_decode_geohash")} ${s.id}`)},M=s=>{f[s]&&(b.removeLayer(f[s]),delete f[s])};let b,f={};const J=()=>{b=p.map("map").setView([m.value.pick_lat,m.value.pick_lng],15),p.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(b);const s=p.icon({iconUrl:"/image/map/pickup.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});p.marker([m.value.pick_lat,m.value.pick_lng],{icon:s}).addTo(b),A()};return oe(async()=>{try{var s={apiKey:a.firebaseSettings.firebase_api_key,authDomain:a.firebaseSettings.firebase_auth_domain,databaseURL:a.firebaseSettings.firebase_database_url,projectId:a.firebaseSettings.firebase_project_id,storageBucket:a.firebaseSettings.firebase_storage_bucket,messagingSenderId:a.firebaseSettings.firebase_messaging_sender_id,appId:a.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(s),J()}catch(c){console.error(t("error_initializing_firebase_or_fetching_settings"),c)}}),{modalShow:r,successMessage:j,alertMessage:H,modalDriver:y,assignDriver:R,assignModal:C,fleetDrivers:D,dismissMessage:N,errors:{}}}},ue={class:"col-lg-3"},me={class:"card-header"},fe={class:"card-title mb-0"},ve={class:"card-body p-4 text-center"},ge={class:"mx-auto avatar-md mb-3"},he=["src"],pe={class:"card-title mb-1"},be={class:"text-muted mb-0"},ye={class:"col-lg-3"},ke={class:"card-header"},we={class:"card-title mb-0"},Me={class:"card-body p-4 text-center"},Le={class:"mx-auto avatar-md mb-3"},Se=["src"],xe={class:"card-title mb-1"},Be={class:"col-lg-6"},De={class:"card-header"},Ce={class:"card-title mb-0"},Ie={class:"card-body p-4"},ze={class:"mb-2"},Te={class:"mb-2"},Pe={key:0},Re={class:"mb-2"},qe={class:"mb-2"},Ue={class:"btn-group mb-2"},Ve={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},$e={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},je={class:"dropdown-item overflow-auto"},He={key:1},Ne={class:"mb-2"},Oe={class:"mb-2"},Ae={class:"row"},Ee={class:"col-12 col-lg-4",style:{"overflow-x":"auto"}},Fe={class:"row"},Ge={class:"row"},We=["onClick"],Ye={class:"col-sm-3 border-end d-flex align-items-center justify-content-center"},Ze=["src"],Je={class:"col-sm-5 mt-3 border-end"},Ke={class:"d-flex align-items-center"},Xe={class:"d-flex align-items-center"},Qe={class:"d-flex align-items-center"},et={class:"col-sm-4 d-flex align-items-center justify-content-center"},tt={type:"button",class:"btn btn-info btn-label waves-effect waves-light"},st={class:"col-12 col-lg-8"},at={class:"mb-3 text-center m-auto"},ot={id:"map",style:{height:"500px"}},it={class:"col-lg-12"},nt={class:"card-header"},lt={class:"card-title mb-0"},rt={class:"card-body p-4 text-center"},dt={class:"mx-auto avatar-md mb-3"},ct=["src"],_t={class:"card-title mb-1"},ut={class:"text-muted mb-0"},mt={class:"text-muted mb-0"},ft={class:"modal-footer v-modal-footer"};function vt(a,t,r,v,j,H){const N=h("Head"),D=h("PageHeader"),y=h("BRow"),m=h("BCardBody"),C=h("BCard"),R=h("BCol"),O=h("BCardHeader"),A=h("BLink"),V=h("BModal"),q=h("Layout");return B(),ie(q,null,{default:l(()=>[n(N,{title:"Taxi Ride"}),n(D,{title:a.$t("book"),pageTitle:a.$t("taxi_ride"),pageLink:"/ongoing-rides"},null,8,["title","pageTitle"]),n(y,null,{default:l(()=>[n(R,null,{default:l(()=>[n(C,null,{default:l(()=>[n(m,null,{default:l(()=>[n(y,null,{default:l(()=>[e("div",ue,[e("div",me,[e("h6",fe,o(a.$t("user_details")),1)]),e("div",ve,[e("div",ge,[e("img",{src:r.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,he)]),e("h5",pe,o(r.result.userDetail.data.name),1),e("p",be,o(r.app_for=="demo"?"***********":r.result.userDetail.data.mobile),1)])]),e("div",ye,[e("div",ke,[e("h6",we,o(a.$t("vehicle_details")),1)]),e("div",Me,[e("div",Le,[e("img",{src:r.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,Se)]),e("h5",xe,o(r.result.vehicle_type_name),1)])]),e("div",Be,[e("div",De,[e("h6",Ce,o(a.$t("trip_details")),1)]),e("div",Ie,[e("h5",ze,[e("b",null,o(a.$t("pickup_location")),1)]),e("h6",Te,o(r.result.pick_address),1),r.result.requestStops.data.length>0?(B(),T("div",Pe,[e("h5",Re,[e("b",null,o(a.$t("stop_location")),1)]),e("h5",qe,[e("b",null,o(a.$t("stop_location")),1)]),e("div",Ue,[e("button",Ve,o(a.$t("view_stop_location")),1),e("ul",$e,[(B(!0),T(W,null,Y(r.result.requestStops.data,(d,M)=>(B(),T("li",null,[e("a",je,o(d.address),1)]))),256))])])])):Z("",!0),r.result.is_rental?Z("",!0):(B(),T("div",He,[e("h5",Ne,[e("b",null,o(a.$t("drop_location")),1)]),e("h6",Oe,o(r.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(y,null,{default:l(()=>[n(R,{lg:"12"},{default:l(()=>[n(C,{"no-body":"",id:"tasksList"},{default:l(()=>[n(O,{class:"border-0"}),n(m,{class:"border border-dashed border-end-0 border-start-0"},{default:l(()=>[e("div",Ae,[e("div",Ee,[e("div",Fe,[n(y,null,{default:l(()=>[n(C,{"no-body":""},{default:l(()=>[n(m,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:l(()=>[n(R,{xl:"12"},{default:l(()=>[e("div",Ge,[(B(!0),T(W,null,Y(v.fleetDrivers,d=>(B(),T("div",{key:d.driver_id,onClick:M=>v.assignModal(d),class:"row"},[e("div",Ye,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:d.profile_picture},null,8,Ze)])]),e("div",Je,[e("div",Ke,[t[3]||(t[3]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),t[4]||(t[4]=P("    ")),e("span",null,o(d.name),1)]),e("div",Xe,[t[5]||(t[5]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),t[6]||(t[6]=P("    ")),e("span",null,o(r.app_for=="demo"?"***********":d.mobile),1)]),e("div",Qe,[t[7]||(t[7]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),t[8]||(t[8]=P("    ")),e("span",null,o(d.rating),1)])]),e("div",et,[e("div",null,[e("button",tt,[t[9]||(t[9]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),P(" "+o(a.$t("assign")),1)])])])],8,We))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",st,[e("div",at,[e("div",ot,o(a.$t("map_loading")),1)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[n(V,{modelValue:v.modalShow,"onUpdate:modelValue":t[2]||(t[2]=d=>v.modalShow=d),"hide-footer":"",title:a.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:l(()=>[n(C,null,{default:l(()=>[n(m,null,{default:l(()=>[n(y,null,{default:l(()=>{var d,M,b;return[e("div",it,[e("div",nt,[e("h6",lt,o(a.$t("confirm_assign_driver")),1)]),e("div",rt,[e("div",dt,[e("img",{src:(d=v.modalDriver)==null?void 0:d.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,ct)]),e("h5",_t,o((M=v.modalDriver)==null?void 0:M.name),1),e("p",ut,o(r.app_for=="demo"?"***********":(b=v.modalDriver)==null?void 0:b.mobile),1)]),e("p",mt,o(a.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",ft,[n(A,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:t[0]||(t[0]=d=>v.modalShow=!1)},{default:l(()=>[t[10]||(t[10]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),P(" "+o(a.$t("close")),1)]),_:1,__:[10]}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:t[1]||(t[1]=d=>v.assignDriver(v.modalDriver))},[t[11]||(t[11]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),P(" "+o(a.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const wt=K(_e,[["render",vt]]);export{wt as default};

import{_ as W,Z as Y,O as J,P as K,z as Q,C as Z,r as m,T as G,Q as X,D as ee,a as I,g as d,o as _,x as R,w as c,U as L,N as te,k as r,l as e,J as l,i as h,F as se,L as oe,p as $,y as p,n as E,B as T,q as g,W as y,K as ie}from"./vendor-ddfbd976.js";import{L as le}from"./main-306a5ea6.js";import{P as ae}from"./page-header-2dc95532.js";import{P as ne}from"./Pagination-f095ae3c.js";import{s as re}from"./search-2c17aadd.js";import{s as de}from"./searchbar-3acbc236.js";import{u as ce}from"./footer-e648049d.js";import{_ as _e}from"./search-file-ab3e1046.js";import"./app-042fb454.js";const fe={data(){return{rightOffcanvas:!1}},components:{Layout:le,PageHeader:ae,Head:Y,Pagination:ne,Multiselect:J,flatPickr:K,Link:Q,search:re,searchbar:de},props:{successMessage:String,alertMessage:String,zones:Object,firebaseConfig:Object,ongoing_rides:Object,types:Object},setup(i){const{t:s}=Z(),H=m(""),o=G({transport_type:"all",ride_status:"all",is_bid_ride:null,zone_id:null,service_location_id:null,vehicle_type_id:null,is_paid:null}),C=m(i.zones),F=m(i.types),n=m(i.ongoing_rides),B=m(!1),k=m(!1),x=m(null),U=m(i.successMessage||""),M=m(i.alertMessage||""),{selectedLocation:S}=ce(),V=m([]),P=()=>{U.value="",M.value=""},z=()=>{k.value=!0},D=()=>{o.reset(),k.value=!1};X(S,a=>{o.service_location_id=a,V.value=C.value.filter(v=>v.service_location_id==o.service_location_id),fetchDatas()}),ee(async()=>{try{const a=i.firebaseConfig;firebase.apps.length||firebase.initializeApp(a);const v=firebase.database();n.value.forEach(f=>{v.ref(`requests/${f.id}`).on("value",function(A){const b=n.value.findIndex(u=>u.id===f);if(b!==-1){const u=A.val();u.accept!==1&&(n.value[b].driver_id=null),u.driver_id&&(n.value[b].driver_id=u.driver_id),u.hasOwnProperty("modified_by_driver")&&(n.value[b].is_driver_started=1),u.trip_arrived==1&&(n.value[b].is_driver_arrived=!0),u.trip_start==1&&(n.value[b].is_trip_start=!0),u.is_completed&&(n.value[b].is_completed=!0,setTimeout(()=>{n.value.splice(b,1)},2e3)),(u.is_cancelled||u.is_cancel)&&(n.value[b].is_cancelled=!0,setTimeout(()=>{n.value.splice(b,1)},2e3))}})}),m("requests").on("child_added",function(f){const w=f.val();setTimeout(async()=>{if(w.hasOwnProperty("request_number")&&w.hasOwnProperty("service_location_id")&&w.service_location_id==S){const A=await I.get(`/ongoing-rides/find-ride/${dataId}`);n.prepend(A.data.result)}},2e3)}),o.service_location_id=S,V.value=C.value.filter(f=>f.service_location_id==o.service_location_id),fetchDatas()}catch(a){console.error(s("error_initializing_firebase_or_fetching_settings"),a)}});const q=()=>{B.value=!1},O=async a=>{try{const v=await I.get(`/rides-request/cancel/${a}`),f=n.value.findIndex(w=>w.id===a);f!==-1&&(n.value[f]=v.data.request),B.value=!1,L.fire(s("success"),s("trip_cancelled_successfully"),"success")}catch(v){console.log(v),L.fire(s("error"),s("failed_to_cancel_trip"),"error")}};return{results:n,modalShow:B,deleteItemId:x,successMessage:U,alertMessage:M,filterData:z,deleteModal:async a=>{L.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async v=>{if(v.isConfirmed)try{await O(a)}catch(f){console.error(s("error_deleting_data"),f),L.fire(s("error"),s("failed_to_cancel_the_data"),"error")}})},closeModal:q,deleteData:O,dismissMessage:P,searchTerm:H,modalFilter:k,clearFilter:D,filter:o,zoneList:V,types:F,rideStatus:a=>a.is_cancelled?"Cancelled":a.is_completed?"Completed":a.is_trip_start?"On Trip":a.is_driver_arrived?"Driver Arrived":a.is_later&&a.is_driver_started?"Driver Started":a.is_driver_started?"Accepted":a.is_later?"Upcoming":"Searching",editData:async a=>{te.get(`/rides-request/view/${a.id}`)}}}},ue={class:"table-responsive"},me={class:"table align-middle position-relative table-nowrap"},pe={class:"table-active"},ve={scope:"col"},be={scope:"col"},he={scope:"col"},ge={scope:"col"},ye={scope:"col"},ke={scope:"col"},we={scope:"col"},Ce={scope:"col"},Be={key:0},Me={key:0},Se={key:1},Ve={key:2},xe={class:"dropdown"},Ue={class:"dropdown-menu dropdown-menu-end"},ze=["onClick"],De=["onClick"],Oe={key:1},Le={colspan:"10",class:"text-center"},Te={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},Pe={class:"alert-content"},qe={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},Ae={class:"alert-content"},He={class:"offcanvas-body"},Fe={class:"mb-4"},Ne={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},je={class:"form-check form-check-inline"},Ie={class:"form-check-label",for:"all"},Re={class:"form-check form-check-inline"},$e={class:"form-check-label",for:"completed"},Ee={class:"form-check form-check-inline"},We={class:"form-check-label",for:"cancelled"},Ye={class:"form-check form-check-inline"},Je={class:"form-check-label",for:"upcoming"},Ke={class:"form-check form-check-inline"},Qe={class:"form-check-label",for:"ontrip"},Ze={class:"mb-4"},Ge={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},Xe={value:"all"},et={value:"taxi"},tt={value:"delivery"},st={class:"mb-4"},ot={for:"zone-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},it={class:"mb-4"},lt={for:"vehicle_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},at={class:"mb-4"},nt={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},rt={class:"form-check form-check-inline"},dt={class:"form-check-label",for:"not_paid"},ct={class:"form-check form-check-inline"},_t={class:"form-check-label",for:"paid"},ft={class:"mb-4"},ut={for:"dispatch-type-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},mt={class:"form-check form-check-inline"},pt={class:"form-check-label",for:"normal"},vt={class:"form-check form-check-inline"},bt={class:"form-check-label",for:"bidding"},ht={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function gt(i,s,H,o,C,F){const n=d("Head"),B=d("PageHeader"),k=d("BCol"),x=d("BRow"),U=d("BCardHeader"),M=d("BBadge"),S=d("Link"),V=d("BCardBody"),P=d("BCard"),z=d("Multiselect"),D=d("BButton"),q=d("BFrom"),O=d("BOffcanvas"),N=d("Layout");return _(),R(N,null,{default:c(()=>[r(n,{title:i.$t("ongoing-rides")},null,8,["title"]),r(B,{title:i.$t("ongoing-rides"),pageTitle:i.$t("ongoing-rides")},null,8,["title","pageTitle"]),r(x,null,{default:c(()=>[r(k,{lg:"12"},{default:c(()=>[r(P,{"no-body":"",id:"tasksList"},{default:c(()=>[r(U,{class:"border-0"},{default:c(()=>[r(x,{class:"g-2"},{default:c(()=>[r(k,{md:"3"})]),_:1})]),_:1}),r(V,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[e("div",ue,[e("table",me,[e("thead",pe,[e("tr",null,[e("th",ve,l(i.$t("request_id")),1),e("th",be,l(i.$t("date")),1),e("th",he,l(i.$t("user_name")),1),e("th",ge,l(i.$t("driver_name")),1),e("th",ye,l(i.$t("transport_type")),1),e("th",ke,l(i.$t("trip_status")),1),e("th",we,l(i.$t("payment_option")),1),e("th",Ce,l(i.$t("action")),1)])]),o.results.length>0?(_(),h("tbody",Be,[(_(!0),h(se,null,oe(o.results,(t,j)=>(_(),h("tr",{key:j},[e("td",null,l(t.request_number),1),e("td",null,l(t.converted_updated_at),1),e("td",null,l(t.user_detail?t.user_detail.name:"----"),1),e("td",null,l(t.driver_detail?t.driver_detail.name:"----"),1),e("td",null,[t.transport_type==="taxi"?(_(),h("span",Me,l(i.$t("taxi"))+" "+l(t.is_bid_ride?i.$t("bidding"):"")+" - "+l(t.vehicle_type_name),1)):t.transport_type==="delivery"?(_(),h("span",Se,l(i.$t("delivery"))+" "+l(t.is_bid_ride?i.$t("bidding"):"")+" - "+l(t.vehicle_type_name),1)):(_(),h("span",Ve,l(i.$t("all")),1))]),e("td",null,[r(M,{class:$({"text-uppercase":!0,"text-bg-success":o.rideStatus(t)==="Completed"||o.rideStatus(t)==="Accepted"||o.rideStatus(t)==="Driver Started","text-bg-danger":o.rideStatus(t)==="Cancelled","text-bg-info":o.rideStatus(t)==="On Trip","text-bg-warning":o.rideStatus(t)==="Upcoming"||o.rideStatus(t)==="Driver Arrived"||o.rideStatus(t)==="Searching"})},{default:c(()=>[p(l(o.rideStatus(t)),1)]),_:2},1032,["class"])]),e("td",null,[r(M,{class:$({"text-uppercase":!0,"text-bg-success":t.is_paid,"text-bg-danger":!t.is_paid})},{default:c(()=>[p(l(t.payment_opt==1?"Cash":t.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",xe,[s[18]||(s[18]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",Ue,[e("div",{class:"dropdown-item",type:"button",onClick:E(a=>o.editData(t),["prevent"])},[s[15]||(s[15]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),p(" "+l(i.$t("view")),1)],8,ze),!t.is_cancelled&&!t.is_completed?(_(),h("div",{key:0,class:"dropdown-item",type:"button",onClick:E(a=>o.deleteModal(t.id),["prevent"])},[s[16]||(s[16]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),p(" "+l(i.$t("cancel")),1)],8,De)):T("",!0),!t.driver_id&&!t.is_cancelled&&!t.is_completed?(_(),R(S,{key:1,class:"dropdown-item",type:"button",href:`ongoing-rides/assign/${t.id}`},{default:c(()=>[s[17]||(s[17]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),p(" "+l(i.$t("assign")),1)]),_:2,__:[17]},1032,["href"])):T("",!0)])])])]))),128))])):(_(),h("tbody",Oe,[e("tr",null,[e("td",Le,[s[19]||(s[19]=e("img",{src:_e,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,l(i.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[o.successMessage?(_(),h("div",Te,[e("div",Pe,[s[20]||(s[20]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[21]||(s[21]=p()),s[22]||(s[22]=e("strong",null,"Success",-1)),p(" - "+l(o.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[0]||(s[0]=(...t)=>o.dismissMessage&&o.dismissMessage(...t)),"aria-label":"Close Success Message"})])])):T("",!0),o.alertMessage?(_(),h("div",qe,[e("div",Ae,[s[23]||(s[23]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[24]||(s[24]=p()),s[25]||(s[25]=e("strong",null,"Alert",-1)),p(" - "+l(o.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[1]||(s[1]=(...t)=>o.dismissMessage&&o.dismissMessage(...t)),"aria-label":"Close Alert Message"})])])):T("",!0)]),r(O,{modelValue:C.rightOffcanvas,"onUpdate:modelValue":s[14]||(s[14]=t=>C.rightOffcanvas=t),placement:"end",title:i.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:c(()=>[r(q,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:c(()=>[e("div",He,[e("div",Fe,[e("label",Ne,l(i.$t("status")),1),e("div",null,[e("div",je,[g(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"all",value:"all","onUpdate:modelValue":s[2]||(s[2]=t=>o.filter.ride_status=t)},null,512),[[y,o.filter.ride_status]]),e("label",Ie,l(i.$t("all")),1)]),e("div",Re,[g(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"completed",value:"completed","onUpdate:modelValue":s[3]||(s[3]=t=>o.filter.ride_status=t)},null,512),[[y,o.filter.ride_status]]),e("label",$e,l(i.$t("completed")),1)]),e("div",Ee,[g(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"cancelled",value:"cancelled","onUpdate:modelValue":s[4]||(s[4]=t=>o.filter.ride_status=t)},null,512),[[y,o.filter.ride_status]]),e("label",We,l(i.$t("cancelled")),1)]),e("div",Ye,[g(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"upcoming",value:"upcoming","onUpdate:modelValue":s[5]||(s[5]=t=>o.filter.ride_status=t)},null,512),[[y,o.filter.ride_status]]),e("label",Je,l(i.$t("upcoming")),1)]),e("div",Ke,[g(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"ontrip",value:"ontrip","onUpdate:modelValue":s[6]||(s[6]=t=>o.filter.ride_status=t)},null,512),[[y,o.filter.ride_status]]),e("label",Qe,l(i.$t("on_trip")),1)])])]),e("div",Ze,[e("label",Ge,l(i.$t("transport_type")),1),g(e("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":s[7]||(s[7]=t=>o.filter.transport_type=t)},[e("option",Xe,l(i.$t("all")),1),e("option",et,l(i.$t("taxi")),1),e("option",tt,l(i.$t("delivery")),1)],512),[[ie,o.filter.transport_type]])]),e("div",st,[e("label",ot,l(i.$t("zone")),1),r(z,{modelValue:o.filter.zone_id,"onUpdate:modelValue":s[8]||(s[8]=t=>o.filter.zone_id=t),id:"zone_id",mode:"tags",options:o.zoneList.map(t=>({value:t.id,label:t.name})),"close-on-select":!1,multiple:!0,searchable:!0,placeholder:i.$t("select_a_zone"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",it,[e("label",lt,l(i.$t("vehicle_type")),1),r(z,{id:"vehicle_type_id",mode:"tags",modelValue:o.filter.vehicle_type_id,"onUpdate:modelValue":s[9]||(s[9]=t=>o.filter.vehicle_type_id=t),options:o.types.map(t=>({value:t.id,label:t.name})),"close-on-select":!1,searchable:!0,placeholder:i.$t("select_vehicle_type"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",at,[e("label",nt,l(i.$t("payment_status")),1),e("div",null,[e("div",rt,[g(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"not_paid",value:"1","onUpdate:modelValue":s[10]||(s[10]=t=>o.filter.is_paid=t)},null,512),[[y,o.filter.is_paid]]),e("label",dt,l(i.$t("paid")),1)]),e("div",ct,[g(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"paid",value:"0","onUpdate:modelValue":s[11]||(s[11]=t=>o.filter.is_paid=t)},null,512),[[y,o.filter.is_paid]]),e("label",_t,l(i.$t("not_paid")),1)])])]),e("div",ft,[e("label",ut,l(i.$t("ride_type")),1),e("div",null,[e("div",mt,[g(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"normal",value:"0","onUpdate:modelValue":s[12]||(s[12]=t=>o.filter.is_bid_ride=t)},null,512),[[y,o.filter.is_bid_ride]]),e("label",pt,l(i.$t("regural")),1)]),e("div",vt,[g(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"bidding",value:"1","onUpdate:modelValue":s[13]||(s[13]=t=>o.filter.is_bid_ride=t)},null,512),[[y,o.filter.is_bid_ride]]),e("label",bt,l(i.$t("bidding")),1)])])]),s[26]||(s[26]=e("div",null,null,-1))]),e("div",ht,[r(D,{variant:"light",onClick:o.clearFilter,class:"w-100"},{default:c(()=>[p(l(i.$t("clear_filter")),1)]),_:1},8,["onClick"]),r(D,{type:"submit",onClick:o.filterData,variant:"success",class:"w-100"},{default:c(()=>[p(l(i.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"])]),_:1})}const Ut=W(fe,[["render",gt]]);export{Ut as default};

import{_ as B,o as l,i as o,l as s,B as I,F,L as b,J as u,y as C,Z as V,O as q,C as A,r as m,T as j,D as E,g as v,x as H,w as k,a as N,N as R,k as p,n as X,q as S,K as D,M as P}from"./vendor-ddfbd976.js";import{L as W}from"./main-306a5ea6.js";import{P as z}from"./page-header-2dc95532.js";import{F as J}from"./FormValidation-a9047131.js";import{u as K}from"./footer-e648049d.js";import{_ as Q}from"./UserWebMenu-2e0e812c.js";import{I as Y}from"./ImageUp-1fee9a5c.js";import"./app-042fb454.js";const Z={data(){return{files:[],currentFileIndex:null,isModalOpen:!1,showToast:!1}},methods:{triggerFileInput(){this.$refs.fileInput.click()},handleFileChange(e){const t=e.target.files,a=8-this.files.length;if(t.length>a){this.showToastMessage();return}const _=[];Array.from(t).forEach(i=>{if(this.validateFile(i)){const r=new FileReader;r.onload=f=>{const h={file:i,dataURL:f.target.result,name:i.name,type:i.type};this.files.push(h),_.push(h),_.length===t.length&&this.$emit("files-selected",_)},r.readAsDataURL(i)}else this.showToastMessage()})},validateFile(e){return["image","video","pdf","msword","wordprocessingml"].some(t=>e.type.includes(t))},removeFile(e){this.files.splice(e,1)},openModal(e){this.currentFileIndex=e,this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},prevFile(){this.currentFileIndex>0&&this.currentFileIndex--},nextFile(){this.currentFileIndex<this.files.length-1&&this.currentFileIndex++},showToastMessage(){this.showToast=!0,setTimeout(()=>{this.showToast=!1},3e3)},isImage(e){return e.type.includes("image")},isVideo(e){return e.type.includes("video")},isPDF(e){return e.type.includes("pdf")},isDOCX(e){return e.type.includes("word")}},computed:{currentFile(){return this.files[this.currentFileIndex]||{}}},mounted(){this.$el.querySelector("#file-container"),document.addEventListener("keydown",e=>{this.isModalOpen&&(e.key==="ArrowLeft"?this.prevFile():e.key==="ArrowRight"?this.nextFile():e.key==="Escape"&&this.closeModal())})}},G={id:"file-container"},$=["onClick"],ee=["src"],te=["src"],se=["src"],ie={key:3,class:"file-icon"},le={key:0,class:"fas fa-file-word"},oe={key:1,class:"fas fa-file"},re=["onClick"],ne={key:0,id:"fullscreen-modal"},ae=["src"],de=["src"],ce=["src"],ue=["href"],_e={key:1,id:"toast"};function fe(e,t,g,a,_,i){return l(),o("div",null,[s("div",G,[_.files.length<8?(l(),o("div",{key:0,id:"file-slot",onClick:t[1]||(t[1]=(...r)=>i.triggerFileInput&&i.triggerFileInput(...r))},[t[5]||(t[5]=s("div",{class:"d-flex flex-column align-items-center"},[s("span",null,"Upload File"),s("span",null,"(Max: 8 files)"),s("span",{style:{"font-size":"8px"}},"png,jpg,jpeg,mp4,pdf,doc")],-1)),s("input",{type:"file",ref:"fileInput",onChange:t[0]||(t[0]=(...r)=>i.handleFileChange&&i.handleFileChange(...r)),multiple:"",accept:"image/*, video/mp4, application/pdf, application/msword, application/vnd.openxmlformats-officedocument.wordprocessingml.document",style:{display:"none"}},null,544)])):I("",!0),(l(!0),o(F,null,b(_.files,(r,f)=>(l(),o("div",{key:f,class:"file-wrapper"},[s("div",{class:"file-preview",onClick:h=>i.openModal(f)},[i.isImage(r)?(l(),o("img",{key:0,src:r.dataURL},null,8,ee)):i.isVideo(r)?(l(),o("video",{key:1,src:r.dataURL,controls:""},null,8,te)):i.isPDF(r)?(l(),o("iframe",{key:2,src:r.dataURL,width:"100%",height:"100%"},null,8,se)):(l(),o("div",ie,[i.isDOCX(r)?(l(),o("i",le)):(l(),o("i",oe)),s("span",null,u(r.name),1)]))],8,$),s("div",{class:"file-options",onClick:h=>i.removeFile(f)},"X",8,re)]))),128))]),_.isModalOpen?(l(),o("div",ne,[i.isImage(i.currentFile)?(l(),o("img",{key:0,src:i.currentFile.dataURL,id:"fullscreen-image"},null,8,ae)):i.isVideo(i.currentFile)?(l(),o("video",{key:1,src:i.currentFile.dataURL,controls:"",id:"fullscreen-video"},null,8,de)):i.isPDF(i.currentFile)?(l(),o("iframe",{key:2,src:i.currentFile.dataURL,width:"80%",height:"80%"},null,8,ce)):i.isDOCX(i.currentFile)?(l(),o("a",{key:3,href:i.currentFile.dataURL,target:"_blank",class:"docx-preview"},t[6]||(t[6]=[s("i",{class:"fas fa-file-word"},null,-1),C(" Open DOCX ")]),8,ue)):I("",!0),s("button",{id:"prev-file",onClick:t[2]||(t[2]=(...r)=>i.prevFile&&i.prevFile(...r))},"❮"),s("button",{id:"next-file",onClick:t[3]||(t[3]=(...r)=>i.nextFile&&i.nextFile(...r))},"❯"),s("button",{id:"close-modal",onClick:t[4]||(t[4]=(...r)=>i.closeModal&&i.closeModal(...r))},"X")])):I("",!0),_.showToast?(l(),o("div",_e,"You can only upload up to 8 files.")):I("",!0)])}const me=B(Z,[["render",fe],["__scopeId","data-v-77eb4e9a"]]);const pe={components:{Layout:W,PageHeader:z,Head:V,Multiselect:q,FormValidation:J,UserWebMenu:Q,ImageUp:Y,MultiUpload:me},props:{support_ticket:Object,successMessage:String,alertMessage:String,app_for:String,title:Array,languages:Array,titleType:String,user:Object,service_location:Array,request_id:Array},setup(e){const{t}=A(),{languages:g,fetchData:a}=K(),_=m("English"),i=m({}),r=m(null),f=m(e.title),h=m(e.service_location),L=m(e.request_id),c=j({title_id:e.support_ticket?e.support_ticket.title_id||{}:{},description:e.support_ticket&&e.support_ticket.description||"",service_location_id:e.support_ticket&&e.support_ticket.service_location_id||"",files:[]}),x=m(e.successMessage||""),w=m(e.alertMessage||""),U={title_id:{required:!0},description:{required:!0},service_location_id:{required:!0}},n=m(""),y=async()=>{try{let d;console.log("data",c.data());const M=new FormData;M.append("title_id",c.title_id),M.append("description",c.description),M.append("service_location_id",c.service_location_id),c.files.map(T=>T.file||T).forEach((T,Ke)=>{M.append("files[]",T)}),d=await N.post("/ticket/store",M,{headers:{"Content-Type":"multipart/form-data"}}),d.status===201?(x.value=t("ticket_created_successfully"),c.reset(),R.get("/get-support")):w.value=t("failed_to_create_ticket")}catch(d){d.response&&d.response.status===422?i.value=d.response.data.errors:(console.error(t("error_creating_ticket"),d),w.value=t("failed_to_create_ticket_catch"))}},O=d=>{_.value=d};return E(async()=>{Object.keys(g).length==0&&await a()}),{form:c,successMessage:x,alertMessage:w,errors:i,handleSubmit:y,validationRef:r,validationRules:U,searchQuery:n,setActiveTab:O,activeTab:_,languages:g,title:f,filterTitle:()=>{e.titleType==="request"&&(f.value=e.title.filter(d=>d.title_type==="request")),e.titleType==="general"&&(f.value=e.title.filter(d=>d.title_type==="general"))},handleFileUpload:d=>{c.files=[...d.target.files]},handleFilesSelected:d=>{console.log("Selected files:",d),c.files=[...c.files,...d],console.log("files",c.files)},removeFile:d=>{c.files.splice(d,1)},serviceLocation:h,ticketRedirect:()=>{e.titleType==="request"&&R.get(`/history/view/${L.value}`),e.titleType==="general"&&R.get("/get-support")}}},mounted(){this.filterTitle()}},he={class:"d-flex align-items-center justify-content-between"},ve={class:"text-uppercase"},ge={class:"row"},ye={class:"col-sm-8"},ke={class:"row"},Fe={class:"col-sm-12"},be={class:"mb-3"},we={for:"title",class:"form-label"},Me={value:"",disabled:""},Ce=["value"],xe={class:"col-12"},Ue={class:"mb-3"},Te={for:"service_location_id",class:"form-label"},Ie={disabled:"",value:""},Le=["value"],Re={class:"col-sm-12"},Se={class:"mb-3"},De={for:"description",class:"form-label"},Be=["placeholder"],Oe={class:"col-sm-12"},Ve={class:"mb-3"},qe={for:"attachament",class:"form-label"},Ae={class:"col-lg-12"},je={class:"text-end"},Ee={type:"submit",class:"btn btn-primary"};function He(e,t,g,a,_,i){const r=v("Head"),f=v("UserWebMenu"),h=v("BCardHeader"),L=v("BLink"),c=v("BCardBody"),x=v("MultiUpload"),w=v("FormValidation"),U=v("BCard");return l(),H(U,null,{default:k(()=>[p(r,{title:"Taxi Ride"}),p(h,{class:"border-0"},{default:k(()=>[p(f,{user:g.user},null,8,["user"])]),_:1}),p(c,null,{default:k(()=>[s("div",he,[s("h3",ve,u(e.$t("create_ticket")),1),p(L,{onClick:t[0]||(t[0]=n=>a.ticketRedirect(e.id)),class:"btn btn-primary float-end"},{default:k(()=>[C(u(e.$t("back")),1)]),_:1})])]),_:1}),s("div",ge,[s("div",ye,[p(U,{"no-body":"",id:"tasksList",class:"border"},{default:k(()=>[p(c,{class:"border border-dashed border-end-0 border-start-0"},{default:k(()=>[s("form",{onSubmit:t[4]||(t[4]=X((...n)=>a.handleSubmit&&a.handleSubmit(...n),["prevent"]))},[p(w,{form:a.form,rules:a.validationRules,ref:"validationRef"},{default:k(()=>[s("div",ke,[s("div",Fe,[s("div",be,[s("label",we,[C(u(e.$t("title"))+" ",1),t[5]||(t[5]=s("span",{class:"text-danger"},"*",-1))]),S(s("select",{id:"title_id",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=n=>a.form.title_id=n)},[s("option",Me,u(e.$t("select_title")),1),(l(!0),o(F,null,b(a.title,n=>(l(),o("option",{key:n.title,value:n.id},u(n.title),9,Ce))),128))],512),[[D,a.form.title_id]]),(l(!0),o(F,null,b(a.errors.title_id,(n,y)=>(l(),o("span",{key:y,class:"text-danger"},u(n),1))),128))])]),s("div",xe,[s("div",Ue,[s("label",Te,[C(u(e.$t("select_area"))+" ",1),t[6]||(t[6]=s("span",{class:"text-danger"},"*",-1))]),S(s("select",{id:"service_location_id",class:"form-select","onUpdate:modelValue":t[2]||(t[2]=n=>a.form.service_location_id=n)},[s("option",Ie,u(e.$t("select")),1),(l(!0),o(F,null,b(a.serviceLocation,n=>(l(),o("option",{key:n.id,value:n.id},u(n.name),9,Le))),128))],512),[[D,a.form.service_location_id]]),(l(!0),o(F,null,b(a.errors.service_location_id,(n,y)=>(l(),o("span",{key:y,class:"text-danger"},u(n),1))),128))])]),s("div",Re,[s("div",Se,[s("label",De,[C(u(e.$t("description"))+" ",1),t[7]||(t[7]=s("span",{class:"text-danger"},"*",-1))]),S(s("textarea",{class:"form-control",id:"description",rows:"3",placeholder:e.$t("enter_description"),"onUpdate:modelValue":t[3]||(t[3]=n=>a.form.description=n)},null,8,Be),[[P,a.form.description]]),(l(!0),o(F,null,b(a.errors.description,(n,y)=>(l(),o("span",{key:y,class:"text-danger"},u(n),1))),128))])]),s("div",Oe,[s("div",Ve,[s("label",qe,u(e.$t("attachament")),1),p(x,{onFilesSelected:a.handleFilesSelected},null,8,["onFilesSelected"])])]),s("div",Ae,[s("div",je,[s("button",Ee,u(g.support_ticket?e.$t("update"):e.$t("save")),1)])])])]),_:1},8,["form","rules"])],32)]),_:1})]),_:1})])])]),_:1})}const it=B(pe,[["render",He]]);export{it as default};

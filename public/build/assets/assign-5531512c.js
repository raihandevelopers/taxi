import{_ as te,Z as se,z as ae,Y as oe,P as ie,R as le,U as L,C as ne,r as D,D as de,g as w,o as j,x as re,w as r,a as ce,Q as _e,a0 as ue,k as d,l as e,J as l,i as T,F as W,L as Y,B as Z,q as me,M as ge,y as V,N as ve}from"./vendor-ddfbd976.js";import{L as fe}from"./dispatchmain-37fc6bfb.js";import{P as he}from"./page-header-2dc95532.js";import{F as pe}from"./FormValidation-a9047131.js";import"./footer-e648049d.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const be={data(){return{rightOffcanvas:!1}},components:{Layout:fe,PageHeader:he,Head:se,Link:ae,Scrollbar:oe,FormValidation:pe,flatPickr:ie},computed:{...le(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object},methods:{timer(){let a;L.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,onBeforeOpen:()=>{L.showLoading(),a=setInterval(()=>{L.getContent().querySelector("b").textContent=L.getTimerLeft()},100)},onClose:()=>{clearInterval(a)}}).then(s=>{s.dismiss===L.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(a){const{t:s}=ne(),u=D(!1),g=D(a.driver_radius??10),$=D(a.successMessage||""),U=D(a.alertMessage||""),I=D(""),E=()=>{$.value="",U.value=""},k=D([]),C=D(null),m=D(a.result),z=f=>{C.value=f,u.value=!0},O=async f=>{try{const v=await ce.post(`/dispatcher/ongoing_request/assign-driver/${m.value.id}`,{driver_id:f.id});v.data.status?(u.value=!1,L.fire(s("success"),s("users_assigned_successfully"),"success")):(L.fire(s("Warning"),v.data.message,"warning"),console.log(v))}catch(v){L.fire(s("Warning"),response.data.message,"warning"),console.error(v)}},A=()=>{const f=new google.maps.Map(document.getElementById("map"),{center:{lat:m.value.pick_lat,lng:m.value.pick_lng},zoom:15}),v="/image/map/pickup.png";new google.maps.Marker({position:{lat:m.value.pick_lat,lng:m.value.pick_lng},map:f,icon:{url:v,scaledSize:new google.maps.Size(30,30)}});let t={};f.setZoom(15);const P=()=>{const i=firebase.database().ref("drivers");firebase.database().ref("requests").child(m.value.id).on("value",c=>{const n=c.val();n&&(n.is_accept||n.hasOwnProperty("driver_id"))&&ve.get(`/dispatcher/rides_request/view/${m.value.id}`)}),i.on("value",c=>{k.value=[],c.forEach(n=>{const o=n.val(),y=Date.now()-15*60*1e3;if(o.updated_at<y)return;const b=o.g,h=G(b);let S=!0;if(I.value.length>0&&o.name&&(S=o.name.includes(I.value)||o.mobile.includes(I.value)),h&&S){const x=K(m.value.pick_lat,m.value.pick_lng,h.lat,h.lon);if(x<=g.value&&o.is_available&&o.is_active&&o.vehicle_types.includes(m.value.vehicle_type_id)){const q=new google.maps.LatLng(h.lat,h.lon),B=`/image/map/${o.vehicle_type_icon}.png`;if(o.distance=x,k.value.push(o),t[o.id])N(t[o.id],t[o.id].getPosition(),q,o.bearing),t[o.id].setIcon({url:B,scaledSize:new google.maps.Size(30,30)});else{const _=new google.maps.Marker({position:q,map:f,icon:{url:B,scaledSize:new google.maps.Size(30,30)}});_.addListener("click",()=>{z(o)}),t[o.id]=_,N(_,_.getPosition(),q,o.bearing)}}else t[o.id]&&(t[o.id].setMap(null),delete t[o.id])}})}),i.on("child_changed",c=>{const n=c.val();n.is_active?J(n):F(n.id)}),i.on("child_removed",c=>{const n=c.val();F(n.id)})};_e(I.value,ue(function(i){P()},300));const N=(i,M,c,n)=>{const y=33.333333333333336;let b=M.lat(),h=M.lng(),S=c.lat(),x=c.lng();const q=_=>_<.5?2*_*_:-1+(4-2*_)*_,B=_=>{let H=q(_/60),R=new google.maps.LatLng(b+(S-b)*H,h+(x-h)*H);if(i.setPosition(R),n!==void 0){const Q=i.prevBearing||n,X=n-Q,ee=Q+X*H;i.setIcon({...i.getIcon(),rotation:ee}),i.prevBearing=n}_<60&&setTimeout(()=>B(_+1),y)};B(0)},J=i=>{const M=i.g,c=G(M);if(c){const n=new google.maps.LatLng(c.lat,c.lon),o=`/image/map/${i.vehicle_type_icon}.png`;if(t[i.id])t[i.id].setIcon({url:o,scaledSize:new google.maps.Size(30,30)});else{const p=new google.maps.Marker({position:n,map:f,icon:{url:o,scaledSize:new google.maps.Size(30,30)}});p.addListener("click",()=>{z(i)}),t[i.id]=p}}else console.error(`Failed to decode geohash for driver ID: ${i.id}`)},F=i=>{t[i]&&(t[i].setMap(null),delete t[i])},G=i=>{const M="0123456789bcdefghjkmnpqrstuvwxyz",c=[16,8,4,2,1];let n=!0,o=-90,p=90,y=-180,b=180,h,S;if(i){for(let x=0;x<i.length;x++){let q=i.charAt(x),B=M.indexOf(q);for(let _=0;_<5;_++){let H=c[_];if(n){let R=(y+b)/2;B&H?y=R:b=R}else{let R=(o+p)/2;B&H?o=R:p=R}n=!n}}return h=(o+p)/2,S=(y+b)/2,{lat:h,lon:S}}},K=(i,M,c,n)=>{const p=(c-i)*Math.PI/180,y=(n-M)*Math.PI/180,b=Math.sin(p/2)*Math.sin(p/2)+Math.cos(i*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);return 6371*(2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)))};P()};return de(async()=>{try{const v=a.map_key,t=document.createElement("script");t.src=`https://maps.googleapis.com/maps/api/js?key=${v}&libraries=places`,t.async=!0,t.defer=!0,t.onload=A,document.head.appendChild(t);var f={apiKey:a.firebaseSettings.firebase_api_key,authDomain:a.firebaseSettings.firebase_auth_domain,databaseURL:a.firebaseSettings.firebase_database_url,projectId:a.firebaseSettings.firebase_project_id,storageBucket:a.firebaseSettings.firebase_storage_bucket,messagingSenderId:a.firebaseSettings.firebase_messaging_sender_id,appId:a.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(f)}catch(v){console.error(s("error_initializing_firebase_or_fetching_settings"),v)}}),{modalShow:u,successMessage:$,driverSearch:I,alertMessage:U,modalDriver:C,assignDriver:O,assignModal:z,fleetDrivers:k,dismissMessage:E,errors:{}}}},ye={class:"col-lg-3"},we={class:"card-header"},ke={class:"card-title mb-0"},Me={class:"card-body p-4 text-center"},Se={class:"mx-auto avatar-md mb-3"},xe=["src"],Be={class:"card-title mb-1"},Le={class:"text-muted mb-0"},De={class:"col-lg-3"},Ie={class:"card-header"},Ce={class:"card-title mb-0"},ze={class:"card-body p-4 text-center"},Pe={class:"mx-auto avatar-md mb-3"},qe=["src"],Re={class:"card-title mb-1"},je={class:"col-lg-6"},He={class:"card-header"},Te={class:"card-title mb-0"},Ve={class:"card-body p-4"},Ne={class:"mb-2"},$e={class:"mb-2"},Ue={key:0},Ee={class:"mb-2"},Oe={class:"mb-2"},Ae={class:"btn-group mb-2"},Fe={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},Ge={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},Qe={class:"dropdown-item overflow-auto"},We={key:1},Ye={class:"mb-2"},Ze={class:"mb-2"},Je={class:"position-relative col-lg-4"},Ke={class:"row"},Xe={class:"col-12 col-lg-5",style:{"overflow-x":"auto"}},et={class:"row"},tt={class:"row"},st=["onClick"],at={class:"col-sm-2 border-end d-flex align-items-center justify-content-center"},ot=["src"],it={class:"col-sm-4 mt-3 border-end"},lt={class:"d-flex align-items-center"},nt={class:"d-flex align-items-center"},dt={class:"d-flex align-items-center"},rt={class:"col-sm-6 d-flex align-items-center"},ct={class:"row"},_t={class:"col-lg-12"},ut={type:"button",class:"btn btn-info btn-label waves-effect waves-light"},mt={class:"col-lg-12"},gt={class:"d-flex list-inline mb-0 mt-3"},vt={class:"list-inline-item avatar-xs"},ft=["title"],ht={class:"mt-2",style:{width:"max-content"}},pt={class:"list-inline-item avatar-xs ms-5"},bt=["title"],yt={class:"mt-2",style:{width:"max-content"}},wt={class:"list-inline-item avatar-xs ms-5"},kt=["title"],Mt={class:"mt-2",style:{width:"max-content"}},St={class:"col-12 col-lg-7"},xt={class:"mb-3 text-center m-auto"},Bt={id:"map",style:{height:"500px"}},Lt={class:"col-lg-12"},Dt={class:"card-header"},It={class:"card-title mb-0"},Ct={class:"card-body p-4 text-center"},zt={class:"mx-auto avatar-md mb-3"},Pt=["src"],qt={class:"card-title mb-1"},Rt={class:"text-muted mb-0"},jt={class:"text-muted mb-0"},Ht={class:"modal-footer v-modal-footer"};function Tt(a,s,u,g,$,U){const I=w("Head"),E=w("PageHeader"),k=w("BRow"),C=w("BCardBody"),m=w("BCard"),z=w("BCol"),O=w("BCardHeader"),A=w("BLink"),f=w("BModal"),v=w("Layout");return j(),re(v,null,{default:r(()=>[d(I,{title:"Taxi Ride"}),d(E,{title:a.$t("book"),pageTitle:a.$t("taxi_ride"),pageLink:"/dispatcher/ongoing_request"},null,8,["title","pageTitle"]),d(k,null,{default:r(()=>[d(z,null,{default:r(()=>[d(m,null,{default:r(()=>[d(C,null,{default:r(()=>[d(k,null,{default:r(()=>[e("div",ye,[e("div",we,[e("h6",ke,l(a.$t("user_details")),1)]),e("div",Me,[e("div",Se,[e("img",{src:u.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,xe)]),e("h5",Be,l(u.result.userDetail.data.name),1),e("p",Le,l(u.app_for=="demo"?"***********":u.result.userDetail.data.mobile),1)])]),e("div",De,[e("div",Ie,[e("h6",Ce,l(a.$t("vehicle_details")),1)]),e("div",ze,[e("div",Pe,[e("img",{src:u.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,qe)]),e("h5",Re,l(u.result.vehicle_type_name),1)])]),e("div",je,[e("div",He,[e("h6",Te,l(a.$t("trip_details")),1)]),e("div",Ve,[e("h5",Ne,[e("b",null,l(a.$t("pickup_location")),1)]),e("h6",$e,l(u.result.pick_address),1),u.result.requestStops.data.length>0?(j(),T("div",Ue,[e("h5",Ee,[e("b",null,l(a.$t("stop_location")),1)]),e("h5",Oe,[e("b",null,l(a.$t("stop_location")),1)]),e("div",Ae,[e("button",Fe,l(a.$t("view_stop_location")),1),e("ul",Ge,[(j(!0),T(W,null,Y(u.result.requestStops.data,(t,P)=>(j(),T("li",null,[e("a",Qe,l(t.address),1)]))),256))])])])):Z("",!0),u.result.is_rental?Z("",!0):(j(),T("div",We,[e("h5",Ye,[e("b",null,l(a.$t("drop_location")),1)]),e("h6",Ze,l(u.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),d(k,null,{default:r(()=>[d(z,{lg:"12"},{default:r(()=>[d(m,{"no-body":"",id:"tasksList"},{default:r(()=>[d(O,{class:"border-0"},{default:r(()=>[e("div",Je,[me(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=t=>g.driverSearch=t),placeholder:"Search...",autocomplete:"off",id:"search-options",value:""},null,512),[[ge,g.driverSearch]])])]),_:1}),d(C,{class:"border border-dashed border-end-0 border-start-0"},{default:r(()=>[e("div",Ke,[e("div",Xe,[e("div",et,[d(k,null,{default:r(()=>[d(m,{"no-body":""},{default:r(()=>[d(C,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:r(()=>[d(z,{xl:"12"},{default:r(()=>[e("div",tt,[(j(!0),T(W,null,Y(g.fleetDrivers,t=>(j(),T("div",{key:t.driver_id,onClick:P=>g.assignModal(t),class:"row"},[e("div",at,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:t.profile_picture},null,8,ot)])]),e("div",it,[e("div",lt,[s[4]||(s[4]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),s[5]||(s[5]=V("    ")),e("span",null,l(t.name),1)]),e("div",nt,[s[6]||(s[6]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),s[7]||(s[7]=V("    ")),e("span",null,l(u.app_for=="demo"?"***********":t.mobile),1)]),e("div",dt,[s[8]||(s[8]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),s[9]||(s[9]=V("    ")),e("span",null,l(t.rating),1)])]),e("div",rt,[e("div",ct,[e("div",_t,[e("div",null,[e("button",ut,[s[10]||(s[10]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),V(" "+l(a.$t("assign")),1)])])]),e("div",mt,[e("ul",gt,[e("li",vt,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-success-subtle text-success fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:a.$t("today_rides_distance")},s[11]||(s[11]=[e("i",{class:"ri-pin-distance-line"},null,-1)]),8,ft),e("h6",ht,l(t.total_kms?t.total_kms:"-"),1)]),e("li",pt,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-danger-subtle text-danger fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:a.$t("today_rides_taken")},s[12]||(s[12]=[e("i",{class:"ri-police-car-fill"},null,-1)]),8,bt),e("h6",yt,l(t.total_rides_taken),1)]),e("li",wt,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-warning-subtle text-warning fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:a.$t("today_active")},s[13]||(s[13]=[e("i",{class:"ri-map-pin-time-line"},null,-1)]),8,kt),e("h6",Mt,l(t.total_active_hrs?t.total_active_hrs:"-"),1)])])])])])],8,st))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",St,[e("div",xt,[e("div",Bt,l(a.$t("map_loading")),1)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[d(f,{modelValue:g.modalShow,"onUpdate:modelValue":s[3]||(s[3]=t=>g.modalShow=t),"hide-footer":"",title:a.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:r(()=>[d(m,null,{default:r(()=>[d(C,null,{default:r(()=>[d(k,null,{default:r(()=>{var t,P,N;return[e("div",Lt,[e("div",Dt,[e("h6",It,l(a.$t("confirm_assign_driver")),1)]),e("div",Ct,[e("div",zt,[e("img",{src:(t=g.modalDriver)==null?void 0:t.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,Pt)]),e("h5",qt,l((P=g.modalDriver)==null?void 0:P.name),1),e("p",Rt,l(u.app_for=="demo"?"***********":(N=g.modalDriver)==null?void 0:N.mobile),1)]),e("p",jt,l(a.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",Ht,[d(A,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:s[1]||(s[1]=t=>g.modalShow=!1)},{default:r(()=>[s[14]||(s[14]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),V(" "+l(a.$t("close")),1)]),_:1,__:[14]}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:s[2]||(s[2]=t=>g.assignDriver(g.modalDriver))},[s[15]||(s[15]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),V(" "+l(a.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const Ft=te(be,[["render",Tt]]);export{Ft as default};

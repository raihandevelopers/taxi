import{_ as W,Z as Y,O as G,P as J,z as K,C as Q,r as f,T as Z,Q as X,D as ee,a as R,R as te,g as c,o as d,x as I,w as _,U as T,N as se,k as r,l as e,J as l,i as u,F as ie,L as oe,p as $,y as p,n as E,B as k,q as h,W as y,K as le}from"./vendor-ddfbd976.js";import{L as ae}from"./dispatchmain-37fc6bfb.js";import{P as ne}from"./page-header-2dc95532.js";import{P as re}from"./Pagination-f095ae3c.js";import{s as de}from"./search-2c17aadd.js";import{s as ce}from"./searchbar-3acbc236.js";import{u as _e}from"./footer-e648049d.js";import{_ as ue}from"./search-file-ab3e1046.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const me={data(){return{rightOffcanvas:!1}},components:{Layout:ae,PageHeader:ne,Head:Y,Pagination:re,Multiselect:G,flatPickr:J,Link:K,search:de,searchbar:ce},props:{successMessage:String,alertMessage:String,zones:Object,firebaseConfig:Object,ongoing_rides:Object,types:Object,serviceLocations:{type:Object,required:!0}},setup(o){const{t:s}=Q(),H=f(""),i=Z({transport_type:"all",ride_status:"all",is_bid_ride:null,zone_id:null,service_location_id:null,vehicle_type_id:null,is_paid:null}),w=f(o.zones),F=f(o.types),n=f(o.ongoing_rides),M=f(!1),C=f(!1),U=f(null),z=f(o.successMessage||""),S=f(o.alertMessage||""),{selectedLocation:L}=_e(),V=f([]),P=()=>{z.value="",S.value=""},O=()=>{C.value=!0},q=()=>{i.reset(),C.value=!1};X(L,a=>{i.service_location_id=a,V.value=w.value.filter(v=>v.service_location_id==i.service_location_id),fetchDatas()}),ee(async()=>{try{const a=o.firebaseConfig;firebase.apps.length||firebase.initializeApp(a);const v=firebase.database();n.value.forEach(g=>{v.ref(`requests/${g.id}`).on("value",function(B){const b=n.value.findIndex(m=>m.id===g);if(b!==-1){const m=B.val();m.accept!==1&&(n.value[b].driver_id=null),m.driver_id&&(n.value[b].driver_id=m.driver_id),m.hasOwnProperty("modified_by_driver")&&(n.value[b].is_driver_started=1),m.trip_arrived==1&&(n.value[b].is_driver_arrived=!0),m.trip_start==1&&(n.value[b].is_trip_start=!0),m.is_completed&&(n.value[b].is_completed=!0,setTimeout(()=>{n.value.splice(b,1)},2e3)),(m.is_cancelled||m.is_cancel)&&(n.value[b].is_cancelled=!0,setTimeout(()=>{n.value.splice(b,1)},2e3))}})}),f("requests").on("child_added",function(g){const x=g.val();setTimeout(async()=>{if(x.hasOwnProperty("request_number")){const B=await R.get(`/dispatcher/ongoing_rides/find-ride/${dataId}`);console.log(B.data),n.prepend(B.data.result)}},2e3),i.service_location_id=L,V.value=w.value.filter(B=>B.service_location_id==i.service_location_id)})}catch(a){console.error(s("error_initializing_firebase_or_fetching_settings"),a)}});const A=()=>{M.value=!1},D=async a=>{try{const v=await R.get(`/dispatcher/rides_request/cancel/${a}`),g=n.value.findIndex(x=>x.id===a);g!==-1&&(n.value[g]=v.data.request),M.value=!1,T.fire(s("success"),s("trip_cancelled_successfully"),"success")}catch(v){console.log(v),T.fire(s("error"),s("failed_to_cancel_trip"),"error")}};return{results:n,modalShow:M,deleteItemId:U,successMessage:z,alertMessage:S,filterData:O,deleteModal:async a=>{T.fire({title:"Are you sure?",text:"You want to be cancel this ride!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:"Yes, Cancel!",cancelButtonText:"Close"}).then(async v=>{if(v.isConfirmed)try{await D(a)}catch(g){console.error(s("error_deleting_data"),g),T.fire(s("error"),s("failed_to_cancel_the_data"),"error")}})},closeModal:A,deleteData:D,dismissMessage:P,searchTerm:H,modalFilter:C,clearFilter:q,filter:i,zones:w,types:F,rideStatus:a=>a.is_cancelled?"Cancelled":a.is_completed?"Completed":a.is_trip_start?"On Trip":a.is_driver_arrived?"Driver Arrived":a.is_later&&a.is_driver_started?"Driver Started":a.is_driver_started?"Accepted":a.is_later?"Upcoming":"Searching",editData:async a=>{se.get(`/dispatcher/rides_request/view/${a.id}`)},zoneList:V}},computed:{...te(["permissions"])}},fe={class:"table-responsive"},pe={class:"table align-middle position-relative table-nowrap"},ve={class:"table-active"},be={scope:"col"},he={scope:"col"},ge={scope:"col"},ye={scope:"col"},ke={scope:"col"},we={scope:"col"},Ce={scope:"col"},Be={scope:"col"},Me={key:0},Se={key:0},Ve={key:1},Ue={key:2},ze={class:"dropdown"},Le={class:"dropdown-menu dropdown-menu-end"},Oe=["onClick"],qe={key:1},De=["onClick"],xe={key:2},Te={key:1},Pe={colspan:"10",class:"text-center"},Ae={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},He={class:"alert-content"},Fe={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},je={class:"alert-content"},Ne={class:"offcanvas-body"},Re={class:"mb-4"},Ie={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},$e={class:"form-check form-check-inline"},Ee={class:"form-check-label",for:"all"},We={class:"form-check form-check-inline"},Ye={class:"form-check-label",for:"completed"},Ge={class:"form-check form-check-inline"},Je={class:"form-check-label",for:"cancelled"},Ke={class:"form-check form-check-inline"},Qe={class:"form-check-label",for:"upcoming"},Ze={class:"form-check form-check-inline"},Xe={class:"form-check-label",for:"ontrip"},et={class:"mb-4"},tt={for:"datepicker-range",class:"form-label text-muted text-uppercase fw-semibold mb-3"},st={value:"all"},it={value:"taxi"},ot={value:"delivery"},lt={class:"mb-4"},at={for:"zone-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},nt={class:"mb-4"},rt={for:"vehicle_type",class:"form-label text-muted text-uppercase fw-semibold mb-3"},dt={class:"mb-4"},ct={for:"payment-status-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},_t={class:"form-check form-check-inline"},ut={class:"form-check-label",for:"not_paid"},mt={class:"form-check form-check-inline"},ft={class:"form-check-label",for:"paid"},pt={class:"mb-4"},vt={for:"dispatch-type-select",class:"form-label text-muted text-uppercase fw-semibold mb-3"},bt={class:"form-check form-check-inline"},ht={class:"form-check-label",for:"normal"},gt={class:"form-check form-check-inline"},yt={class:"form-check-label",for:"bidding"},kt={class:"offcanvas-footer border-top p-3 text-center hstack gap-2"};function wt(o,s,H,i,w,F){const n=c("Head"),M=c("PageHeader"),C=c("BCol"),U=c("BRow"),z=c("BCardHeader"),S=c("BBadge"),L=c("Link"),V=c("BCardBody"),P=c("BCard"),O=c("Multiselect"),q=c("BButton"),A=c("BFrom"),D=c("BOffcanvas"),j=c("Layout");return d(),I(j,null,{default:_(()=>[r(n,{title:o.$t("ongoing-rides")},null,8,["title"]),r(M,{title:o.$t("ongoing-rides"),pageTitle:o.$t("ongoing-rides")},null,8,["title","pageTitle"]),r(U,null,{default:_(()=>[r(C,{lg:"12"},{default:_(()=>[r(P,{"no-body":"",id:"tasksList"},{default:_(()=>[r(z,{class:"border-0"},{default:_(()=>[r(U,{class:"g-2"},{default:_(()=>[r(C,{md:"3"})]),_:1})]),_:1}),r(V,{class:"border border-dashed border-end-0 border-start-0"},{default:_(()=>[e("div",fe,[e("table",pe,[e("thead",ve,[e("tr",null,[e("th",be,l(o.$t("request_id")),1),e("th",he,l(o.$t("date")),1),e("th",ge,l(o.$t("user_name")),1),e("th",ye,l(o.$t("driver_name")),1),e("th",ke,l(o.$t("transport_type")),1),e("th",we,l(o.$t("trip_status")),1),e("th",Ce,l(o.$t("payment_option")),1),e("th",Be,l(o.$t("action")),1)])]),i.results.length>0?(d(),u("tbody",Me,[(d(!0),u(ie,null,oe(i.results,(t,N)=>(d(),u("tr",{key:N},[e("td",null,l(t.request_number),1),e("td",null,l(t.converted_created_at),1),e("td",null,l(t.user_detail?t.user_detail.name:"----"),1),e("td",null,l(t.driver_detail?t.driver_detail.name:"----"),1),e("td",null,[t.transport_type==="taxi"?(d(),u("span",Se,l(o.$t("taxi"))+" "+l(t.is_bid_ride?o.$t("bidding"):""),1)):t.transport_type==="delivery"?(d(),u("span",Ve,l(o.$t("delivery"))+" "+l(t.is_bid_ride?o.$t("bidding"):""),1)):(d(),u("span",Ue,l(o.$t("all")),1))]),e("td",null,[r(S,{class:$({"text-uppercase":!0,"text-bg-success":i.rideStatus(t)==="Completed"||i.rideStatus(t)==="Accepted"||i.rideStatus(t)==="Driver Started","text-bg-danger":i.rideStatus(t)==="Cancelled","text-bg-info":i.rideStatus(t)==="On Trip","text-bg-warning":i.rideStatus(t)==="Upcoming"||i.rideStatus(t)==="Driver Arrived"||i.rideStatus(t)==="Searching"})},{default:_(()=>[p(l(i.rideStatus(t)),1)]),_:2},1032,["class"])]),e("td",null,[r(S,{class:$({"text-uppercase":!0,"text-bg-success":t.is_paid,"text-bg-danger":!t.is_paid})},{default:_(()=>[p(l(t.payment_opt==1?"Cash":t.payment_opt==2?"Wallet":"Card"),1)]),_:2},1032,["class"])]),e("td",null,[e("div",ze,[s[18]||(s[18]=e("a",{class:"text-reset",href:"#","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},[e("span",{class:"text-muted fs-18"},[e("i",{class:"mdi mdi-dots-vertical"})])],-1)),e("div",Le,[o.permissions.includes("dispatcher-ongoing-request-view")?(d(),u("div",{key:0,class:"dropdown-item",type:"button",onClick:E(a=>i.editData(t),["prevent"])},[s[15]||(s[15]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),p(" "+l(o.$t("view")),1)],8,Oe)):k("",!0),o.permissions.includes("dispatcher-ongoing-request-cancel")?(d(),u("div",qe,[!t.is_cancelled&&!t.is_completed?(d(),u("div",{key:0,class:"dropdown-item",type:"button",onClick:E(a=>i.deleteModal(t.id),["prevent"])},[s[16]||(s[16]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),p(" "+l(o.$t("cancel")),1)],8,De)):k("",!0)])):k("",!0),o.permissions.includes("dispatcher-ongoing-request-assign")?(d(),u("div",xe,[!t.driver_id&&!t.is_cancelled&&!t.is_completed?(d(),I(L,{key:0,class:"dropdown-item",type:"button",href:`ongoing_request/assign/${t.id}`},{default:_(()=>[s[17]||(s[17]=e("i",{class:"bx bx-show-alt align-center text-muted me-2"},null,-1)),p(" "+l(o.$t("assign")),1)]),_:2,__:[17]},1032,["href"])):k("",!0)])):k("",!0)])])])]))),128))])):(d(),u("tbody",Te,[e("tr",null,[e("td",Pe,[s[19]||(s[19]=e("img",{src:ue,alt:"Loading...",style:{width:"100px"}},null,-1)),e("h5",null,l(o.$t("no_data_found")),1)])])]))])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[i.successMessage?(d(),u("div",Ae,[e("div",He,[s[20]||(s[20]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[21]||(s[21]=p()),s[22]||(s[22]=e("strong",null,"Success",-1)),p(" - "+l(i.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[0]||(s[0]=(...t)=>i.dismissMessage&&i.dismissMessage(...t)),"aria-label":"Close Success Message"})])])):k("",!0),i.alertMessage?(d(),u("div",Fe,[e("div",je,[s[23]||(s[23]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[24]||(s[24]=p()),s[25]||(s[25]=e("strong",null,"Alert",-1)),p(" - "+l(i.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[1]||(s[1]=(...t)=>i.dismissMessage&&i.dismissMessage(...t)),"aria-label":"Close Alert Message"})])])):k("",!0)]),r(D,{modelValue:w.rightOffcanvas,"onUpdate:modelValue":s[14]||(s[14]=t=>w.rightOffcanvas=t),placement:"end",title:o.$t("filters"),"header-class":"bg-light","body-class":"p-0 overflow-hidden","footer-class":"border-top p-3 text-center"},{default:_(()=>[r(A,{action:"",class:"d-flex flex-column justify-content-end h-100"},{default:_(()=>[e("div",Ne,[e("div",Re,[e("label",Ie,l(o.$t("status")),1),e("div",null,[e("div",$e,[h(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"all",value:"all","onUpdate:modelValue":s[2]||(s[2]=t=>i.filter.ride_status=t)},null,512),[[y,i.filter.ride_status]]),e("label",Ee,l(o.$t("all")),1)]),e("div",We,[h(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"completed",value:"completed","onUpdate:modelValue":s[3]||(s[3]=t=>i.filter.ride_status=t)},null,512),[[y,i.filter.ride_status]]),e("label",Ye,l(o.$t("completed")),1)]),e("div",Ge,[h(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"cancelled",value:"cancelled","onUpdate:modelValue":s[4]||(s[4]=t=>i.filter.ride_status=t)},null,512),[[y,i.filter.ride_status]]),e("label",Je,l(o.$t("cancelled")),1)]),e("div",Ke,[h(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"upcoming",value:"upcoming","onUpdate:modelValue":s[5]||(s[5]=t=>i.filter.ride_status=t)},null,512),[[y,i.filter.ride_status]]),e("label",Qe,l(o.$t("upcoming")),1)]),e("div",Ze,[h(e("input",{class:"form-check-input",type:"radio",name:"ride_status",id:"ontrip",value:"ontrip","onUpdate:modelValue":s[6]||(s[6]=t=>i.filter.ride_status=t)},null,512),[[y,i.filter.ride_status]]),e("label",Xe,l(o.$t("on_trip")),1)])])]),e("div",et,[e("label",tt,l(o.$t("transport_type")),1),h(e("select",{class:"form-control","data-choices":"","data-choices-search-false":"",name:"choices-select-status",id:"choices-select-status","onUpdate:modelValue":s[7]||(s[7]=t=>i.filter.transport_type=t)},[e("option",st,l(o.$t("all")),1),e("option",it,l(o.$t("taxi")),1),e("option",ot,l(o.$t("delivery")),1)],512),[[le,i.filter.transport_type]])]),e("div",lt,[e("label",at,l(o.$t("zone")),1),r(O,{modelValue:i.filter.zone_id,"onUpdate:modelValue":s[8]||(s[8]=t=>i.filter.zone_id=t),id:"zone_id",mode:"tags",options:i.zoneList.map(t=>({value:t.id,label:t.name})),"close-on-select":!1,multiple:!0,searchable:!0,placeholder:o.$t("select_a_zone"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",nt,[e("label",rt,l(o.$t("vehicle_type")),1),r(O,{id:"vehicle_type_id",mode:"tags",modelValue:i.filter.vehicle_type_id,"onUpdate:modelValue":s[9]||(s[9]=t=>i.filter.vehicle_type_id=t),options:i.types.map(t=>({value:t.id,label:t.name})),"close-on-select":!1,searchable:!0,placeholder:o.$t("select_vehicle_type"),"create-option":!1},null,8,["modelValue","options","placeholder"])]),e("div",dt,[e("label",ct,l(o.$t("payment_status")),1),e("div",null,[e("div",_t,[h(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"not_paid",value:"1","onUpdate:modelValue":s[10]||(s[10]=t=>i.filter.is_paid=t)},null,512),[[y,i.filter.is_paid]]),e("label",ut,l(o.$t("paid")),1)]),e("div",mt,[h(e("input",{class:"form-check-input",type:"radio",name:"payment_status",id:"paid",value:"0","onUpdate:modelValue":s[11]||(s[11]=t=>i.filter.is_paid=t)},null,512),[[y,i.filter.is_paid]]),e("label",ft,l(o.$t("not_paid")),1)])])]),e("div",pt,[e("label",vt,l(o.$t("ride_type")),1),e("div",null,[e("div",bt,[h(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"normal",value:"0","onUpdate:modelValue":s[12]||(s[12]=t=>i.filter.is_bid_ride=t)},null,512),[[y,i.filter.is_bid_ride]]),e("label",ht,l(o.$t("regural")),1)]),e("div",gt,[h(e("input",{class:"form-check-input",type:"radio",name:"dispatch-type",id:"bidding",value:"1","onUpdate:modelValue":s[13]||(s[13]=t=>i.filter.is_bid_ride=t)},null,512),[[y,i.filter.is_bid_ride]]),e("label",yt,l(o.$t("bidding")),1)])])]),s[26]||(s[26]=e("div",null,null,-1))]),e("div",kt,[r(q,{variant:"light",onClick:i.clearFilter,class:"w-100"},{default:_(()=>[p(l(o.$t("clear_filter")),1)]),_:1},8,["onClick"]),r(q,{type:"submit",onClick:i.filterData,variant:"success",class:"w-100"},{default:_(()=>[p(l(o.$t("apply")),1)]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["modelValue","title"])]),_:1})}const Dt=W(me,[["render",wt]]);export{Dt as default};

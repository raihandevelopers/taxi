import{_ as Z,am as E,Z as O,O as q,P as Y,z as G,an as J,C as K,r as u,T as H,R as Q,g as f,o as r,x as B,w as _,U as L,a as W,N as X,k as m,l as e,J as o,i as a,F as T,L as V,y as g,a1 as z,B as y,p as D,n as $}from"./vendor-ddfbd976.js";import{L as ee}from"./main-306a5ea6.js";import{P as se}from"./page-header-2dc95532.js";import{P as te}from"./Pagination-f095ae3c.js";import{s as le}from"./searchbar-3acbc236.js";import{l as oe}from"./footer-e648049d.js";import"./app-042fb454.js";const ie={data(){return{rightOffcanvas:!1,showModal:!1,selectedFile:null,editor:E,editorData:"",zoomLevel:1}},methods:{openPreview(l){this.selectedFile=l,this.showModal=!0},closePreview(){this.showModal=!1,this.selectedFile=null},handleWheelZoom(l){l.preventDefault(),l.deltaY<0?this.zoomLevel+=.1:this.zoomLevel=Math.max(1,this.zoomLevel-.1)},stripHtmlTags(l){return new DOMParser().parseFromString(l,"text/html").body.textContent||""},isFromUser(l){return l.sender_id===l.user_id},isFromEmployee(l){return l.employee_id!==null&&l.employee_id!==""},isFromAdmin(l){return!this.isFromUser(l)&&!this.isFromEmployee(l)},getSenderName(l){var s;return this.isFromUser(l)?(s=this.results.user)==null?void 0:s.name:this.results.admin_name??"Admin/Employee"},getProfilePicture(l){var s,h;return this.isFromUser(l)?((s=this.results.user)==null?void 0:s.profile_picture)||null:((h=this.results.admin_details)==null?void 0:h.profile_picture)||null}},components:{Layout:ee,PageHeader:se,Head:O,Pagination:te,Multiselect:q,flatPickr:Y,Link:G,searchbar:le,ckeditor:J.component},props:{successMessage:String,alertMessage:String,app_for:String,employees:Array,ticket:Object,user:Object,supportTicket:Array,reply_message:Array,support_ticket:Object,attachment:Array},setup(l){const{t:s}=K(),h=u(""),t=H({transport_type:null,dispatch_type:null,status:null}),n=u(l.supportTicket),d=u(l.reply_message),P=u({}),S=u(!1),v=u(!1),w=u(null);u(!1),u([]),u();const x=u(null),C=u({}),I=u(l.attachment),p=H({message:l.support_ticket&&l.support_ticket.message||""}),U={message:{required:!0}},F=u(l.successMessage||""),b=u(l.alertMessage||"");return{results:n,modalShow:S,deleteItemId:w,successMessage:F,alertMessage:b,dismissMessage:()=>{F.value="",b.value=""},searchTerm:h,paginator:P,modalFilter:v,filter:t,toggleActiveStatus:async(c,A)=>{L.fire({title:s("are_you_sure"),text:s("you_are_about_to_change_status"),icon:"warning",showCancelButton:!0,confirmButtonColor:"#34c38f",cancelButtonColor:"#f46a6a",confirmButtonText:s("yes"),cancelButtonText:s("cancel")}).then(async N=>{if(N.isConfirmed)try{await W.post("/title/update-status",{id:c,status:A});const M=n.value.findIndex(R=>R.id===c);M!==-1&&(n.value[M].active=A),L.fire(s("changed"),s("status_updated_successfully"),"success")}catch(M){console.error(s("error_updating_status"),M),L.fire(s("error"),s("failed_to_update_status"),"error")}})},validationRules:U,validationRef:x,form:p,handleSubmit:async()=>{try{let c;c=await W.post(`/support-tickets/ticket/reply/${l.supportTicket.id}`,p.data()),c.status===201?(F.value=s("ticket_created_successfully"),p.reset(),X.get(`/support-tickets/view-details/${n.value.id}`)):b.value=s("failed_to_create_ticket")}catch(c){c.response&&c.response.status===422?C.value=c.response.data.errors:(console.error(s("error_creating_ticket"),c),b.value=s("failed_to_create_ticket_catch"))}},errors:C,reply:d,getFullImageUrl:c=>c?`/storage/uploads/support/support-tickets-files/${c}`:"",attachments:I,isImage:c=>/\.(jpg|jpeg|png|gif|svg|pdf)$/i.test(c),isVideo:c=>/\.(mp4|webm|ogg)$/i.test(c),isPDF:c=>/\.pdf$/i.test(c)}},computed:{...oe,...Q(["permissions"]),sortedMessages(){return[...this.reply_messages].sort((l,s)=>new Date(l.converted_created_at)-new Date(s.converted_created_at))},showReply(){var n;const l=(n=this.reply_message)==null?void 0:n[0];if(!l)return!1;const{sender_id:s,user_id:h,employee_id:t}=l;return s!==h&&s!==t}},mounted(){}},re={class:"row"},ae={class:"col-lg-9"},ne={class:"row row-cols-auto justify-content-between align-items-center g-3"},de={class:"col d-flex align-items-center"},ce=["src"],_e={class:"fs-20 ms-2"},me={class:"fs-14 text-muted ms-2"},ue={class:"col"},fe={class:"ms-auto"},ge={class:"mt-5"},he={class:"mb-3"},ve={key:0,class:"file-container d-flex flex-wrap gap-3"},pe=["onClick"],ye=["src"],be={key:1,class:"file-preview"},ke=["src"],we=["src"],xe={key:3,class:"file-preview d-flex align-items-center justify-content-center"},Fe={key:1,class:"no-files text-center text-muted fs-18"},Ce={class:"modal-content"},Me=["src"],Be={key:1,controls:"",class:"popup-content"},Pe=["src"],Se=["src"],Ie=["href"],Ue={class:"mb-4 ms-2"},Le={class:"col"},Te=["src"],Ve={class:"fs-16 ms-2",style:{"font-weight":"600"}},ze={class:"badge bg-light text-body fs-12 p-2 mt-2"},De={class:"col"},Ae={key:1,class:"no-files text-center text-muted fs-18"},He={class:"row"},We={class:"col-sm-12"},je={class:"mb-3"},Ne={for:"description",class:"form-label"},Re={class:"col-lg-12"},Ze={class:"text-end"},Ee=["disabled"],Oe={class:"col-lg-3"},qe={class:"row row-cols-auto justify-content-between align-items-center g-3"},Ye={class:"col"},Ge={class:"col"},Je={class:"ms-auto"},Ke={class:"d-flex align-items-center mb-2"},Qe={class:"flex-shrink-0"},Xe={class:"text-muted mb-0"},$e={class:"flex-grow-1 ms-2"},es={class:"mb-0"},ss={key:0,class:"d-flex align-items-center mb-2"},ts={class:"flex-shrink-0"},ls={class:"text-muted mb-0"},os={class:"flex-grow-1 ms-2"},is={class:"mb-0"},rs={class:"d-flex align-items-center mb-2"},as={class:"flex-shrink-0"},ns={class:"text-muted mb-0"},ds={class:"flex-grow-1 ms-2"},cs={class:"mb-0"},_s={class:"d-flex align-items-center mb-2"},ms={class:"flex-shrink-0"},us={class:"text-muted mb-0"},fs={class:"flex-grow-1 ms-2"},gs={key:0,class:"mb-0"},hs={key:1,class:"mb-0"},vs={class:"d-flex align-items-center mb-2"},ps={class:"flex-shrink-0"},ys={class:"text-muted mb-0"},bs={class:"flex-grow-1 ms-2"},ks={class:"mb-0"},ws={class:"d-flex align-items-center mb-2"},xs={class:"flex-shrink-0"},Fs={class:"text-muted mb-0"},Cs={class:"flex-grow-1 ms-2"},Ms={class:"mb-0"},Bs={class:"d-flex align-items-center mb-2"},Ps={class:"flex-shrink-0"},Ss={class:"text-muted mb-0"},Is={class:"flex-grow-1 ms-2"},Us={class:"mb-0"},Ls={key:0,class:"custom-alert alert alert-success alert-border-left fade show",data:"alert",id:"alertMsg"},Ts={class:"alert-content"},Vs={key:1,class:"custom-alert alert alert-danger alert-border-left fade show",data:"alert",id:"alertMsg"},zs={class:"alert-content"};function Ds(l,s,h,t,n,d){const P=f("Head"),S=f("PageHeader"),v=f("BCard"),w=f("BCardHeader"),x=f("BCardBody"),C=f("ckeditor"),I=f("FormValidation"),p=f("BBadge"),U=f("BCol"),F=f("BRow"),b=f("Layout");return r(),B(b,null,{default:_(()=>[m(P,{title:"Tickets"}),m(S,{title:l.$t("view_ticket"),pageTitle:l.$t("support_management"),pageLink:"/support-tickets"},null,8,["title","pageTitle"]),m(F,null,{default:_(()=>[m(U,{lg:"12"},{default:_(()=>[m(v,{"no-body":"",id:"tasksList"}),e("div",re,[e("div",ae,[m(v,{class:"border"},{default:_(()=>[m(w,{class:"border-0"},{default:_(()=>[e("div",ne,[e("div",de,[e("img",{src:t.results.user.profile_picture,class:"img-fluid avatar-md rounded-circle",width:"100",alt:"user-profile"},null,8,ce),e("div",null,[e("span",_e,o(t.results.user_name),1),e("p",me,o(t.results.user_type),1)])]),e("div",ue,[e("h6",fe,o(t.results.converted_created_at),1)])])]),_:1}),m(x,null,{default:_(()=>[e("h5",null,o(t.results.title),1),e("h6",null,o(t.results.description),1),e("div",ge,[e("h5",he,o(l.$t("attachments"))+" : ",1),t.attachments.length>0?(r(),a("div",ve,[(r(!0),a(T,null,V(t.attachments,(i,k)=>(r(),a("div",{key:k,class:"file-box",onClick:j=>d.openPreview(i.image_name)},[t.isImage(i.image_name)?(r(),a("img",{key:0,src:t.getFullImageUrl(i.image_name),class:"file-preview"},null,8,ye)):t.isVideo(i.image_name)?(r(),a("video",be,[e("source",{src:t.getFullImageUrl(i.image_name),type:"video/mp4"},null,8,ke),s[9]||(s[9]=g(" Your browser does not support video playback. "))])):t.isPDF(i.image_name)?(r(),a("embed",{key:2,src:t.getFullImageUrl(i.image_name),type:"application/pdf",class:"file-preview"},null,8,we)):(r(),a("div",xe,s[10]||(s[10]=[e("i",{class:"fas fa-file-alt fa-2x"},null,-1)])))],8,pe))),128))])):(r(),a("div",Fe,[s[11]||(s[11]=e("i",{class:"ri-file-unknow-line",style:{"font-size":"32px"}},null,-1)),e("p",null,o(l.$t("no_attachments_here")),1)]))]),n.showModal?(r(),a("div",{key:0,class:"modal-overlay",onClick:s[4]||(s[4]=(...i)=>d.closePreview&&d.closePreview(...i))},[e("div",Ce,[e("span",{class:"close-btn",onClick:s[0]||(s[0]=(...i)=>d.closePreview&&d.closePreview(...i))},"Ã—"),t.isImage(n.selectedFile)?(r(),a("img",{key:0,src:t.getFullImageUrl(n.selectedFile),class:"popup-content",style:z({transform:`scale(${n.zoomLevel})`}),onWheel:s[1]||(s[1]=(...i)=>d.handleWheelZoom&&d.handleWheelZoom(...i))},null,44,Me)):t.isVideo(n.selectedFile)?(r(),a("video",Be,[e("source",{src:t.getFullImageUrl(n.selectedFile),type:"video/mp4",style:z({transform:`scale(${n.zoomLevel})`}),onWheel:s[2]||(s[2]=(...i)=>d.handleWheelZoom&&d.handleWheelZoom(...i))},null,44,Pe)])):t.isPDF(n.selectedFile)?(r(),a("embed",{key:2,src:t.getFullImageUrl(n.selectedFile),type:"application/pdf",class:"popup-content",style:z({transform:`scale(${n.zoomLevel})`}),onWheel:s[3]||(s[3]=(...i)=>d.handleWheelZoom&&d.handleWheelZoom(...i))},null,44,Se)):(r(),a("a",{key:3,href:t.getFullImageUrl(n.selectedFile),target:"_blank",class:"btn btn-primary"},"Download File",8,Ie))])])):y("",!0)]),_:1})]),_:1}),e("div",null,[e("h4",Ue,o(l.$t("reply_message")),1),m(v,{class:"border",style:{"max-height":"500px","overflow-y":"auto"}},{default:_(()=>[t.reply.length>0?(r(!0),a(T,{key:0},V(t.reply,(i,k)=>(r(),a("div",{class:"card p-3 border mt-2",key:k},[e("div",{class:D(["border-0",d.isFromUser(i)?"text-start":"text-end"])},[e("div",{class:D(["row row-cols-auto align-items-center g-3",d.isFromUser(i)?"":"flex-row-reverse"])},[e("div",Le,[e("img",{src:d.getProfilePicture(i),class:"img-fluid avatar-xs rounded-circle",width:"100",alt:"user-profile"},null,8,Te),e("span",Ve,o(d.getSenderName(i)),1)])],2)],2),e("div",{class:D(["",d.isFromUser(i)?"text-start ms-4":"text-end"])},[e("h6",ze,o(d.stripHtmlTags(i.message)),1),e("div",De,[e("h6",null,o(i.converted_created_at),1)])],2)]))),128)):(r(),a("div",Ae,[s[12]||(s[12]=e("i",{class:"ri-chat-delete-line",style:{"font-size":"32px"}},null,-1)),e("p",null,o(l.$t("no_messages_here")),1)]))]),_:1}),m(v,{class:"border"},{default:_(()=>[m(w,{class:"border-0"},{default:_(()=>[e("h4",null,[s[13]||(s[13]=e("i",{class:"ri-reply-fill bx-sm me-2"},null,-1)),g(o(l.$t("reply")),1)])]),_:1}),m(x,null,{default:_(()=>[e("form",{onSubmit:s[6]||(s[6]=$((...i)=>t.handleSubmit&&t.handleSubmit(...i),["prevent"]))},[m(I,{form:t.form,rules:t.validationRules,ref:"validationRef"},{default:_(()=>[e("div",He,[e("div",We,[e("div",je,[e("label",Ne,[g(o(l.$t("message"))+" ",1),s[14]||(s[14]=e("span",{class:"text-danger"},"*",-1))]),m(C,{disabled:h.app_for==="demo",modelValue:t.form.message,"onUpdate:modelValue":s[5]||(s[5]=i=>t.form.message=i),editor:n.editor},null,8,["disabled","modelValue","editor"]),(r(!0),a(T,null,V(t.errors.message,(i,k)=>(r(),a("span",{key:k,class:"text-danger"},o(i),1))),128))])]),e("div",Re,[e("div",Ze,[e("button",{disabled:t.results.status==3||t.results.status==1,type:"submit",class:"btn btn-primary"},o(l.$t("send")),9,Ee)])])])]),_:1},8,["form","rules"])],32)]),_:1})]),_:1})])]),e("div",Oe,[m(v,{class:"border"},{default:_(()=>[m(w,{class:"border-bottom-0"},{default:_(()=>[s[15]||(s[15]=e("div",{class:"row"},null,-1)),e("div",qe,[e("div",Ye,[e("h4",null,o(l.$t("ticket_details")),1)]),e("div",Ge,[e("div",Je,[t.results.status==1?(r(),B(p,{key:0,variant:"success",class:"text-uppercase"},{default:_(()=>[g(o(l.$t("pending")),1)]),_:1})):y("",!0),t.results.status==2?(r(),B(p,{key:1,variant:"warning",class:"text-uppercase"},{default:_(()=>[g(o(l.$t("acknowledge")),1)]),_:1})):y("",!0),t.results.status==3?(r(),B(p,{key:2,variant:"danger",class:"text-uppercase"},{default:_(()=>[g(o(l.$t("closed")),1)]),_:1})):y("",!0)])])])]),_:1,__:[15]}),m(x,null,{default:_(()=>[e("div",Ke,[e("div",Qe,[e("p",Xe,o(l.$t("ticket_id"))+":",1)]),e("div",$e,[e("h6",es,o(t.results.ticket_id),1)])]),t.results.request_id?(r(),a("div",ss,[e("div",ts,[e("p",ls,o(l.$t("request_id"))+":",1)]),e("div",os,[e("h6",is,o(t.results.request_id??"-"),1)])])):y("",!0),e("div",rs,[e("div",as,[e("p",ns,o(l.$t("ticket_title"))+":",1)]),e("div",ds,[e("h6",cs,o(t.results.title),1)])]),e("div",_s,[e("div",ms,[e("p",us,o(l.$t("assign_to"))+":",1)]),e("div",fs,[t.results.assign_to?(r(),a("h6",gs,o(t.results.admin_details.first_name),1)):(r(),a("h6",hs,o(l.$t("not_assigned")),1))])]),e("div",vs,[e("div",ps,[e("p",ys,o(l.$t("support_type"))+":",1)]),e("div",bs,[e("h6",ks,o(t.results.support_type),1)])]),e("div",ws,[e("div",xs,[e("p",Fs,o(l.$t("from"))+":",1)]),e("div",Cs,[e("h6",Ms,o(t.results.user_type),1)])]),e("div",Bs,[e("div",Ps,[e("p",Ss,o(l.$t("created"))+":",1)]),e("div",Is,[e("h6",Us,o(t.results.converted_created_at),1)])])]),_:1})]),_:1})])])]),_:1})]),_:1}),e("div",null,[t.successMessage?(r(),a("div",Ls,[e("div",Ts,[s[16]||(s[16]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[17]||(s[17]=g()),s[18]||(s[18]=e("strong",null,"Success",-1)),g(" - "+o(t.successMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-success",onClick:s[7]||(s[7]=(...i)=>t.dismissMessage&&t.dismissMessage(...i)),"aria-label":"Close Success Message"})])])):y("",!0),t.alertMessage?(r(),a("div",Vs,[e("div",zs,[s[19]||(s[19]=e("i",{class:"ri-notification-off-line me-3 align-middle"},null,-1)),s[20]||(s[20]=g()),s[21]||(s[21]=e("strong",null,"Alert",-1)),g(" - "+o(t.alertMessage)+" ",1),e("button",{type:"button",class:"btn-close btn-close-danger",onClick:s[8]||(s[8]=(...i)=>t.dismissMessage&&t.dismissMessage(...i)),"aria-label":"Close Alert Message"})])])):y("",!0)])]),_:1})}const Gs=Z(ie,[["render",Ds],["__scopeId","data-v-32e75c63"]]);export{Gs as default};

import{_ as X,Z as Q,z as ee,Y as te,P as se,R as ae,U as w,C as oe,r as k,D as ie,g as p,o as B,x as le,w as r,a as ne,N as re,X as b,k as n,l as e,J as o,i as T,F as Y,L as Z,B as J,q as de,M as ce,y as q}from"./vendor-ddfbd976.js";import{L as _e}from"./dispatchmain-37fc6bfb.js";import{P as ue}from"./page-header-2dc95532.js";import{F as me}from"./FormValidation-a9047131.js";import"./footer-e648049d.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const ve={data(){return{rightOffcanvas:!1}},components:{Layout:_e,PageHeader:ue,Head:Q,Link:ee,Scrollbar:te,FormValidation:me,flatPickr:se},computed:{...ae(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object},methods:{timer(){let s;w.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,onBeforeOpen:()=>{w.showLoading(),s=setInterval(()=>{w.getContent().querySelector("b").textContent=w.getTimerLeft()},100)},onClose:()=>{clearInterval(s)}}).then(t=>{t.dismiss===w.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(s){const{t}=oe(),c=k(!1),v=k(s.driver_radius??10),N=k(s.successMessage||""),O=k(s.alertMessage||""),A=()=>{N.value="",O.value=""},M=k(""),g=k([]),x=k(null),m=k(s.result),P=a=>{x.value=a,c.value=!0},E=async a=>{try{const _=await ne.post(`/dispatcher/ongoing_request/assign-driver/${m.value.id}`,{driver_id:a.id});_.data.status?(c.value=!1,w.fire(t("success"),t("users_deleted_successfully"),"success")):(w.fire(t("Warning"),_.data.message,"warning"),console.log(_))}catch(_){w.fire(t("Warning"),response.data.message,"warning"),console.error(_)}},F=(a,_,u,d)=>{const S=(u-a)*Math.PI/180,y=(d-_)*Math.PI/180,f=Math.sin(S/2)*Math.sin(S/2)+Math.cos(a*Math.PI/180)*Math.cos(u*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);return 6371*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))},V=()=>{g.value=[];const a=firebase.database().ref("drivers");firebase.database().ref("requests").child(m.value.id).on("value",u=>{const d=u.val();d&&(d.is_accept||d.hasOwnProperty("driver_id"))&&re.get(`/dispatcher/rides_request/view/${m.value.id}`)}),a.on("value",u=>{g.value=[],u.forEach(d=>{const l=d.val(),y=Date.now()-15*60*1e3;if(l.updated_at<y)return;const f=$(l.g);let I=!0;if(M.value.length>0&&l.name&&(I=l.name.includes(M.value)||l.mobile.includes(M.value)),f&&I)if(F(m.value.pick_lat,m.value.pick_lng,f.lat,f.lon)<=v.value&&l.is_available&&l.is_active&&l.vehicle_types.includes(m.value.vehicle_type_id)){let z=`/image/map/${l.vehicle_type_icon}-online.png`;const U=[f.lat,f.lon];if(g.value.push(l),h[l.id])i(h[l.id],h[l.id].getLatLng(),U),h[l.id].setIcon(b.icon({iconUrl:z,iconSize:[30,30]}));else{const L=b.marker(U,{icon:b.icon({iconUrl:z,iconSize:[30,30]})}).addTo(C);L.bindTooltip(`<strong>${l.name}</strong><br>Mobile: ${app_for=="demo"?"***********":l.mobile}`,{permanent:!1,direction:"top",offset:[0,-10]}),h[l.id]=L,i(L,L.getLatLng(),U)}}else R(l.id)})}),a.on("child_changed",u=>{const d=u.val();D(d)}),a.on("child_removed",u=>{const d=u.val();R(d.id)})},$=a=>{const _="0123456789bcdefghjkmnpqrstuvwxyz",u=[16,8,4,2,1];let d=!0,l=-90,S=90,y=-180,f=180,I,H;if(a){for(let z=0;z<a.length;z++){let U=a.charAt(z),L=_.indexOf(U);for(let G=0;G<5;G++){let W=u[G];if(d){let j=(y+f)/2;L&W?y=j:f=j}else{let j=(l+S)/2;L&W?l=j:S=j}d=!d}}return I=(l+S)/2,H=(y+f)/2,{lat:I,lon:H}}return null};watch(M.value,debounce(function(a){V()},300));const i=(a,_,u)=>{a.setLatLng(u).update()},D=a=>{const _=$(a.g);if(_){const u=[_.lat,_.lon],d=`/image/map/${a.vehicle_type_icon}.png`;if(h[a.id])i(h[a.id],h[a.id].getLatLng(),u),h[a.id].setIcon(b.icon({iconUrl:d,iconSize:[30,30]}));else{const l=b.marker(u,{icon:b.icon({iconUrl:d,iconSize:[30,30]})}).addTo(C);h[a.id]=l}}else console.error(`${t("failed_to_decode_geohash")} ${a.id}`)},R=a=>{h[a]&&(C.removeLayer(h[a]),delete h[a])};let C,h={};const K=()=>{C=b.map("map").setView([m.value.pick_lat,m.value.pick_lng],15),b.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(C);const a=b.icon({iconUrl:"/image/map/pickup.png",iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[0,-32]});b.marker([m.value.pick_lat,m.value.pick_lng],{icon:a}).addTo(C),V()};return ie(async()=>{try{var a={apiKey:s.firebaseSettings.firebase_api_key,authDomain:s.firebaseSettings.firebase_auth_domain,databaseURL:s.firebaseSettings.firebase_database_url,projectId:s.firebaseSettings.firebase_project_id,storageBucket:s.firebaseSettings.firebase_storage_bucket,messagingSenderId:s.firebaseSettings.firebase_messaging_sender_id,appId:s.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(a),K()}catch(_){console.error(t("error_initializing_firebase_or_fetching_settings"),_)}}),{modalShow:c,successMessage:N,alertMessage:O,modalDriver:x,driverSearch:M,assignDriver:E,assignModal:P,fleetDrivers:g,dismissMessage:A,errors:{}}}},he={class:"col-lg-3"},fe={class:"card-header"},ge={class:"card-title mb-0"},pe={class:"card-body p-4 text-center"},be={class:"mx-auto avatar-md mb-3"},ye=["src"],we={class:"card-title mb-1"},ke={class:"text-muted mb-0"},Me={class:"col-lg-3"},xe={class:"card-header"},Se={class:"card-title mb-0"},Le={class:"card-body p-4 text-center"},Be={class:"mx-auto avatar-md mb-3"},De=["src"],Ce={class:"card-title mb-1"},Ie={class:"col-lg-6"},ze={class:"card-header"},Te={class:"card-title mb-0"},qe={class:"card-body p-4"},Pe={class:"mb-2"},Re={class:"mb-2"},Ue={key:0},je={class:"mb-2"},Ve={class:"mb-2"},$e={class:"btn-group mb-2"},He={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},Ne={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},Oe={class:"dropdown-item overflow-auto"},Ae={key:1},Ee={class:"mb-2"},Fe={class:"mb-2"},Ge={class:"position-relative col-lg-4"},We={class:"row"},Ye={class:"col-12 col-lg-5",style:{"overflow-x":"auto"}},Ze={class:"row"},Je={class:"row"},Ke=["onClick"],Xe={class:"col-sm-2 border-end d-flex align-items-center justify-content-center"},Qe=["src"],et={class:"col-sm-4 mt-3 border-end"},tt={class:"d-flex align-items-center"},st={class:"d-flex align-items-center"},at={class:"d-flex align-items-center"},ot={class:"col-sm-6 d-flex align-items-center"},it={class:"row"},lt={class:"col-lg-12"},nt={type:"button",class:"btn btn-info btn-label waves-effect waves-light"},rt={class:"col-lg-12"},dt={class:"d-flex list-inline mb-0 mt-3"},ct={class:"list-inline-item avatar-xs"},_t=["title"],ut={class:"mt-2",style:{width:"max-content"}},mt={class:"list-inline-item avatar-xs ms-5"},vt=["title"],ht={class:"mt-2",style:{width:"max-content"}},ft={class:"list-inline-item avatar-xs ms-5"},gt=["title"],pt={class:"mt-2",style:{width:"max-content"}},bt={class:"col-12 col-lg-7"},yt={class:"mb-3 text-center m-auto"},wt={id:"map",style:{height:"500px"}},kt={class:"col-lg-12"},Mt={class:"card-header"},xt={class:"card-title mb-0"},St={class:"card-body p-4 text-center"},Lt={class:"mx-auto avatar-md mb-3"},Bt=["src"],Dt={class:"card-title mb-1"},Ct={class:"text-muted mb-0"},It={class:"text-muted mb-0"},zt={class:"modal-footer v-modal-footer"};function Tt(s,t,c,v,N,O){const A=p("Head"),M=p("PageHeader"),g=p("BRow"),x=p("BCardBody"),m=p("BCard"),P=p("BCol"),E=p("BCardHeader"),F=p("BLink"),V=p("BModal"),$=p("Layout");return B(),le($,null,{default:r(()=>[n(A,{title:"Taxi Ride"}),n(M,{title:s.$t("book"),pageTitle:s.$t("taxi_ride"),pageLink:"/dispatcher/ongoing_request"},null,8,["title","pageTitle"]),n(g,null,{default:r(()=>[n(P,null,{default:r(()=>[n(m,null,{default:r(()=>[n(x,null,{default:r(()=>[n(g,null,{default:r(()=>[e("div",he,[e("div",fe,[e("h6",ge,o(s.$t("user_details")),1)]),e("div",pe,[e("div",be,[e("img",{src:c.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,ye)]),e("h5",we,o(c.result.userDetail.data.name),1),e("p",ke,o(c.app_for=="demo"?"***********":c.result.userDetail.data.mobile),1)])]),e("div",Me,[e("div",xe,[e("h6",Se,o(s.$t("vehicle_details")),1)]),e("div",Le,[e("div",Be,[e("img",{src:c.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,De)]),e("h5",Ce,o(c.result.vehicle_type_name),1)])]),e("div",Ie,[e("div",ze,[e("h6",Te,o(s.$t("trip_details")),1)]),e("div",qe,[e("h5",Pe,[e("b",null,o(s.$t("pickup_location")),1)]),e("h6",Re,o(c.result.pick_address),1),c.result.requestStops.data.length>0?(B(),T("div",Ue,[e("h5",je,[e("b",null,o(s.$t("stop_location")),1)]),e("h5",Ve,[e("b",null,o(s.$t("stop_location")),1)]),e("div",$e,[e("button",He,o(s.$t("view_stop_location")),1),e("ul",Ne,[(B(!0),T(Y,null,Z(c.result.requestStops.data,(i,D)=>(B(),T("li",null,[e("a",Oe,o(i.address),1)]))),256))])])])):J("",!0),c.result.is_rental?J("",!0):(B(),T("div",Ae,[e("h5",Ee,[e("b",null,o(s.$t("drop_location")),1)]),e("h6",Fe,o(c.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(g,null,{default:r(()=>[n(P,{lg:"12"},{default:r(()=>[n(m,{"no-body":"",id:"tasksList"},{default:r(()=>[n(E,{class:"border-0"},{default:r(()=>[e("div",Ge,[de(e("input",{type:"text",class:"form-control",placeholder:"Search...","onUpdate:modelValue":t[0]||(t[0]=i=>v.driverSearch=i),autocomplete:"off",id:"search-options",value:""},null,512),[[ce,v.driverSearch]])])]),_:1}),n(x,{class:"border border-dashed border-end-0 border-start-0"},{default:r(()=>[e("div",We,[e("div",Ye,[e("div",Ze,[n(g,null,{default:r(()=>[n(m,{"no-body":""},{default:r(()=>[n(x,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:r(()=>[n(P,{xl:"12"},{default:r(()=>[e("div",Je,[(B(!0),T(Y,null,Z(v.fleetDrivers,i=>(B(),T("div",{key:i.driver_id,onClick:D=>v.assignModal(i),class:"row"},[e("div",Xe,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:i.profile_picture},null,8,Qe)])]),e("div",et,[e("div",tt,[t[4]||(t[4]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),t[5]||(t[5]=q("    ")),e("span",null,o(i.name),1)]),e("div",st,[t[6]||(t[6]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),t[7]||(t[7]=q("    ")),e("span",null,o(c.app_for=="demo"?"***********":i.mobile),1)]),e("div",at,[t[8]||(t[8]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),t[9]||(t[9]=q("    ")),e("span",null,o(i.rating),1)])]),e("div",ot,[e("div",it,[e("div",lt,[e("div",null,[e("button",nt,[t[10]||(t[10]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),q(" "+o(s.$t("assign")),1)])])]),e("div",rt,[e("ul",dt,[e("li",ct,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-success-subtle text-success fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_rides_distance")},t[11]||(t[11]=[e("i",{class:"ri-pin-distance-line"},null,-1)]),8,_t),e("h6",ut,o(i.total_kms?i.total_kms:"-"),1)]),e("li",mt,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-danger-subtle text-danger fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_rides_taken")},t[12]||(t[12]=[e("i",{class:"ri-police-car-fill"},null,-1)]),8,vt),e("h6",ht,o(i.total_rides_taken),1)]),e("li",ft,[e("a",{href:"javascript:void(0);",class:"avatar-title bg-warning-subtle text-warning fs-15 rounded","data-bs-toggle":"tooltip","data-bs-placement":"top",title:s.$t("today_active")},t[13]||(t[13]=[e("i",{class:"ri-map-pin-time-line"},null,-1)]),8,gt),e("h6",pt,o(i.total_active_hrs?i.total_active_hrs:"-"),1)])])])])])],8,Ke))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",bt,[e("div",yt,[e("div",wt,o(s.$t("map_loading")),1)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[n(V,{modelValue:v.modalShow,"onUpdate:modelValue":t[3]||(t[3]=i=>v.modalShow=i),"hide-footer":"",title:s.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:r(()=>[n(m,null,{default:r(()=>[n(x,null,{default:r(()=>[n(g,null,{default:r(()=>{var i,D,R;return[e("div",kt,[e("div",Mt,[e("h6",xt,o(s.$t("confirm_assign_driver")),1)]),e("div",St,[e("div",Lt,[e("img",{src:(i=v.modalDriver)==null?void 0:i.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,Bt)]),e("h5",Dt,o((D=v.modalDriver)==null?void 0:D.name),1),e("p",Ct,o(c.app_for=="demo"?"***********":(R=v.modalDriver)==null?void 0:R.mobile),1)]),e("p",It,o(s.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",zt,[n(F,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:t[1]||(t[1]=i=>v.modalShow=!1)},{default:r(()=>[t[14]||(t[14]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),q(" "+o(s.$t("close")),1)]),_:1,__:[14]}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:t[2]||(t[2]=i=>v.assignDriver(v.modalDriver))},[t[15]||(t[15]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),q(" "+o(s.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const Ht=X(ve,[["render",Tt]]);export{Ht as default};

import{_ as X,O as Y,C as Z,r as k,Q as K,D as ee,g as f,o as h,x as Q,w as d,k as n,l as s,J as r,y as q,i as L,F as te,L as se,B as G}from"./vendor-ddfbd976.js";import{L as ae}from"./dispatchmain-37fc6bfb.js";import{P as le}from"./page-header-2dc95532.js";import"./footer-e648049d.js";import"./dispatchHorizontal-7568e444.js";import"./app-042fb454.js";const oe={components:{Layout:ae,PageHeader:le,Multiselect:Y},props:{firebaseSettings:Object,map_key:String,service_location:Array,vehicle_type:Array,default_lat:String,app_for:String,default_lng:String},setup(t){var a,J;const{t:u}=Z(),w=k(null),l=k(null),_=k([]),z=k([]),E=k(t.service_location.map(o=>({value:o.id,label:o.name}))),R=k(t.vehicle_type.map(o=>({value:o.id,label:o.name}))),I=k((J=(a=E.value)==null?void 0:a[0])==null?void 0:J.value);let p={},B;const N=()=>{l.value=null,_.value=[],b()},$=()=>{b()};K([l,_],()=>{b()});const A=async()=>{if(!w.value){let o=document.getElementById("map");w.value=new google.maps.Map(o,{center:{lat:parseFloat(t.default_lat),lng:parseFloat(t.default_lng)},zoom:15})}B=new google.maps.InfoWindow,b()},b=async()=>{firebase.database().ref("drivers").once("value",V=>{const c=V.val();if(c){for(let g in p)p[g]&&p[g].setMap(null);p={},z.value=[],Object.keys(c).forEach(g=>{const e=c[g],D=e.g,y=U(D);if(y&&e.service_location_id){const T=new google.maps.LatLng(y.lat,y.lon);let j=!!e.service_location_id;I.value&&(j=I.value==e.service_location_id);let F=Array.isArray(e.vehicle_types);l.value&&Array.isArray(e.vehicle_types)&&e.vehicle_types.length>0&&(F=(Array.isArray(e.vehicle_types)&&e.vehicle_types.some(v=>l.value===v))??!1);let H=_.value.length>0?_.value.includes("online"):!0,W=_.value.length>0?_.value.includes("onride"):!0,O=_.value.length>0?_.value.includes("offline"):!0,m="",M="offline",i="";if(e.hasOwnProperty("is_active")&&e.hasOwnProperty("is_available")){if(e.is_active==1&&e.is_available==!0&&H)m=`/image/map/${e.vehicle_type_icon}.png`,M="online";else if(e.is_active==1&&e.is_available==!1&&W)M="onride",m=`/image/map/${e.vehicle_type_icon}.png`;else if(O){m=`/image/map/${e.vehicle_type_icon}.png`;let v=new Date-new Date(e.updated_at),S=parseInt(v/6e4),C=0,x=0,P=0;S>59&&(C=parseInt(S/60),C>23&&(x=parseInt(C/24),x>6&&(P=parseInt(x/7)))),S<=1&&(i="just now"),S>1&&S<59&&(i=S+" minutes ago"),C==1&&(i="An hour ago"),C>1&&(i=C+" hours ago"),x==1&&(i="A day ago"),x>1&&(i=x+" days ago"),P==1&&(i="A week ago"),P>1&&(i=P+" weeks ago")}}if(j&&F&&m.length>0){const v=new google.maps.Marker({position:T,map:w.value,icon:{url:m,scaledSize:new google.maps.Size(30,30)}});e.status=M,e.last_seen=i,z.value.push(e),v.addListener("mouseover",()=>{B.setContent(`<div><strong>${e.name}</strong><br>Mobile: ${t.app_for=="demo"?"**********":e.mobile}</div>`),B.open(w.value,v)}),v.addListener("mouseout",()=>{B.close()}),p[e.id]=v}}})}})},U=o=>{const V="0123456789bcdefghjkmnpqrstuvwxyz",c=[16,8,4,2,1];let g=!0,e=-90,D=90,y=-180,T=180,j,F;if(o){for(let H=0;H<o.length;H++){let W=o.charAt(H),O=V.indexOf(W);for(let m=0;m<5;m++){let M=c[m];if(g){let i=(y+T)/2;O&M?y=i:T=i}else{let i=(e+D)/2;O&M?e=i:D=i}g=!g}}return j=(e+D)/2,F=(y+T)/2,{lat:j,lon:F}}};return K([_,l],()=>{b()}),ee(async()=>{const o=t.map_key;if(document.querySelector(`script[src*="maps.googleapis.com/maps/api/js?key=${o}&libraries=places,visualization"]`))A();else{const c=document.createElement("script");c.src=`https://maps.googleapis.com/maps/api/js?key=${o}&libraries=places,visualization`,c.async=!0,c.defer=!0,c.onload=()=>{A()},c.onerror=()=>{console.error(u("google_maps_script_failed_to_load"))},document.head.appendChild(c)}var V={apiKey:t.firebaseSettings.firebase_api_key,authDomain:t.firebaseSettings.firebase_auth_domain,databaseURL:t.firebaseSettings.firebase_database_url,projectId:t.firebaseSettings.firebase_project_id,storageBucket:t.firebaseSettings.firebase_storage_bucket,messagingSenderId:t.firebaseSettings.firebase_messaging_sender_id,appId:t.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(V)}),{serviceLocations:E,vehicleTypes:R,selectedDriverModes:_,drivers_list:z,clearFilters:N,applyFilters:$,selectedVehicleTypes:l}}},ie={class:"row"},ne={class:"col-12 col-lg-3"},re={class:"mb-3"},ce={for:"select_driver_mode",class:"form-label"},de={class:"col-12 col-lg-3"},_e={class:"mb-3"},ue={for:"vehicle_type",class:"form-label"},fe={class:"col-12 col-lg-12 d-flex gap-1"},me={key:0,class:"overflow-auto",style:{height:"400px"}},pe={class:"accordion-item border-0"},ge={class:"accordion-header",id:"headingThree"},ve={class:"accordion-button p-2 shadow-none","data-bs-toggle":"collapse",href:"#","aria-expanded":"false","aria-controls":"collapseThree"},he={class:"d-flex align-items-center"},be={class:"flex-shrink-0 border border-4 rounded-circle",style:{border:"var(--landing_header_act_text)"}},ye=["src"],ke={class:"d-flex justify-content-around"},we={class:"flex-grow-1 ms-3"},Be={class:"fs-15 mb-1 fw-semibold",style:{color:"var(--landing_header_act_text)"}},Me={class:"fs-15 mb-1 fw-normal",style:{color:"var(--landing_header_act_text)"}},Se={class:"fs-15 mb-1 fw-normal"},Ce={class:"text-end ms-5 d-block"},xe={key:0,class:"fs-15 mb-1 fw-semibold text-danger"},Le={key:1,class:"fs-15 mb-1 fw-semibold text-success"},Ie={key:2,class:"fs-15 mb-1 fw-semibold text-primary"},$e={class:"flex-grow-1 fs-15 mb-1 text-muted mt-5"},Ae={key:1,class:"d-flex",style:{height:"400px"}},Ve={id:"map",style:{height:"400px"}};function De(t,u,w,l,_,z){const E=f("Head"),R=f("PageHeader"),I=f("Multiselect"),p=f("BButton"),B=f("BCardHeader"),N=f("BCard"),$=f("BCol"),A=f("BRow"),b=f("BCardBody"),U=f("Layout");return h(),Q(U,null,{default:d(()=>[n(E,{title:t.$t("gods-eye")},null,8,["title"]),n(R,{title:t.$t("gods-eye"),pageTitle:t.$t("dispatch")},null,8,["title","pageTitle"]),n(A,null,{default:d(()=>[n($,{lg:"12"},{default:d(()=>[n(N,{"no-body":"",id:"tasksList"},{default:d(()=>[n(B,{class:"border-0"},{default:d(()=>[s("h4",null,r(t.$t("filters")),1),s("div",ie,[s("div",ne,[s("div",re,[s("label",ce,r(t.$t("drivers")),1),n(I,{modelValue:l.selectedDriverModes,"onUpdate:modelValue":u[0]||(u[0]=a=>l.selectedDriverModes=a),id:"select_driver_mode",mode:"tags","close-on-select":!1,searchable:!0,"create-option":!1,options:[{value:"offline",label:t.$t("offline")},{value:"online",label:t.$t("online")},{value:"onride",label:t.$t("onride")}],placeholder:t.$t("select_mode")},null,8,["modelValue","options","placeholder"])])]),s("div",de,[s("div",_e,[s("label",ue,r(t.$t("vehicle_types")),1),n(I,{modelValue:l.selectedVehicleTypes,"onUpdate:modelValue":u[1]||(u[1]=a=>l.selectedVehicleTypes=a),options:l.vehicleTypes,label:"label","track-by":"value",multiple:"","close-on-select":"",placeholder:t.$t("select_vehicle_types")},null,8,["modelValue","options","placeholder"])])]),s("div",fe,[n(p,{type:"button",variant:"success",class:"btn btn-md",onClick:l.applyFilters},{default:d(()=>[q(r(t.$t("apply")),1)]),_:1},8,["onClick"]),n(p,{type:"button",variant:"danger",class:"btn btn-md",onClick:l.clearFilters},{default:d(()=>[q(r(t.$t("clear")),1)]),_:1},8,["onClick"])])])]),_:1}),n(b,{class:"border border-dashed border-end-0 border-start-0"},{default:d(()=>[n(A,null,{default:d(()=>[n($,{lg:"4"},{default:d(()=>[l.drivers_list.length>0?(h(),L("div",me,[(h(!0),L(te,null,se(l.drivers_list,a=>(h(),Q(N,{class:"col-lg-12"},{default:d(()=>[s("div",pe,[s("div",ge,[s("a",ve,[s("div",he,[s("div",be,[s("img",{src:a.profile_picture,alt:"",class:"avatar-md rounded-circle"},null,8,ye)]),s("div",ke,[s("div",we,[s("h4",Be,r(a.name),1),s("h6",Me,r(w.app_for=="demo"?"*********":a.mobile),1),s("h6",Se,[q(r(a.rating)+" ",1),u[2]||(u[2]=s("i",{class:"ri-star-fill text-warning align-bottom me-1"},null,-1))])]),s("div",Ce,[a.status=="offline"?(h(),L("h4",xe,r(a.status),1)):G("",!0),a.status=="online"?(h(),L("h4",Le,r(a.status),1)):G("",!0),a.status=="onride"?(h(),L("h4",Ie,r(a.status),1)):G("",!0),s("p",$e,r(a.last_seen),1)])])])])])])]),_:2},1024))),256))])):(h(),L("div",Ae,u[3]||(u[3]=[s("img",{src:"/image/map/no-drivers.png",style:{width:"60%",margin:"auto"},alt:"No Drivers Found"},null,-1)])))]),_:1}),n($,{lg:"8"},{default:d(()=>[s("div",Ve,r(t.$t("map_loading")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}const Ne=X(oe,[["render",De]]);export{Ne as default};

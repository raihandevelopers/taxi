import{_ as B,C as M,G as N,r as D,D as I,av as V,aw as F,a as y,ax as O,ay as K,az as U,aA as S,aB as L,N as P,g as k,o as p,i as u,l as i,k as c,w as g,J as d,n as x,q as m,M as f,p as _,F as W,L as A,B as w,y as E}from"./vendor-ddfbd976.js";import{i as z}from"./app-042fb454.js";let T=null;const j={data(){return{phoneNumber:"",country:"",password:"",verificationCode:"",mobileExists:!1,showOTPInput:!1,verificationId:null,otpError:!1,otpErrorMessage:"The OTP provided is invalid",passwordError:!1,passwordErrorMessage:"",recaptchaVerifier:null,otpDigits:["","","","","",""],logo:window.logo}},props:{countries:Array,default_flag:String,default_dial_code:String,app_for:String,successMessage:String,alertMessage:String,enable_firebase_otp:Boolean,firebaseConfig:Object,default_country_id:String},setup(o){const{t:e}=M(),a=N(()=>o.countries.filter(h=>h.name.toLowerCase().includes(l.value.toLowerCase()))),l=D(""),r=D(!1),n=D({dial_code:o.default_dial_code||"",flag:o.default_flag||"",id:o.default_country_id||""}),v=h=>{n.value=h,r.value=!1},b=()=>{r.value=!r.value},C=h=>{h.target.closest(".input-group")===null&&(r.value=!1)};return I(async()=>{await z("en")}),I(()=>{const h=o.firebaseConfig;firebase.apps.length||(T=V(h)),document.addEventListener("click",C)}),F(()=>{document.removeEventListener("click",C)}),{t:e,selectCountry:v,selectedCountry:n,filteredCountries:a,searchQuery:l,showDropdown:r,toggleDropdown:b}},methods:{async validateMobile(){try{const o=await y.post("/api/v1/user/validate-mobile-for-login",{mobile:this.phoneNumber});o.data.success&&o.data.message==="mobile_exists"&&(this.mobileExists=!0),this.mobileExists||this.sendOTP()}catch(o){console.error(this.t("error_validating_mobile"),o)}},async sendOTP(){if(this.app_for=="demo"&&(this.showOTPInput=!0),this.enable_firebase_otp)this.sendFirebaseOTP();else try{(await y.post("/api/v1/mobile-otp",{mobile:this.phoneNumber,country_code:this.selectedCountry.dial_code})).status==200&&(this.showOTPInput=!0)}catch(o){console.error(this.t("error_sending_otp"),o)}},async sendFirebaseOTP(){const o=O(T);this.recaptchaVerifier=new K(o,"recaptcha-container",{size:"invisible"},o);try{const e=await U(o,`${this.selectedCountry.dial_code}${this.phoneNumber}`,this.recaptchaVerifier);this.verificationId=e.verificationId,this.showOTPInput=!0}catch(e){console.error(this.t("error_sending_firebase_otp"),e)}},handleKeydown(o,e){var a;(o.key==="Backspace"||o.key==="Delete")&&(this.otpDigits[e]===""?e>0&&((a=o.target.previousElementSibling)==null||a.focus()):this.otpDigits[e]="")},moveFocus(o,e){var l;const a=o.target.value;/^\d$/.test(a)?(this.otpDigits[e]=a,e<5&&((l=o.target.nextElementSibling)==null||l.focus())):this.otpDigits[e]=""},async verifyOTP(){if(this.verificationCode=this.otpDigits.join(""),this.verificationCode.length===6?this.otpError=!1:this.otpError=!0,this.enable_firebase_otp&&this.app_for!=="demo")await this.verifyFirebaseOTP();else try{(await y.post("/api/v1/validate-otp",{mobile:this.phoneNumber,otp:this.verificationCode})).data.success&&(this.otpError=!1,this.otpErrorMessage="",this.mobileExists?await this.loginWithOTP():await this.registerUser())}catch(o){o.response&&o.response.status===422?(console.log("error-validation"),this.otpError=!0,this.otpErrorMessage=o.response.data.errors.message):console.error(this.t("error_verifying_otp"),o)}},async verifyFirebaseOTP(){this.verificationCode=this.otpDigits.join("");const o=O(T),e=S.credential(this.verificationId,this.verificationCode);try{await L(o,e),this.mobileExists?await this.loginWithOTP():await this.registerUser()}catch(a){a.response&&a.response.status===422?(console.log("error-validation"),this.otpError=!0,this.otpErrorMessage=a.response.data.errors.message):console.error(this.t("error_verifying_otp"),a)}},async loginWithPassword(){try{const o=await y.post("/user/login",{mobile:this.phoneNumber,password:this.password});o.status===200&&o.data.success&&P.get("/create-booking")}catch(o){o.response&&o.response.status===422?(this.passwordError=!0,this.passwordErrorMessage=o.response.data.errors.mobile[0]):console.error(t("error_verifying_otp"),o),console.error(t("error_logging_in"),o)}},async loginWithOTP(){try{(await y.post("/user/login",{mobile:this.phoneNumber})).data.success&&P.get("/create-booking")}catch(o){console.error(t("error_logging_in_with_otp"),o)}},async registerUser(){try{const o=await y.post("/user/register",{mobile:this.phoneNumber,country:this.selectedCountry.id});o.status===200&&o.data.success&&P.get("/create-booking")}catch(o){console.error(t("error_registering_user"),o)}}}},R={class:"auth-page-wrapper overflow-hidden",style:{height:"100vh"}},Q={class:"auth-page-content overflow-hidden"},q={class:"p-lg-5 p-4"},G={class:"mt-4 text-center"},J=["src"],X={class:"text-center mt-5"},H={class:"text-primary"},Y={class:"text-muted"},Z={class:"mt-4"},$={class:"mb-3"},ee={class:"input-group","data-input-flag":""},oe=["src"],se={class:"ms-2 country-codeno"},te=["placeholder"],re={class:"p-2 px-3 pt-1 searchlist-input"},ie=["placeholder"],ne={class:"list-unstyled dropdown-menu-list mb-0"},le=["onClick"],ae=["src"],de={class:"align-middle"},pe={key:0},ue={key:0},ce={class:"mb-3"},ge={for:"password",class:"form-label"},he=["placeholder"],me={key:0,class:"invalid-feedback"},fe={class:"mt-4"},_e={class:"mt-3 text-center"},ve={key:1},ye={key:1},we={for:"otp",class:"form-label"},be={key:0,class:"text-muted"},Ce={class:"d-flex otp-input-container"},ke={key:1,class:"invalid-feedback d-block"};function Ee(o,e,a,l,r,n){const v=k("BButton"),b=k("BCol"),C=k("BRow"),h=k("BContainerFluid");return p(),u("div",R,[i("div",Q,[c(h,null,{default:g(()=>[c(C,null,{default:g(()=>[c(b,{lg:"12"},{default:g(()=>[c(C,{class:"g-0",style:{height:"100vh"}},{default:g(()=>[c(b,{lg:"4"},{default:g(()=>[i("div",q,[i("div",G,[i("img",{src:r.logo,alt:"",height:"30"},null,8,J)]),i("div",X,[i("h5",H,d(o.$t("enter_your_mobile_number")),1),i("p",Y,d(o.$t("otp_will_be_sent_on_sms")),1)]),i("div",Z,[i("form",{onSubmit:e[23]||(e[23]=x((...s)=>n.validateMobile&&n.validateMobile(...s),["prevent"]))},[i("div",$,[i("div",ee,[i("button",{class:"btn btn-light border",type:"button",onClick:e[0]||(e[0]=(...s)=>l.toggleDropdown&&l.toggleDropdown(...s))},[i("img",{src:l.selectedCountry.flag,alt:"flag",height:"20",class:"country-flagimg rounded"},null,8,oe),i("span",se,d(l.selectedCountry.dial_code),1)]),m(i("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=s=>r.phoneNumber=s),class:"form-control",id:"number",placeholder:o.$t("enter_mobile"),required:""},null,8,te),[[f,r.phoneNumber]])]),l.showDropdown?(p(),u("div",{key:0,class:_(["dropdown-menu w-60 mt-0",{show:l.showDropdown}])},[i("div",re,[m(i("input",{type:"text",class:"form-control form-control-sm border search-countryList",placeholder:o.$t("search_country_name_or_country_code"),"onUpdate:modelValue":e[2]||(e[2]=s=>l.searchQuery=s),onClick:e[3]||(e[3]=x(()=>{},["stop"]))},null,8,ie),[[f,l.searchQuery]])]),i("ul",ne,[(p(!0),u(W,null,A(l.filteredCountries,s=>(p(),u("li",{key:s.id},[i("a",{href:"javascript:void(0);",class:"dropdown-item notify-item language py-2",onClick:De=>l.selectCountry(s)},[i("img",{src:s.flag,alt:"flag",class:"me-2 rounded",height:"18"},null,8,ae),i("span",de,d(s.name)+" "+d(s.dial_code),1)],8,le)]))),128))])],2)):w("",!0)]),r.showOTPInput?w("",!0):(p(),u("div",pe,[r.mobileExists?(p(),u("div",ue,[i("div",ce,[i("label",ge,d(o.$t("password")),1),m(i("input",{type:"password","onUpdate:modelValue":e[4]||(e[4]=s=>r.password=s),class:_({"form-control is-invalid":r.passwordError,"form-control":!r.passwordError}),id:"password",placeholder:o.$t("enter_password")},null,10,he),[[f,r.password]]),r.passwordError?(p(),u("div",me,d(r.passwordErrorMessage),1)):w("",!0)]),i("div",fe,[c(v,{variant:"primary",class:"w-100",onClick:n.loginWithPassword},{default:g(()=>[E(d(o.$t("login")),1)]),_:1},8,["onClick"])]),i("div",_e,[e[24]||(e[24]=i("span",null,"or",-1)),c(v,{variant:"link",onClick:n.sendOTP},{default:g(()=>[E(d(o.$t("sign_in_with_otp")),1)]),_:1},8,["onClick"])])])):(p(),u("div",ve,[c(v,{variant:"success",class:"w-100",type:"submit"},{default:g(()=>[E(d(o.$t("send_otp_for_registration")),1)]),_:1})]))])),r.showOTPInput?(p(),u("div",ye,[i("label",we,d(o.$t("enter_otp")),1),a.app_for=="demo"?(p(),u("p",be,d(o.$t("enter_default_otp_123456")),1)):w("",!0),i("div",Ce,[m(i("input",{type:"number","onUpdate:modelValue":e[5]||(e[5]=s=>r.otpDigits[0]=s),class:_(["form-control",{"is-invalid":r.otpError}]),maxlength:"1",onInput:e[6]||(e[6]=s=>n.moveFocus(s,0)),onKeydown:e[7]||(e[7]=s=>n.handleKeydown(s,0))},null,34),[[f,r.otpDigits[0]]]),m(i("input",{type:"number","onUpdate:modelValue":e[8]||(e[8]=s=>r.otpDigits[1]=s),class:_(["form-control",{"is-invalid":r.otpError}]),maxlength:"1",onInput:e[9]||(e[9]=s=>n.moveFocus(s,1)),onKeydown:e[10]||(e[10]=s=>n.handleKeydown(s,1))},null,34),[[f,r.otpDigits[1]]]),m(i("input",{type:"number","onUpdate:modelValue":e[11]||(e[11]=s=>r.otpDigits[2]=s),class:_(["form-control",{"is-invalid":r.otpError}]),maxlength:"1",onInput:e[12]||(e[12]=s=>n.moveFocus(s,2)),onKeydown:e[13]||(e[13]=s=>n.handleKeydown(s,2))},null,34),[[f,r.otpDigits[2]]]),m(i("input",{type:"number","onUpdate:modelValue":e[14]||(e[14]=s=>r.otpDigits[3]=s),class:_(["form-control",{"is-invalid":r.otpError}]),maxlength:"1",onInput:e[15]||(e[15]=s=>n.moveFocus(s,3)),onKeydown:e[16]||(e[16]=s=>n.handleKeydown(s,3))},null,34),[[f,r.otpDigits[3]]]),m(i("input",{type:"number","onUpdate:modelValue":e[17]||(e[17]=s=>r.otpDigits[4]=s),class:_(["form-control",{"is-invalid":r.otpError}]),maxlength:"1",onInput:e[18]||(e[18]=s=>n.moveFocus(s,4)),onKeydown:e[19]||(e[19]=s=>n.handleKeydown(s,4))},null,34),[[f,r.otpDigits[4]]]),m(i("input",{type:"number","onUpdate:modelValue":e[20]||(e[20]=s=>r.otpDigits[5]=s),class:_(["form-control",{"is-invalid":r.otpError}]),maxlength:"1",onInput:e[21]||(e[21]=s=>n.moveFocus(s,5)),onKeydown:e[22]||(e[22]=s=>n.handleKeydown(s,5))},null,34),[[f,r.otpDigits[5]]])]),r.otpError?(p(),u("div",ke,d(r.otpErrorMessage),1)):w("",!0),c(v,{variant:"primary",class:"w-100 mt-3",onClick:n.verifyOTP},{default:g(()=>[E(d(o.$t("verify_otp")),1)]),_:1},8,["onClick"])])):w("",!0),e[25]||(e[25]=i("div",{id:"recaptcha-container"},null,-1))],32)])])]),_:1}),c(b,{lg:"8"},{default:g(()=>e[26]||(e[26]=[i("div",{class:"p-lg-5 p-4 h-100",style:{background:"url(/images/TAXI.png)","background-position":"center","background-size":"cover","background-repeat":"no-repeat"}},null,-1)])),_:1,__:[26]})]),_:1})]),_:1})]),_:1})]),_:1})])])}const Ie=B(j,[["render",Ee]]);export{Ie as default};

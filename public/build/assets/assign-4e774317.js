import{_ as ee,Z as te,z as se,Y as ae,P as oe,R as ie,U as D,C as le,r as z,D as ne,g as M,o as P,x as re,w as c,a as de,k as r,l as e,J as i,i as j,F as Y,L as Z,B as J,y as T,N as ce}from"./vendor-ddfbd976.js";import{L as _e}from"./main-306a5ea6.js";import{P as ue}from"./page-header-2dc95532.js";import{F as me}from"./FormValidation-a9047131.js";import"./footer-e648049d.js";import"./app-042fb454.js";const ge={data(){return{rightOffcanvas:!1}},components:{Layout:_e,PageHeader:ue,Head:te,Link:se,Scrollbar:ae,FormValidation:me,flatPickr:oe},computed:{...ie(["permissions"])},props:{successMessage:String,alertMessage:String,firebaseSettings:Array,app_for:String,map_key:String,driver_radius:Number,result:Object},methods:{timer(){let t;D.fire({title:"Booking alert!",html:"Your Ride has been Booked <b></b> Successfully.",timer:2e3,timerProgressBar:!0,onBeforeOpen:()=>{D.showLoading(),t=setInterval(()=>{D.getContent().querySelector("b").textContent=D.getTimerLeft()},100)},onClose:()=>{clearInterval(t)}}).then(s=>{s.dismiss===D.DismissReason.timer&&console.log("I was closed by the timer")})}},setup(t){const{t:s}=le(),_=z(!1),f=z(t.driver_radius??10),E=z(t.successMessage||""),O=z(t.alertMessage||""),U=()=>{E.value="",O.value=""},N=z([]),L=z(null),m=z(t.result),x=p=>{L.value=p,_.value=!0},V=async p=>{try{const g=await de.post(`/ongoing-rides/assign-driver/${m.value.id}`,{driver_id:p.id});g.data.status?(_.value=!1,D.fire(s("success"),s("users_assigned_successfully"),"success")):(D.fire(s("Warning"),g.data.message,"warning"),console.log(g))}catch(g){D.fire(s("Warning"),response.data.message,"warning"),console.error(g)}},A=()=>{const p=new google.maps.Map(document.getElementById("map"),{center:{lat:m.value.pick_lat,lng:m.value.pick_lng},zoom:15}),g="/image/map/pickup.png";new google.maps.Marker({position:{lat:m.value.pick_lat,lng:m.value.pick_lng},map:p,icon:{url:g,scaledSize:new google.maps.Size(30,30)}});let n={};p.setZoom(15);const u=()=>{const a=firebase.database().ref("drivers");firebase.database().ref("requests").child(m.value.id).on("value",d=>{const l=d.val();(l.is_accept||l.hasOwnProperty("driver_id"))&&ce.get(`/rides-request/view/${m.value.id}`)}),a.on("value",d=>{N.value=[],d.forEach(l=>{const o=l.val(),w=Date.now()-15*60*1e3;if(o.updated_at<w)return;const y=o.g,h=G(y);if(h)if(K(m.value.pick_lat,m.value.pick_lng,h.lat,h.lon)<=f.value&&o.is_available&&o.is_active&&o.vehicle_types.includes(m.value.vehicle_type_id)){const B=new google.maps.LatLng(h.lat,h.lon),q=`/image/map/${o.vehicle_type_icon}.png`;if(N.value.push(o),n[o.id])I(n[o.id],n[o.id].getPosition(),B,o.bearing),n[o.id].setIcon({url:q,scaledSize:new google.maps.Size(30,30)});else{const k=new google.maps.Marker({position:B,map:p,icon:{url:q,scaledSize:new google.maps.Size(30,30)}});k.addListener("click",()=>{x(o)}),n[o.id]=k,I(k,k.getPosition(),B,o.bearing)}}else n[o.id]&&(n[o.id].setMap(null),delete n[o.id])})}),a.on("child_changed",d=>{const l=d.val();l.is_active?$(l):F(l.id)}),a.on("child_removed",d=>{const l=d.val();F(l.id)})},I=(a,S,d,l)=>{const w=33.333333333333336;let y=S.lat(),h=S.lng(),R=d.lat(),B=d.lng();const q=v=>v<.5?2*v*v:-1+(4-2*v)*v,k=v=>{let H=q(v/60),C=new google.maps.LatLng(y+(R-y)*H,h+(B-h)*H);if(a.setPosition(C),l!==void 0){const W=a.prevBearing||l,Q=l-W,X=W+Q*H;a.setIcon({...a.getIcon(),rotation:X}),a.prevBearing=l}v<60&&setTimeout(()=>k(v+1),w)};k(0)},$=a=>{const S=a.g,d=G(S);if(d){const l=new google.maps.LatLng(d.lat,d.lon),o=`/image/map/${a.vehicle_type_icon}.png`;if(n[a.id])n[a.id].setIcon({url:o,scaledSize:new google.maps.Size(30,30)});else{const b=new google.maps.Marker({position:l,map:p,icon:{url:o,scaledSize:new google.maps.Size(30,30)}});b.addListener("click",()=>{x(a)}),n[a.id]=b}}else console.error(`Failed to decode geohash for driver ID: ${a.id}`)},F=a=>{n[a]&&(n[a].setMap(null),delete n[a])},G=a=>{const S="0123456789bcdefghjkmnpqrstuvwxyz",d=[16,8,4,2,1];let l=!0,o=-90,b=90,w=-180,y=180,h,R;if(a){for(let B=0;B<a.length;B++){let q=a.charAt(B),k=S.indexOf(q);for(let v=0;v<5;v++){let H=d[v];if(l){let C=(w+y)/2;k&H?w=C:y=C}else{let C=(o+b)/2;k&H?o=C:b=C}l=!l}}return h=(o+b)/2,R=(w+y)/2,{lat:h,lon:R}}},K=(a,S,d,l)=>{const b=(d-a)*Math.PI/180,w=(l-S)*Math.PI/180,y=Math.sin(b/2)*Math.sin(b/2)+Math.cos(a*Math.PI/180)*Math.cos(d*Math.PI/180)*Math.sin(w/2)*Math.sin(w/2);return 6371*(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)))};u()};return ne(async()=>{try{const g=t.map_key,n=document.createElement("script");n.src=`https://maps.googleapis.com/maps/api/js?key=${g}&libraries=places`,n.async=!0,n.defer=!0,n.onload=A,document.head.appendChild(n);var p={apiKey:t.firebaseSettings.firebase_api_key,authDomain:t.firebaseSettings.firebase_auth_domain,databaseURL:t.firebaseSettings.firebase_database_url,projectId:t.firebaseSettings.firebase_project_id,storageBucket:t.firebaseSettings.firebase_storage_bucket,messagingSenderId:t.firebaseSettings.firebase_messaging_sender_id,appId:t.firebaseSettings.firebase_app_id};firebase.apps.length||firebase.initializeApp(p)}catch(g){console.error(s("error_initializing_firebase_or_fetching_settings"),g)}}),{modalShow:_,successMessage:E,alertMessage:O,modalDriver:L,assignDriver:V,assignModal:x,fleetDrivers:N,dismissMessage:U,errors:{}}}},ve={class:"col-lg-3"},fe={class:"card-header"},pe={class:"card-title mb-0"},he={class:"card-body p-4 text-center"},be={class:"mx-auto avatar-md mb-3"},ye=["src"],we={class:"card-title mb-1"},ke={class:"text-muted mb-0"},Me={class:"col-lg-3"},Se={class:"card-header"},Be={class:"card-title mb-0"},Le={class:"card-body p-4 text-center"},xe={class:"mx-auto avatar-md mb-3"},De=["src"],Ie={class:"card-title mb-1"},Ce={class:"col-lg-6"},ze={class:"card-header"},Pe={class:"card-title mb-0"},Re={class:"card-body p-4"},qe={class:"mb-2"},He={class:"mb-2"},je={key:0},Te={class:"mb-2"},Ne={class:"mb-2"},Ve={class:"btn-group mb-2"},$e={class:"btn btn-light dropdown-toggle",type:"button",id:"stop_locations_list","data-bs-toggle":"dropdown","data-bs-auto-close":"outside","aria-expanded":"false"},Ee={class:"dropdown-menu overflow-auto",style:{"max-width":"500px"},"aria-labelledby":"stop_locations_list"},Oe={class:"dropdown-item overflow-auto"},Ue={key:1},Ae={class:"mb-2"},Fe={class:"mb-2"},Ge={class:"row"},We={class:"col-12 col-lg-4",style:{"overflow-x":"auto"}},Ye={class:"row"},Ze={class:"row"},Je=["onClick"],Ke={class:"col-sm-3 border-end d-flex align-items-center justify-content-center"},Qe=["src"],Xe={class:"col-sm-5 mt-3 border-end"},et={class:"d-flex align-items-center"},tt={class:"d-flex align-items-center"},st={class:"d-flex align-items-center"},at={class:"col-sm-4 d-flex align-items-center justify-content-center"},ot={type:"button",class:"btn btn-info btn-label waves-effect waves-light"},it={class:"col-12 col-lg-8"},lt={class:"mb-3 text-center m-auto"},nt={id:"map",style:{height:"500px"}},rt={class:"col-lg-12"},dt={class:"card-header"},ct={class:"card-title mb-0"},_t={class:"card-body p-4 text-center"},ut={class:"mx-auto avatar-md mb-3"},mt=["src"],gt={class:"card-title mb-1"},vt={class:"text-muted mb-0"},ft={class:"text-muted mb-0"},pt={class:"modal-footer v-modal-footer"};function ht(t,s,_,f,E,O){const U=M("Head"),N=M("PageHeader"),L=M("BRow"),m=M("BCardBody"),x=M("BCard"),V=M("BCol"),A=M("BCardHeader"),p=M("BLink"),g=M("BModal"),n=M("Layout");return P(),re(n,null,{default:c(()=>[r(U,{title:"Taxi Ride"}),r(N,{title:t.$t("book"),pageTitle:t.$t("taxi_ride"),pageLink:"/ongoing-rides"},null,8,["title","pageTitle"]),r(L,null,{default:c(()=>[r(V,null,{default:c(()=>[r(x,null,{default:c(()=>[r(m,null,{default:c(()=>[r(L,null,{default:c(()=>[e("div",ve,[e("div",fe,[e("h6",pe,i(t.$t("user_details")),1)]),e("div",he,[e("div",be,[e("img",{src:_.result.userDetail.data.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,ye)]),e("h5",we,i(_.result.userDetail.data.name),1),e("p",ke,i(_.app_for=="demo"?"***********":_.result.userDetail.data.mobile),1)])]),e("div",Me,[e("div",Se,[e("h6",Be,i(t.$t("vehicle_details")),1)]),e("div",Le,[e("div",xe,[e("img",{src:_.result.vehicle_type_image,alt:"2",class:"avatar-md rounded-circle"},null,8,De)]),e("h5",Ie,i(_.result.vehicle_type_name),1)])]),e("div",Ce,[e("div",ze,[e("h6",Pe,i(t.$t("trip_details")),1)]),e("div",Re,[e("h5",qe,[e("b",null,i(t.$t("pickup_location")),1)]),e("h6",He,i(_.result.pick_address),1),_.result.requestStops.data.length>0?(P(),j("div",je,[e("h5",Te,[e("b",null,i(t.$t("stop_location")),1)]),e("h5",Ne,[e("b",null,i(t.$t("stop_location")),1)]),e("div",Ve,[e("button",$e,i(t.$t("view_stop_location")),1),e("ul",Ee,[(P(!0),j(Y,null,Z(_.result.requestStops.data,(u,I)=>(P(),j("li",null,[e("a",Oe,i(u.address),1)]))),256))])])])):J("",!0),_.result.is_rental?J("",!0):(P(),j("div",Ue,[e("h5",Ae,[e("b",null,i(t.$t("drop_location")),1)]),e("h6",Fe,i(_.result.drop_address),1)]))])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(L,null,{default:c(()=>[r(V,{lg:"12"},{default:c(()=>[r(x,{"no-body":"",id:"tasksList"},{default:c(()=>[r(A,{class:"border-0"}),r(m,{class:"border border-dashed border-end-0 border-start-0"},{default:c(()=>[e("div",Ge,[e("div",We,[e("div",Ye,[r(L,null,{default:c(()=>[r(x,{"no-body":""},{default:c(()=>[r(m,{class:"overflow-y-auto",style:{"max-height":"500px",width:"100%"}},{default:c(()=>[r(V,{xl:"12"},{default:c(()=>[e("div",Ze,[(P(!0),j(Y,null,Z(f.fleetDrivers,u=>(P(),j("div",{key:u.driver_id,onClick:I=>f.assignModal(u),class:"row"},[e("div",Ke,[e("div",null,[e("img",{class:"rounded-circle avatar-md",alt:"200x200",src:u.profile_picture},null,8,Qe)])]),e("div",Xe,[e("div",et,[s[3]||(s[3]=e("i",{class:"ri-user-line",style:{"font-size":"20px"}},null,-1)),s[4]||(s[4]=T("    ")),e("span",null,i(u.name),1)]),e("div",tt,[s[5]||(s[5]=e("i",{class:"ri-phone-line",style:{"font-size":"20px"}},null,-1)),s[6]||(s[6]=T("    ")),e("span",null,i(_.app_for=="demo"?"***********":u.mobile),1)]),e("div",st,[s[7]||(s[7]=e("i",{class:"ri-star-fill",style:{"font-size":"20px"}},null,-1)),s[8]||(s[8]=T("    ")),e("span",null,i(u.rating),1)])]),e("div",at,[e("div",null,[e("button",ot,[s[9]||(s[9]=e("i",{class:"ri-car-line label-icon fs-20 align-middle me-2"},null,-1)),T(" "+i(t.$t("assign")),1)])])])],8,Je))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]),e("div",it,[e("div",lt,[e("div",nt,i(t.$t("map_loading")),1)])])])]),_:1})]),_:1})]),_:1})]),_:1}),e("div",null,[r(g,{modelValue:f.modalShow,"onUpdate:modelValue":s[2]||(s[2]=u=>f.modalShow=u),"hide-footer":"",title:t.$t("driver_details"),class:"v-modal-custom",size:"sm"},{default:c(()=>[r(x,null,{default:c(()=>[r(m,null,{default:c(()=>[r(L,null,{default:c(()=>{var u,I,$;return[e("div",rt,[e("div",dt,[e("h6",ct,i(t.$t("confirm_assign_driver")),1)]),e("div",_t,[e("div",ut,[e("img",{src:(u=f.modalDriver)==null?void 0:u.profile_picture,alt:"2",class:"avatar-md rounded-circle"},null,8,mt)]),e("h5",gt,i((I=f.modalDriver)==null?void 0:I.name),1),e("p",vt,i(_.app_for=="demo"?"***********":($=f.modalDriver)==null?void 0:$.mobile),1)]),e("p",ft,i(t.$t("confirm_assign_driver_info")),1)])]}),_:1})]),_:1})]),_:1}),e("div",pt,[r(p,{href:"javascript:void(0);",class:"btn btn-link link-warning fw-medium",onClick:s[0]||(s[0]=u=>f.modalShow=!1)},{default:c(()=>[s[10]||(s[10]=e("i",{class:"ri-close-line me-1 align-middle"},null,-1)),T(" "+i(t.$t("close")),1)]),_:1,__:[10]}),e("button",{type:"button",class:"btn btn-soft-info waves-effect waves-light",onClick:s[1]||(s[1]=u=>f.assignDriver(f.modalDriver))},[s[11]||(s[11]=e("i",{class:"ri-car-line me-1 align-middle"},null,-1)),T(" "+i(t.$t("assign_driver")),1)])])]),_:1},8,["modelValue","title"])])]),_:1})}const Bt=ee(ge,[["render",ht]]);export{Bt as default};
